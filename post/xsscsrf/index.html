<!DOCTYPE html>
<html lang="zh-cn" data-theme="light"><head>
    <meta name="google-site-verification" content="kw1N-Xm6qEr1c9PGuRd0U_T6DXkw_EHsLyz5LpuDDv8" />
    <meta name="msvalidate.01" content="EE98205D30806C22C519683EFC53E9BA" />
    <meta name="baidu-site-verification" content="iPC3wUcQLL" />
    <title>  xss&amp;csrf </title>
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.74.3" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" itemprop="description"
        content=" xss&amp;csrf ">
    <meta name="keywords" itemprop="keywords"
        content=" [xss csrf] ">
    <base href="https://gaoshanwomeng.github.io/">
    <link rel="shortcut icon" href="https://gaoshanwomeng.github.io/favicons//favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="https://gaoshanwomeng.github.io/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://gaoshanwomeng.github.io/favicons/favicon-16x16.png">
    <link rel="canonical" href="https://gaoshanwomeng.github.io/post/xsscsrf/">
    <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_2450869_iypnqhtzjei.css">
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="https://gaoshanwomeng.github.io/css/style.min.e59c4b7b2ef3dfb48160bfcc212b8782af21df6deca3cb9f2c723e2262a19529.css" integrity="sha256-5ZxLey7z37SBYL/MISuHgq8h323so8ufLHI&#43;ImKhlSk="
        type="text/css">
</head><body>
<div class="main animated fadeInDown">
  <div class="toc sub-container">
    <div class="toc-header">
        <span>ç›®å½•</span>
        <span id="read-percentage"></span>
    </div>
    <ul class="toc-h3"><li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#1%e4%bb%80%e4%b9%88%e6%98%afxss%e6%94%bb%e5%87%bb" class="toc-link">1ï¼šä»€ä¹ˆæ˜¯XSSæ”»å‡»ï¼Ÿ</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#2-%e5%b8%b8%e8%a7%81%e7%9a%84xss%e6%94%bb%e5%87%bb" class="toc-link">2. å¸¸è§çš„XSSæ”»å‡»</a>
                </li>
                
                        <ul class="toc-h4"><li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#1-%e5%8f%8d%e5%b0%84%e5%9e%8b" class="toc-link">1. åå°„å‹</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#2-%e5%ad%98%e5%82%a8%e5%9e%8b" class="toc-link">2. å­˜å‚¨å‹</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#3-%e5%9f%ba%e4%ba%8edom" class="toc-link">3. åŸºäºDOM</a>
                </li>
                
                        </ul><li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#3-xss%e6%94%bb%e5%87%bb%e7%9a%84%e9%98%b2%e8%8c%83" class="toc-link">3. XSSæ”»å‡»çš„é˜²èŒƒ</a>
                </li>
                
                        <ul class="toc-h4"><li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#1-csp" class="toc-link">1. CSP</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#2-cookie%e5%ae%89%e5%85%a8%e7%ad%96%e7%95%a5" class="toc-link">2. cookieå®‰å…¨ç­–ç•¥</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#3-%e8%be%93%e5%85%a5%e6%a3%80%e6%9f%a5" class="toc-link">3. è¾“å…¥æ£€æŸ¥</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#4-%e8%be%93%e5%87%ba%e6%a3%80%e6%9f%a5" class="toc-link">4. è¾“å‡ºæ£€æŸ¥</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#5-css-%e7%bc%96%e7%a0%81" class="toc-link">5. CSS ç¼–ç </a>
                </li>
                
                        </ul><li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#4-csrf%e6%94%bb%e5%87%bb" class="toc-link">4. CSRFæ”»å‡»</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#5-csrf%e7%9a%84%e9%98%b2%e8%8c%83" class="toc-link">5. CSRFçš„é˜²èŒƒ</a>
                </li>
                
                        <ul class="toc-h4"><li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#1-%e9%aa%8c%e8%af%81-http-referer-%e5%ad%97%e6%ae%b5" class="toc-link">1. éªŒè¯ HTTP Referer å­—æ®µ</a>
                </li>
                <li>
                    <a href="https://gaoshanwomeng.github.io/post/xsscsrf/#2-%e5%9c%a8%e8%af%b7%e6%b1%82%e5%9c%b0%e5%9d%80%e4%b8%ad%e6%b7%bb%e5%8a%a0-token" class="toc-link">2. åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ  token</a>
                </li>
                </div><div class="single-post container">
    <div class="post">
      <div class="header">
        <span class="title">xss&amp;csrf</span>
        
        <div class="info">
          <span>ğŸ“… 2021-07-14</span>
          <span>ğŸ‘¦ Tomtom Young</span>
          <span>ğŸ“– 3787å­—</span>
          <span>â± 8åˆ†é’Ÿ</span>
        </div>
        
      </div>
      <div class="content markdown-body">
        <h3 id="1ä»€ä¹ˆæ˜¯xssæ”»å‡»">1ï¼šä»€ä¹ˆæ˜¯XSSæ”»å‡»ï¼Ÿ</h3>
<ul>
<li>XSSï¼Œå³ Cross Site Scriptï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼›</li>
<li>XSS æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åœ¨ç½‘ç«™ä¸Šæ³¨å…¥æ¶æ„çš„å®¢æˆ·ç«¯ä»£ç ï¼Œå¯¹å®¢æˆ·ç«¯ç½‘é¡µè¿›è¡Œç¯¡æ”¹ï¼Œå¯¹ç”¨æˆ·æµè§ˆå™¨è¿›è¡Œæ§åˆ¶æˆ–è€…è·å–ç”¨æˆ·éšç§æ•°æ®ï¼›</li>
<li>XSSæ”»å‡»å¯ä»¥åˆ†ä¸º3ç±»ï¼šåå°„å‹ï¼ˆéæŒä¹…å‹ï¼‰ã€å­˜å‚¨å‹ï¼ˆæŒä¹…å‹ï¼‰ã€åŸºäºDOMã€‚</li>
</ul>
<h3 id="2-å¸¸è§çš„xssæ”»å‡»">2. å¸¸è§çš„XSSæ”»å‡»</h3>
<h4 id="1-åå°„å‹">1. åå°„å‹</h4>
<ul>
<li>åå°„å‹æ˜¯ç®€å•åœ°æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œåå°„â€ ç»™æµè§ˆå™¨ï¼›</li>
<li>éœ€è¦æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæ¶æ„é“¾æ¥ï¼Œæˆ–è€…æäº¤ä¸€ä¸ªè¡¨å•ï¼Œæˆ–è€…è¿›å…¥ä¸€ä¸ªæ¶æ„ç½‘ç«™æ—¶ï¼Œæ³¨å…¥è„šæœ¬è¿›å…¥è¢«æ”»å‡»è€…çš„ç½‘ç«™ã€‚</li>
</ul>
<p>å¸¸è§çš„åå°„æ€§XSSï¼šæ¶æ„é“¾æ¥ã€‚</p>
<blockquote>
<p>æ¯”å¦‚æˆ‘ç°åœ¨åšä¸€ä¸ªdemoï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
&lt;<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">charset</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">utf-8</span>&gt;
  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;referrer&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;never&#34;</span>&gt;
  &lt;<span style="color:#ff79c6">title</span>&gt;csrfæ”»å‡»&lt;/<span style="color:#ff79c6">title</span>&gt;
&lt;/<span style="color:#ff79c6">head</span>&gt;
&lt;<span style="color:#ff79c6">body</span>&gt;
  &lt;<span style="color:#ff79c6">div</span>&gt;
    &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;http://localhost:3001/xss&#34;</span>&gt;xxs æ”»å‡»&lt;/<span style="color:#ff79c6">a</span>&gt;
    &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;http://localhost:3001/testcookie&#34;</span>&gt;testcookie æ”»å‡»&lt;/<span style="color:#ff79c6">a</span>&gt;
  &lt;/<span style="color:#ff79c6">div</span>&gt;
&lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œç„¶ånodeä¸­app.js ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#ff79c6">const</span> Koa <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa&#39;</span>);
<span style="color:#ff79c6">const</span> fs <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;fs&#39;</span>);
<span style="color:#ff79c6">const</span> path <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;path&#39;</span>);
<span style="color:#ff79c6">const</span> router <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa-router&#39;</span>)();
<span style="color:#ff79c6">const</span> koaBody <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa-body&#39;</span>);
<span style="color:#ff79c6">const</span> <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa-static&#39;</span>);

<span style="color:#ff79c6">const</span> app <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Koa();

router.get(<span style="color:#f1fa8c">&#39;/&#39;</span>, (ctx, next) =&gt; {
  <span style="color:#6272a4">// è®¾ç½®å¤´ç±»å‹, å¦‚æœä¸è®¾ç½®ï¼Œä¼šç›´æ¥ä¸‹è½½è¯¥é¡µé¢
</span><span style="color:#6272a4"></span>  ctx.type <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;html&#39;</span>;
  <span style="color:#6272a4">// è¯»å–æ–‡ä»¶
</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">const</span> pathUrl <span style="color:#ff79c6">=</span> path.join(__dirname, <span style="color:#f1fa8c">&#39;/static/index.html&#39;</span>);
  ctx.body <span style="color:#ff79c6">=</span> fs.createReadStream(pathUrl);
  next();
});

router.get(<span style="color:#f1fa8c">&#39;/xss&#39;</span>, (ctx, next) =&gt; {
  ctx.body <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&lt;script&gt;alert(&#34;åå°„å‹ XSS æ”»å‡»&#34;)&lt;/script&gt;&#39;</span>;
});
router.get(<span style="color:#f1fa8c">&#39;/testcookie&#39;</span>, (ctx, next) =&gt; {
  console.log(ctx.cookies.get(<span style="color:#f1fa8c">&#39;connect.sid&#39;</span>));
  ctx.body <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&lt;script&gt;alert(&#34;&#39;</span><span style="color:#ff79c6">+</span>ctx.cookies.get(<span style="color:#f1fa8c">&#39;connect.sid&#39;</span>)<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#39;&#34;)&lt;/script&gt;&#39;</span>;
  next();
});

app.use(<span style="color:#ff79c6">static</span>(path.join(__dirname)));

app.use(router.routes());
app.use(router.allowedMethods());

app.listen(<span style="color:#bd93f9">3001</span>, () =&gt; {
  console.log(<span style="color:#f1fa8c">&#39;server is listen in 3001&#39;</span>);
});
</code></pre></td></tr></table>
</div>
</div><p>å½“ç”¨æˆ·ç‚¹å‡»xxs æ”»å‡»æ¶æ„é“¾æ¥æ—¶å€™ï¼Œé¡µé¢ä¼šè·³è½¬åˆ° http://localhost:3001/xss æ”»å‡»è€…é¢„å…ˆå‡†å¤‡çš„é¡µé¢ï¼Œç„¶åä¼šè¿”å›æ”»å‡»è€…å‡†å¤‡çš„jsè„šæœ¬ï¼Œè¯¥jsè„šæœ¬å°±åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œäº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231214099-1234219577.png" alt="img"></p>
<p>å½“ç”¨æˆ·ç‚¹å‡» testcookie æ”»å‡» è¿™ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œé¦–å…ˆè¦ä¿è¯é¡µé¢ä¸Šæœ‰cookieï¼Œæ¯”å¦‚æˆ‘è¯·æ±‚å¦‚ä¸‹çš„cookie:</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231229205-1557810526.png" alt="img"></p>
<p>ç„¶åæˆ‘ä»¬ç‚¹å‡» testcookie è¯¥é“¾æ¥ï¼Œä¹Ÿä¼šè°ƒç”¨nodeä¸­çš„ router.get('/testcookie&rsquo;, (ctx, next) =&gt; {}) è¿™ä¸ªè¯·æ±‚è·å–åˆ°cookieï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231254328-364209115.png" alt="img"></p>
<p>æˆ‘ä»¬å°±é€šè¿‡xssæ”»å‡»æ‹¿åˆ°å¯¹æ–¹çš„cookieä¿¡æ¯äº†ã€‚</p>
</blockquote>
<h4 id="2-å­˜å‚¨å‹">2. å­˜å‚¨å‹</h4>
<ul>
<li>å­˜å‚¨å‹æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œå­˜å‚¨â€ åœ¨æœåŠ¡å™¨ç«¯ï¼Œå½“æµè§ˆå™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œè„šæœ¬ä»æœåŠ¡å™¨ä¸Šä¼ å›å¹¶æ‰§è¡Œã€‚è¿™ç§ XSS æ”»å‡»å…·æœ‰å¾ˆå¼ºçš„ç¨³å®šæ€§ï¼›</li>
<li>å¸¸è§çš„åœºæ™¯æ˜¯åŒ…å«æ¶æ„ JavaScript ä»£ç çš„æ–‡ç« æˆ–è¯„è®ºï¼Œå‘è¡¨åæ‰€æœ‰è®¿é—®è¯¥æ–‡ç« æˆ–è¯„è®ºçš„äººï¼Œéƒ½ä¼šæ‰§è¡Œè¿™æ®µæ¶æ„ä»£ç ã€‚</li>
</ul>
<h4 id="3-åŸºäºdom">3. åŸºäºDOM</h4>
<ul>
<li>åŸºäº DOM çš„ XSS æ”»å‡»æ˜¯æŒ‡é€šè¿‡æ¶æ„è„šæœ¬ä¿®æ”¹é¡µé¢çš„ DOM ç»“æ„ï¼Œæ˜¯çº¯ç²¹å‘ç”Ÿåœ¨å®¢æˆ·ç«¯çš„æ”»å‡»ã€‚</li>
<li>ä¸€èˆ¬æœ‰å¦‚ä¸‹DOMæ“ä½œï¼š
<ol>
<li>ä½¿ç”¨document.writeç›´æ¥è¾“å‡ºæ•°æ®ï¼›</li>
<li>ä½¿ç”¨innerHTMLç›´æ¥è¾“å‡ºæ•°æ®ï¼›</li>
<li>ä½¿ç”¨locationã€location.hrefã€location.replaceã€iframe.srcã€document.refererã€window.nameç­‰è¿™äº›ï¼›</li>
</ol>
</li>
</ul>
<blockquote>
<p><strong>ä½¿ç”¨document.writeã€innerHTMLç›´æ¥è¾“å‡ºå¯¼è‡´æµè§ˆå™¨è§£ææ¶æ„ä»£ç </strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
&lt;<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">charset</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">utf-8</span>&gt;
  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;referrer&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;never&#34;</span>&gt;
  &lt;<span style="color:#ff79c6">title</span>&gt;&lt;/<span style="color:#ff79c6">title</span>&gt;
&lt;/<span style="color:#ff79c6">head</span>&gt;
&lt;<span style="color:#ff79c6">body</span>&gt;
  &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;test&#39;</span>&gt;&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>&gt;&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
  &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>&gt;
    <span style="color:#6272a4">// è¿”å›URLä¸­çš„æŸ¥è¯¢éƒ¨åˆ†ï¼ˆï¼Ÿä¹‹åçš„å†…å®¹ï¼‰
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> location.search;
    <span style="color:#6272a4">// ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬å‡å¦‚urlæ˜¯ å¦‚ä¸‹è¿™æ ·çš„
</span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// http://127.0.0.1/xsstest.html?url=javascript:alert(&#39;xsstest&#39;); 
</span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// ç„¶åæˆ‘ä»¬çš„æ˜¯ s çš„å€¼å°±ä¸ºå¦‚ä¸‹ï¼š
</span><span style="color:#6272a4"></span>    s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;?url=javascript:alert(&#39;xsstest&#39;)&#34;</span>;
    s <span style="color:#ff79c6">=</span> s.substring(<span style="color:#bd93f9">1</span>, s.length);       <span style="color:#6272a4">// è¿”å›æ•´ä¸ªæŸ¥è¯¢å†…å®¹
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">var</span> url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;                       <span style="color:#6272a4">// å®šä¹‰å˜é‡url
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">if</span> (s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) {       <span style="color:#6272a4">// åˆ¤æ–­URLæ˜¯å¦ä¸ºç©º 
</span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">var</span> pos <span style="color:#ff79c6">=</span> s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">4</span>;  <span style="color:#6272a4">// è¿‡æ»¤æ‰&#34;url=&#34;å­—ç¬¦
</span><span style="color:#6272a4"></span>      url <span style="color:#ff79c6">=</span> s.substring(pos, s.length);  <span style="color:#6272a4">// å¾—åˆ°åœ°å€æ é‡Œçš„urlå‚æ•°
</span><span style="color:#6272a4"></span>    } <span style="color:#ff79c6">else</span> {
      url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;urlå‚æ•°ä¸ºç©º&#34;</span>;
    }
    <span style="color:#8be9fd;font-style:italic">document</span>.write(<span style="color:#f1fa8c">&#39;url: &lt;a href=&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&gt;&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&lt;/a&gt;&#39;</span>); 
    <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;test&#34;</span>).innerHTML <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;æˆ‘çš„urlæ˜¯: &lt;a href=&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&gt;&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&lt;/a&gt;&#39;</span>;
  &lt;/<span style="color:#ff79c6">script</span>&gt;
&lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>é¡µé¢æ¸²æŸ“å®Œæˆåï¼Œç‚¹å‡»å¼¹çª—å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231742177-474046373.png" alt="img"></p>
<p><strong>ä½¿ç”¨location/location.href/location.replace/iframe.src é€ æˆçš„XSS</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
&lt;<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">charset</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">utf-8</span>&gt;
  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;referrer&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;never&#34;</span>&gt;
  &lt;<span style="color:#ff79c6">title</span>&gt;&lt;/<span style="color:#ff79c6">title</span>&gt;
&lt;/<span style="color:#ff79c6">head</span>&gt;
&lt;<span style="color:#ff79c6">body</span>&gt;
  &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>&gt;
    <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> location.search;
    s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;?url=javascript:alert(&#39;xsstest&#39;)&#34;</span>;
    s <span style="color:#ff79c6">=</span> s.substring(<span style="color:#bd93f9">1</span>, s.length);       <span style="color:#6272a4">// è¿”å›æ•´ä¸ªæŸ¥è¯¢å†…å®¹
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">var</span> url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;                       <span style="color:#6272a4">// å®šä¹‰å˜é‡url
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">if</span> (s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) {       <span style="color:#6272a4">// åˆ¤æ–­URLæ˜¯å¦ä¸ºç©º 
</span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">var</span> pos <span style="color:#ff79c6">=</span> s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">4</span>;  <span style="color:#6272a4">// è¿‡æ»¤æ‰&#34;url=&#34;å­—ç¬¦
</span><span style="color:#6272a4"></span>      url <span style="color:#ff79c6">=</span> s.substring(pos, s.length);  <span style="color:#6272a4">// å¾—åˆ°åœ°å€æ é‡Œçš„urlå‚æ•°
</span><span style="color:#6272a4"></span>    } <span style="color:#ff79c6">else</span> {
      url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;urlå‚æ•°ä¸ºç©º&#34;</span>;
    }
  &lt;/<span style="color:#ff79c6">script</span>&gt;
  &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;test&#39;</span>&gt;&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>&gt;&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
  &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>&gt;
    location.href <span style="color:#ff79c6">=</span> url;
  &lt;/<span style="color:#ff79c6">script</span>&gt;
&lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>åˆ·æ–°ä¸‹é¡µé¢ï¼Œä¹Ÿä¼šå¼¹å‡ºçª—å£æ‰§è¡Œ xssæ”»å‡»äº†ã€‚</p>
</blockquote>
<h3 id="3-xssæ”»å‡»çš„é˜²èŒƒ">3. XSSæ”»å‡»çš„é˜²èŒƒ</h3>
<h4 id="1-csp">1. CSP</h4>
<ul>
<li>CSPæ˜¯å†…å®¹å®‰å…¨ç­–ç•¥ï¼›</li>
<li>CSPå°±æ˜¯ä¸€ä¸ªæŠŠç™½åå•ï¼šç½‘ç«™é€šè¿‡å‘é€ä¸€ä¸ª CSP å¤´éƒ¨å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªç½‘ç«™ä»€ä¹ˆæ˜¯è¢«å¯ä»¥æ‰§è¡Œçš„ï¼Œä»€ä¹ˆæ˜¯éœ€è¦è¢«ç¦æ­¢çš„ã€‚</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬åªéœ€è¦åœ¨metaå±æ€§ä¸­è®¾ç½®ä¸‹å³å¯ï¼šå¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">http-equiv</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Content-Security-Policy&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>æ¯”å¦‚å¦‚ä¸‹çš„åˆ—å­ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">http-equiv</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Content-Security-Policy&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;
</span><span style="color:#f1fa8c">default-src http: https:  *.xxx.com &#39;self&#39; &#39;unsafe-inline&#39; ;
</span><span style="color:#f1fa8c">style-src &#39;self&#39; &#39;unsafe-inline&#39; *.yyy.com;
</span><span style="color:#f1fa8c">script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; ;
</span><span style="color:#f1fa8c">&#34;</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p><strong>contentä¸‹æœ‰å¦‚ä¸‹ç±»åˆ«ï¼š</strong></p>
<p>default-src ç»™ä¸‹é¢æ‰€æœ‰çš„è§„åˆ™è®¾å®šä¸€ä¸ªé»˜è®¤å€¼
script-src å¤–éƒ¨è„šæœ¬
style-src æ ·å¼è¡¨
img-src å›¾åƒ
media-src åª’ä½“æ–‡ä»¶ï¼ˆéŸ³é¢‘å’Œè§†é¢‘ï¼‰
font-src å­—ä½“æ–‡ä»¶
object-src æ’ä»¶ï¼ˆæ¯”å¦‚ Flashï¼‰
child-src æ¡†æ¶
frame-ancestors åµŒå…¥çš„å¤–éƒ¨èµ„æºï¼ˆæ¯”å¦‚ã€<code>&lt;iframe&gt;</code>ã€å’Œï¼‰
connect-src HTTP è¿æ¥ï¼ˆé€šè¿‡ XHRã€WebSocketsã€EventSourceç­‰ï¼‰
worker-src workerè„šæœ¬
manifest-src manifest æ–‡ä»¶</p>
<p><strong>script-srcæœ‰å¦‚ä¸‹å±æ€§å€¼ï¼š</strong></p>
<p>unsafe-inline å…è®¸æ‰§è¡Œé¡µé¢å†…åµŒçš„<code>&lt;script&gt;</code>æ ‡ç­¾å’Œäº‹ä»¶ç›‘å¬å‡½æ•°
unsafe-eval å…è®¸å°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ‰§è¡Œï¼Œæ¯”å¦‚ä½¿ç”¨evalã€setTimeoutã€setIntervalå’ŒFunctionç­‰å‡½æ•°
nonce æ¯æ¬¡HTTPå›åº”ç»™å‡ºä¸€ä¸ªæˆæƒtokenï¼Œé¡µé¢å†…åµŒè„šæœ¬å¿…é¡»æœ‰è¿™ä¸ªtokenï¼Œæ‰ä¼šæ‰§è¡Œ
hash åˆ—å‡ºå…è®¸æ‰§è¡Œçš„è„šæœ¬ä»£ç çš„Hashå€¼ï¼Œé¡µé¢å†…åµŒè„šæœ¬çš„å“ˆå¸Œå€¼åªæœ‰å»åˆçš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ‰§è¡Œ</p>
</blockquote>
<h4 id="2-cookieå®‰å…¨ç­–ç•¥">2. cookieå®‰å…¨ç­–ç•¥</h4>
<ul>
<li>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„è„šæœ¬è·å–ç”¨æˆ·çš„ Cookie ä¿¡æ¯ã€‚é€šå¸¸ Cookie ä¸­éƒ½åŒ…å«äº†ç”¨æˆ·çš„ç™»å½•å‡­è¯ä¿¡æ¯ï¼›</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>http-only:</strong></p>
<p>åªå…è®¸httpæˆ–httpsè¯·æ±‚è¯»å–cookieã€JSä»£ç æ˜¯æ— æ³•è¯»å–cookieçš„(document.cookieä¼šæ˜¾ç¤ºhttp-onlyçš„cookieé¡¹è¢«è‡ªåŠ¨è¿‡æ»¤æ‰)ã€‚å‘é€è¯·æ±‚æ—¶è‡ªåŠ¨å‘é€cookie.</p>
</li>
<li>
<p><strong>secure-only:</strong></p>
<p>åªå…è®¸httpsè¯·æ±‚è¯»å–ï¼Œå‘é€è¯·æ±‚æ—¶è‡ªåŠ¨å‘é€cookieã€‚</p>
</li>
<li>
<p><strong>host-only:</strong></p>
<p>åªå…è®¸ä¸»æœºåŸŸåä¸domainè®¾ç½®å®Œæˆä¸€è‡´çš„ç½‘ç«™æ‰èƒ½è®¿é—®è¯¥cookieã€‚</p>
</li>
</ul>
</blockquote>
<h4 id="3-è¾“å…¥æ£€æŸ¥">3. è¾“å…¥æ£€æŸ¥</h4>
<ul>
<li>ä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„ä»»ä½•è¾“å…¥ã€‚ å¯¹äºç”¨æˆ·çš„ä»»ä½•è¾“å…¥è¦è¿›è¡Œæ£€æŸ¥ã€è¿‡æ»¤å’Œè½¬ä¹‰ï¼›</li>
<li>å»ºç«‹å¯ä¿¡ä»»çš„å­—ç¬¦å’Œ HTML æ ‡ç­¾ç™½åå•ï¼Œå¯¹äºä¸åœ¨ç™½åå•ä¹‹åˆ—çš„å­—ç¬¦æˆ–è€…æ ‡ç­¾è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ï¼›</li>
<li>æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸­æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ï¼Œä¹Ÿç§°ä¸º XSS Filterï¼›</li>
<li>åœ¨ä¸€äº›å‰ç«¯æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä»½ decodingMapï¼Œ ç”¨äºå¯¹ç”¨æˆ·è¾“å…¥æ‰€åŒ…å«çš„ç‰¹æ®Šå­—ç¬¦æˆ–æ ‡ç­¾è¿›è¡Œç¼–ç æˆ–è¿‡æ»¤ã€‚</li>
</ul>
<h4 id="4-è¾“å‡ºæ£€æŸ¥">4. è¾“å‡ºæ£€æŸ¥</h4>
<ul>
<li>ç”¨æˆ·çš„è¾“å…¥ä¼šå­˜åœ¨é—®é¢˜ï¼ŒæœåŠ¡ç«¯çš„è¾“å‡ºä¹Ÿä¼šå­˜åœ¨é—®é¢˜ï¼›</li>
<li>åœ¨å˜é‡è¾“å‡ºåˆ° HTML é¡µé¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç æˆ–è½¬ä¹‰çš„æ–¹å¼æ¥é˜²å¾¡ XSS æ”»å‡»ã€‚</li>
</ul>
<blockquote>
<p><strong>HTMLç¼–ç </strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#6272a4">// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°htmlç¼–ç 
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">function</span> htmlEncodeByRegExp(str) {
  <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
  <span style="color:#ff79c6">if</span> (str.length <span style="color:#ff79c6">===</span> <span style="color:#bd93f9">0</span>) {
    <span style="color:#ff79c6">return</span> s;
  }
  <span style="color:#ff79c6">return</span> (s <span style="color:#ff79c6">+</span> str)
    .replace(<span style="color:#f1fa8c">/&amp;/g</span>, <span style="color:#f1fa8c">&#34;&amp;amp;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/&lt;/g</span>, <span style="color:#f1fa8c">&#34;&amp;lt;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/&gt;/g</span>, <span style="color:#f1fa8c">&#34;&amp;gt;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/ /g</span>, <span style="color:#f1fa8c">&#34;&amp;nbsp;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/\&#39;/g</span>, <span style="color:#f1fa8c">&#34;&amp;#39&#34;</span>)
    .replace(<span style="color:#f1fa8c">/\&#34;/g</span>, <span style="color:#f1fa8c">&#34;&amp;quot;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/\//g</span>, <span style="color:#f1fa8c">&#39;&amp;#x2F;&#39;</span>);
}
<span style="color:#6272a4">// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°htmlè§£ç 
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">function</span> htmlDecodeByRegExp(str) {
  <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
  <span style="color:#ff79c6">if</span> (str.length <span style="color:#ff79c6">===</span> <span style="color:#bd93f9">0</span>) {
    <span style="color:#ff79c6">return</span> s;
  }
  <span style="color:#ff79c6">return</span> (s <span style="color:#ff79c6">+</span> str)
    .replace(<span style="color:#f1fa8c">/&amp;amp;/g</span>, <span style="color:#f1fa8c">&#34;&amp;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/&amp;lt;/g</span>, <span style="color:#f1fa8c">&#34;&lt;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/&amp;gt;/g</span>, <span style="color:#f1fa8c">&#34;&gt;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/&amp;nbsp;/g</span>, <span style="color:#f1fa8c">&#34; &#34;</span>)
    .replace(<span style="color:#f1fa8c">/&amp;#39/g</span>, <span style="color:#f1fa8c">&#34;\&#39;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/&amp;quot;/g</span>, <span style="color:#f1fa8c">&#34;\&#34;&#34;</span>)
    .replace(<span style="color:#f1fa8c">/&amp;#x2F;/g</span>, <span style="color:#f1fa8c">&#34;\/&#34;</span>);
}
</code></pre></td></tr></table>
</div>
</div><p><strong>HTML Attributeç¼–ç </strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8be9fd;font-style:italic">function</span> encodeForHTMLAttibute(str) {
  <span style="color:#8be9fd;font-style:italic">let</span> encoded <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
  <span style="color:#ff79c6">for</span>(<span style="color:#8be9fd;font-style:italic">let</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> str.length; i<span style="color:#ff79c6">++</span>) {
    <span style="color:#8be9fd;font-style:italic">let</span> ch <span style="color:#ff79c6">=</span> hex <span style="color:#ff79c6">=</span> str[i];
    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span><span style="color:#f1fa8c">/[A-Za-z0-9]/</span>.test(str[i]) <span style="color:#ff79c6">&amp;&amp;</span> str.charCodeAt(i) <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">256</span>) {
      hex <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&amp;#x&#39;</span> <span style="color:#ff79c6">+</span> ch.charCodeAt(<span style="color:#bd93f9">0</span>).toString(<span style="color:#bd93f9">16</span>) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;;&#39;</span>;
    }
    encoded <span style="color:#ff79c6">+=</span> hex;
  }
  <span style="color:#ff79c6">return</span> encoded;
};
</code></pre></td></tr></table>
</div>
</div><p><strong>URL ç¼–ç </strong></p>
<p>å°†ä¸å¯ä¿¡æ•°æ®ä½œä¸º URL å‚æ•°å€¼æ—¶éœ€è¦å¯¹å‚æ•°è¿›è¡Œ URL ç¼–ç </p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8be9fd;font-style:italic">function</span> encodeForURL(str){
  <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">encodeURIComponent</span>(str);
};
</code></pre></td></tr></table>
</div>
</div></blockquote>
<h4 id="5-css-ç¼–ç ">5. CSS ç¼–ç </h4>
<ul>
<li>å°†ä¸å¯ä¿¡æ•°æ®ä½œä¸º CSS æ—¶è¿›è¡Œ CSS ç¼–ç ï¼›</li>
</ul>
<blockquote>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">style</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;background-image: url(javascript:alert(&#39;xss&#39;));&#34;</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
&lt;<span style="color:#ff79c6">style</span>&gt;<span style="color:#ff79c6">body</span>{<span style="color:#ff79c6">background-image</span>: <span style="color:#8be9fd;font-style:italic">url</span>(<span style="color:#f1fa8c">&#34;javascript:alert(&#39;xss&#39;)&#34;</span>);}&lt;/<span style="color:#ff79c6">style</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>ç¼–ç è§„åˆ™ï¼šé™¤äº†å­—æ¯æ•°å­—å­—ç¬¦ä»¥å¤–ï¼Œä½¿ç”¨\XXXXXXæ ¼å¼æ¥è½¬ä¹‰ASCIIå€¼å°äº256çš„æ‰€æœ‰å­—ç¬¦ã€‚ ç¼–ç ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8be9fd;font-style:italic">function</span> encodeForCSS (attr, str){
  <span style="color:#8be9fd;font-style:italic">let</span> encoded <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
  <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">let</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> str.length; i<span style="color:#ff79c6">++</span>) {
    <span style="color:#8be9fd;font-style:italic">let</span> ch <span style="color:#ff79c6">=</span> str.charAt(i);
    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ch.match(<span style="color:#f1fa8c">/[a-zA-Z0-9]/</span>) {
      <span style="color:#8be9fd;font-style:italic">let</span> hex <span style="color:#ff79c6">=</span> str.charCodeAt(i).toString(<span style="color:#bd93f9">16</span>);
      <span style="color:#8be9fd;font-style:italic">let</span> pad <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;000000&#39;</span>.substr((hex.length));
      encoded <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;\\&#39;</span> <span style="color:#ff79c6">+</span> pad <span style="color:#ff79c6">+</span> hex;
    } <span style="color:#ff79c6">else</span> {
      encoded <span style="color:#ff79c6">+=</span> ch;
    }
  }
  <span style="color:#ff79c6">return</span> encoded;
};
</code></pre></td></tr></table>
</div>
</div></blockquote>
<h3 id="4-csrfæ”»å‡»">4. CSRFæ”»å‡»</h3>
<ul>
<li>CSRFï¼ŒCross Site Request Forgeryï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ï¼Œæ˜¯ä¸€ç§åŠ«æŒå—ä¿¡ä»»ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€éé¢„æœŸè¯·æ±‚çš„æ”»å‡»æ–¹å¼ï¼›</li>
<li>æ”»å‡»è€…å€ŸåŠ©å—å®³è€…çš„ Cookie éª—å–æœåŠ¡å™¨çš„ä¿¡ä»»ï¼Œåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä»¥å—å®³è€…åä¹‰ä¼ªé€ è¯·æ±‚å‘é€ç»™å—æ”»å‡»æœåŠ¡å™¨ã€‚</li>
</ul>
<p><strong>1. æµè§ˆå™¨çš„ Cookie ç­–ç•¥</strong></p>
<ul>
<li>
<p>Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šï¼›</p>
</li>
<li>
<p>Cookie ç»å¸¸ç”¨åœ¨ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰ï¼›</p>
</li>
<li>
<p>æµè§ˆå™¨æ‰€æŒæœ‰çš„ Cookie åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>Session Cookie(ä¼šè¯æœŸ Cookie)ï¼Œä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆï¼Œæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼›</li>
<li>Permanent Cookie(æŒä¹…æ€§ Cookie)ï¼Œ å¯ä»¥æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„è¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆMax-Ageï¼‰ï¼›</li>
</ul>
</li>
<li>
<p>æ¯ä¸ª Cookie éƒ½ä¼šæœ‰å…³è”çš„åŸŸï¼Œè¿™ä¸ªåŸŸçš„èŒƒå›´ä¸€èˆ¬é€šè¿‡ donmain å±æ€§æŒ‡å®šï¼›</p>
</li>
<li>
<p>å¦‚æœ Cookie çš„åŸŸå’Œé¡µé¢çš„åŸŸç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™ä¸ª Cookie ä¸ºç¬¬ä¸€æ–¹ Cookieï¼›</p>
</li>
<li>
<p>å¦‚æœ Cookie çš„åŸŸå’Œé¡µé¢çš„åŸŸä¸åŒï¼Œåˆ™ç§°ä¹‹ä¸ºç¬¬ä¸‰æ–¹ Cookieï¼›</p>
</li>
<li>
<p>ä¸€ä¸ªé¡µé¢åŒ…å«å›¾ç‰‡æˆ–å­˜æ”¾åœ¨å…¶ä»–åŸŸä¸Šçš„èµ„æºï¼ˆå¦‚å›¾ç‰‡ï¼‰æ—¶ï¼Œç¬¬ä¸€æ–¹çš„ Cookie ä¹Ÿä¼šå‘é€ç»™è®¾ç½®å®ƒä»¬çš„æœåŠ¡å™¨ã€‚</p>
</li>
</ul>
<p><strong>2. é€šè¿‡ Cookie è¿›è¡Œ CSRF æ”»å‡»</strong></p>
<ul>
<li>å­˜åœ¨ç½‘ç«™a.comï¼Œç™»é™†åa.comå·²ç»ä¿å­˜äº†Cookieï¼›</li>
<li>ä¼ªé€ ä¸€ä¸ªæ”»å‡»è€…ç½‘ç«™ï¼Œç½‘ç«™å†…æ”¾ç½®ä¸€ä¸ªå›¾ç‰‡imgï¼ŒsrcæŒ‡å‘äº†ä¸€ä¸ªa.comçš„è¯·æ±‚a.com/delete?id=1ï¼›</li>
<li>å½“aè·³è½¬åˆ°b.comæ—¶ï¼Œå°±ä¼šå‘èµ·srcä¸­çš„è¯·æ±‚ï¼Œä¸”æºå¸¦äº†è‡ªå·±çš„Cookieï¼›</li>
<li>a.comçš„æœåŠ¡å™¨æ¥åˆ°äº†è¯·æ±‚ï¼Œä»¥ä¸ºæ˜¯ç½‘é¡µè‡ªå·±ä¸»åŠ¨å‘å‡ºçš„ï¼Œå°±æ‰§è¡Œäº†è¯·æ±‚ã€‚</li>
</ul>
<h3 id="5-csrfçš„é˜²èŒƒ">5. CSRFçš„é˜²èŒƒ</h3>
<h4 id="1-éªŒè¯-http-referer-å­—æ®µ">1. éªŒè¯ HTTP Referer å­—æ®µ</h4>
<ul>
<li>HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œå®ƒè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ï¼›</li>
<li>é˜²å¾¡ CSRF æ”»å‡»ï¼Œåªéœ€è¦å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚éªŒè¯å…¶ Referer å€¼ï¼ŒéªŒè¯è¯¥è¯·æ±‚æ˜¯æ¥è‡ªç½‘ç«™è‡ªå·±çš„è¯·æ±‚ï¼Œ</li>
</ul>
<h4 id="2-åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ -token">2. åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ  token</h4>
<ul>
<li>CSRF æ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºå¯ä»¥å®Œå…¨ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­æ‰€æœ‰çš„ç”¨æˆ·éªŒè¯ä¿¡æ¯éƒ½æ˜¯å­˜åœ¨äº cookie ä¸­ï¼›</li>
<li>æŠµå¾¡ CSRFï¼Œå…³é”®åœ¨äºåœ¨è¯·æ±‚ä¸­æ”¾å…¥é»‘å®¢æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯ä¸å­˜åœ¨äº cookie ä¹‹ä¸­ï¼›</li>
<li>åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯æ‹¦æˆªéªŒè¯ï¼Œå¦‚æœæ²¡æœ‰ token æˆ–å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™æ‹’ç»ã€‚</li>
</ul>

      </div>
      <div class="footer">
        <span><a class="category" href="https://gaoshanwomeng.github.io/%20categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a><a class="category" href="https://gaoshanwomeng.github.io/%20categories/%E7%B2%BE%E9%80%89/">ç²¾é€‰</a></span>
        <span><a class="tag" href="https://gaoshanwomeng.github.io/%20tags/xss/">#xss</a><a class="tag" href="https://gaoshanwomeng.github.io/%20tags/csrf/">#csrf</a></span>
        
      </div>
    </div>

    <ul class="menu">
    <li class="menu-item">
        <a href="https://gaoshanwomeng.github.io/" id="back-btn">
            <i class="iconfont icon-home item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <a href="javascript:void(0);" id="back-top-btn">
            <i class="iconfont icon-top item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <a href="javascript:void(0);" id="switch-btn">
            <i class="iconfont icon-switch item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <a href="javascript:void(0);" id="search-btn">
            <i class="iconfont icon-search item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://gaoshanwomeng.github.io/post/js-promise%E8%AF%A6%E8%A7%A3/" data-tooltip="js promiseè¯¦è§£">
            <i class="iconfont icon-left item-btn"></i>
            
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://gaoshanwomeng.github.io/post/webpack%E5%92%8Cbable%E7%9A%84%E5%85%B3%E7%B3%BB/" data-tooltip="webpackå’Œbableçš„å…³ç³»">
            <i class="iconfont icon-right item-btn"></i>
            
        </a>
    </li>
</ul>

  </div>
</div>

<div class="search-container animated fadeInShow">
    <input type="search" class="docsearch-input search-input" placeholder="æœç´¢å…³é”®è¯" />
    <div  id="loading" class="loading-container">
        <span>æœç´¢ä¸­...</span>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
    docsearch({
        apiKey: 'f7f9aeb8485880cfd0e747129ea4ddf9',
        indexName: 'blogsearch',
        appId: 'SGIZDO9IMB',
        inputSelector: '.docsearch-input',
        debug: true,
        algoliaOptions: {
            hitsPerPage: 50
        },
        
        
        
        queryHook: (query) => {
            $('#loading').css('display', 'flex');
        },
        transformData: (tips) => {
            $('#loading').css('display', 'none');
        }
    })
</script>
        <div class="cover animated fadeInShow"></div>
    </body>



<script type="text/javascript" src="https://gaoshanwomeng.github.io/js/util.min.92a28685458d59fc79b8c7254cecd2c876e55c35445733dd86c829decab54c810890b94d4a0dd4377dae40dce147cef363dc3bf0d6d9d68dbddcf55a071a5d61.js" integrity=""></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-168042857-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></html>
