<!DOCTYPE html>
<html lang="zh-cn" data-theme="light"><head>
    <meta name="google-site-verification" content="kw1N-Xm6qEr1c9PGuRd0U_T6DXkw_EHsLyz5LpuDDv8" />
    <meta name="msvalidate.01" content="EE98205D30806C22C519683EFC53E9BA" />
    <meta name="baidu-site-verification" content="iPC3wUcQLL" />
    <title>  计算计网络 域名与dns详解 </title>
    <meta charset="utf-8" /><meta name="generator" content="Hugo 0.74.3" /><meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta name="description" itemprop="description"
        content=" 计算计网络 域名与dns详解 " />
    <meta name="keywords" itemprop="keywords"
        content=" [dns 域名] " />
    <base href="https://tomtomyoung.top/">
    <link rel="shortcut icon" href="https://tomtomyoung.top/favicons//favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tomtomyoung.top/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tomtomyoung.top/favicons/favicon-16x16.png">
    <link rel="canonical" href="https://tomtomyoung.top/post/%E8%AE%A1%E7%AE%97%E8%AE%A1%E7%BD%91%E7%BB%9C-%E5%9F%9F%E5%90%8D%E4%B8%8Edns%E8%AF%A6%E8%A7%A3/">
    <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_2450869_iypnqhtzjei.css">
    
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="https://tomtomyoung.top/css/style.min.5378f5b61459716a78220cda416b91726b056d130ac93d0153f6ab3f7efe48e8.css" integrity="" type="text/css">
</head><body class="animated fadeInDown">
<div class="main"><div class="percentage_container">
    <div class="percentage" id="percentage"></div>
</div><div class="toc sub-container">
    <div class="toc-header">
        <span>目录</span>
    </div><ul class="toc-h2"><li>
                    <span class="toc-link">1. 域名</span>
                </li>
                
                        <ul class="toc-h3"><li>
                    <span class="toc-link">1. 域名的层级</span>
                </li>
                
                        </ul><li>
                    <span class="toc-link">2. DNS</span>
                </li>
                
                        <ul class="toc-h3"><li>
                    <span class="toc-link">1. 概念</span>
                </li>
                <li>
                    <span class="toc-link">2. DNS服务器</span>
                </li>
                <li>
                    <span class="toc-link">3. DNS服务器组织结构</span>
                </li>
                <li>
                    <span class="toc-link">4. DNS查询过程</span>
                </li>
                <li>
                    <span class="toc-link">5. 递归查询和迭代查询</span>
                </li>
                <li>
                    <span class="toc-link">6. DNS缓存</span>
                </li>
                
                        </ul><li>
                    <span class="toc-link">3. DNS反向查询</span>
                </li>
                
                        <ul class="toc-h3"><li>
                    <span class="toc-link">1. 概念</span>
                </li>
                <li>
                    <span class="toc-link">2. 使用场景</span>
                </li>
                
                        </ul><li>
                    <span class="toc-link">4. DNS故障排查</span>
                </li>
                
                        <ul class="toc-h3"><li>
                    <span class="toc-link">1. 故障原因</span>
                </li>
                <li>
                    <span class="toc-link">2. 排查工具</span>
                </li>
                <li>
                    <span class="toc-link">3. 故障排查</span>
                </li>
                </div><div class="single-post container">
    <div class="post">
      <div class="header">
        <span class="title">计算计网络 域名与dns详解</span>
        
        <div class="info">
          <span>📅 2021-08-12</span>
          <span>👦 Tomtom Young</span>
          <span>📖 5189字</span>
          <span>⏱ 11分钟</span>
        </div>
        
      </div>
      <div class="content markdown-body">
        <blockquote>
<p>参考：</p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/DNS">MDN DNS</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2016/06/dns.html">DNS 原理入门</a></p>
<p><a href="https://www.cloudflare.com/zh-cn/learning/dns/what-is-dns/">what-is-dns</a></p>
<p><a href="https://juejin.cn/post/6844903895903240206">工程师最容易搞错的域名知识</a></p>
<p><a href="https://blog.csdn.net/liaowenxiong/article/details/106881601">域名层级划分</a></p>
<p><a href="https://blog.csdn.net/m0_37263637/article/details/85157611">域名分级与域名解析过程(DNS)</a></p>
</blockquote>
<h2 id="1-域名">1. 域名</h2>
<h3 id="1-域名的层级">1. 域名的层级</h3>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/20181226220924440.PNG" alt="在这里插入图片描述"></p>
<ul>
<li>
<p>根域名<code>.root</code>对于所有域名都是一样的，所以平时是省略的；</p>
<blockquote>
<ul>
<li>根服务器主要用来管理互联网的主目录；</li>
<li>全世界IPv4根服务器只有13台（这13台IPv4根域名服务器名字分别为“A”至“M”）；</li>
<li>1个为主根服务器在美国，其余12个均为辅根服务器；</li>
<li>其中9个在美国，欧洲2个，位于英国和瑞典，亚洲1个位于日本。</li>
</ul>
</blockquote>
</li>
<li>
<p>顶级域名（top-level domain，缩写为TLD），比如<code>.com</code>、<code>.net</code>；</p>
<blockquote>
<ul>
<li>
<p>.com</p>
<p>用于商业机构。它是最常见的顶级域名。任何人都可以注册.COM 形式的域名。也是目前全球最流行的域名后缀，注册量早已破亿。</p>
</li>
<li>
<p>.net</p>
<p>是国际上广泛流行的通用域名，一般用于从事Internet相关的网络服务的机构或公司，是建立全球商业品牌，国际化形象的第一选择。最初是用于网络组织，例如因特网服务商和维修商，现在任何人都可以注册以.net结尾的域名。</p>
</li>
<li>
<p>.cn</p>
<p>.cn代表中国，是具有中国独特标识的域名。当前.cn域名在全球具有最大的市场。</p>
</li>
</ul>
</blockquote>
</li>
<li>
<p>二级域名（second-level domain，缩写为SLD），比如<code>www.example.com</code>里面的<code>.example</code>，这一级域名是用户可以注册的；</p>
</li>
<li>
<p>三级域名（主机名host），比如<code>www.example.com</code>里面的<code>www</code>，又称为&quot;三级域名&rdquo;，这是用户在自己的域里面为服务器分配的名称，是用户可以任意分配的。</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>主机名.次级域名.顶级域名.根域名
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>host.sld.tld.root
</code></pre></div><blockquote>
<p>举个例子：</p>
<ol>
<li><code>baidu.com</code> 二级域名，<code>www.baidu.com</code> 三级域名，<code>bbs.baidu.com</code> 三级域名，<code>tieba.baidu.com</code> 三级域名</li>
<li><code>https://www.taobao.com</code> 是一个网址，域名是 <code>www.taobao.com</code>，<code>.com</code> 是顶级域名，<code>taobao.com</code> 是二级域名，<code>www.taobao.com</code> 是三级域名</li>
</ol>
</blockquote>
<h2 id="2-dns">2. DNS</h2>
<h3 id="1-概念">1. 概念</h3>
<p>DNS (Domain Name System) 域名系统，维护着一个包含域名与对应资源例如IP地址的列表。</p>
<h3 id="2-dns服务器">2. DNS服务器</h3>
<p>DNS服务器是指管理域名的主机和相应的软件。</p>
<h3 id="3-dns服务器组织结构">3. DNS服务器组织结构</h3>
<p>对应着域名的分级树形结构，DNS的服务器体系也是树形结构：</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/20190307120658954.png" alt="img"></p>
<h3 id="4-dns查询过程">4. DNS查询过程</h3>
<p>DNS服务器怎么会知道每个域名的IP地址呢？答案是分级查询。</p>
<p>DNS服务器根据域名的层级，进行分级查询。</p>
<p>需要明确的是，每一级域名都有自己的NS记录，NS记录指向该级域名的域名服务器。这些服务器知道下一级域名的各种记录。</p>
<p>所谓&quot;分级查询&rdquo;，就是从根域名开始，依次查询每一级域名的NS记录，直到查到最终的IP地址，过程大致如下。</p>
<blockquote>
<ol>
<li>从&quot;根域名服务器&quot;查到&quot;顶级域名服务器&quot;的NS记录和A记录（IP地址）</li>
<li>从&quot;顶级域名服务器&quot;查到&quot;次级域名服务器&quot;的NS记录和A记录（IP地址）</li>
<li>从&quot;次级域名服务器&quot;查出&quot;主机名&quot;的IP地址</li>
</ol>
</blockquote>
<p>仔细看上面的过程，你可能发现了，没有提到DNS服务器怎么知道&quot;根域名服务器&quot;的IP地址。回答是&quot;根域名服务器&quot;的NS记录和IP地址一般是不会变化的，所以内置在DNS服务器里面。</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/v2-4e2336ee745138e5947c07ae57cbdb5c_720w.jpg" alt="img"></p>
<p>在实际场景中，DNS解析的过程大约分为以下几步：</p>
<ol>
<li>
<p>浏览器缓存</p>
<p>浏览器会缓存DNS记录一段时间。</p>
</li>
<li>
<p>系统缓存</p>
<p>如果在浏览器缓存里没有找到需要的记录，浏览器会做一个系统调用（windows里是gethostbyname）。这样便可获得系统缓存中的记录。这里也可以是hosts缓存</p>
</li>
<li>
<p>路由器缓存</p>
<p>前面的查询请求发向路由器，它一般会有自己的DNS缓存。</p>
</li>
<li>
<p>ISP缓存的本地DNS服务器</p>
<p>接下来要检索的就是ISP缓存DNS的服务器。在这一般都能找到相应的缓存记录。
前面所有步骤没有缓存的情况下，本地 DNS 服务器会将请求转发到互联网上的根域，你的ISP的DNS服务器从根域名服务器开始进行搜索；</p>
</li>
<li>
<p>根域名服务器</p>
<p>全球仅有13台根域名服务器，1个主根域名服务器，其余12为辅根域名服务器。根域名收到请求后会查看区域文件记录，若无则将其管辖范围内顶级域名（如.com）服务器IP告诉本地DNS服务器；</p>
</li>
<li>
<p>顶级域名服务器</p>
<p>顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器的IP地址告诉本地DNS服务器；</p>
</li>
<li>
<p>二级域名服务器</p>
<p>主域名服务器接受到请求后查询自己的缓存，如果没有则进入下一级域名服务器进行查找，并重复该步骤直至找到正确纪录；把IP地址告诉本地DNS服务器。</p>
</li>
<li>
<p>保存结果至缓存</p>
<p>本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端，客户端通过这个IP地址与web服务器建立链接。</p>
</li>
</ol>
<h3 id="5-递归查询和迭代查询">5. 递归查询和迭代查询</h3>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/858807-20170820124445615-743355102.png" alt="img"></p>
<p><strong>主机向本地域名服务器的查询一般都是采用递归查询</strong>。</p>
<p>所谓递归查询就是：</p>
<p>如果主机所询问的本地域名服务器不知道被查询的域名的IP地址，那么本地域名服务器就以DNS客户的身份，向其根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。</p>
<p><strong>本地域名服务器向根域名服务器的查询的迭代查询</strong>。</p>
<p>迭代查询的特点：</p>
<p>当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的IP地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。</p>
<p>然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的IP地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。</p>
<p>顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的IP地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。</p>
<p>最后，知道了所要解析的IP地址或报错，然后把这个结果返回给发起查询的主机；</p>
<blockquote>
<p>迭代查询和递归查询</p>
<ol>
<li>迭代查询：“王老师让学生自己去问张老师”，学生多次查询出结果；</li>
<li>递归查询：“王老师问了张老师，然后把答案告诉学生”，学生一次查询出结果；</li>
</ol>
</blockquote>
<h3 id="6-dns缓存">6. DNS缓存</h3>
<p>DNS记录会有一个TTL值(time to live)，单位是秒，意思是这个记录最大有效期是多少。操作系统缓存会参考ttl值，但是不完全等于TTL值，而浏览器DNS缓存的时间跟TTL值无关，每种浏览器都使用一个固定值。</p>
<p><strong>浏览器DNS缓存</strong></p>
<p>浏览器在获取网站域名的实际IP地址后会对其IP进行缓存，减少网络请求的损耗。</p>
<p>每种浏览器都有一个固定的DNS缓存时间，如Chrome的过期时间是1分钟，在这个期限内不会重新请求DNS。</p>
<p>在Chrome地址栏中输入chrome://net-internals/#dns 就可以看各域名的DNS 缓存时间。默认，Chrome对每个域名会默认缓存60s：</p>
<h2 id="3-dns反向查询">3. DNS反向查询</h2>
<h3 id="1-概念-1">1. 概念</h3>
<p>反向解析：根据IP地址查找对应的注册域名，经常被一些后台程序使用,用户看不到。</p>
<p>对于一个IP地址，很有可能不存在反向的映射。而事实上很多IP地址就没有对应的域名。</p>
<h3 id="2-使用场景">2. 使用场景</h3>
<ul>
<li>
<p>最初用途</p>
<p>进行网络故障排除，网站跟踪用户（特别是在Internet论坛上）等。</p>
</li>
<li>
<p>电子邮件反垃圾邮件技术</p>
<p>检查rDNS中的域名是否可能来自拨号用户，或动态分配的地址不太可能被合法邮件服务器使用。这些IP地址的所有者通常会为其分配通用的rDNS名称，例如“1-2-3-4-dynamic-ip.example.com”。一些反垃圾邮件过滤器假设来自这些地址的电子邮件可能是垃圾邮件，并可能拒绝连接。</p>
</li>
<li>
<p>系统日志记录/监视工具</p>
<p>系统日志记录或监视工具通常会接收仅由IP地址指定的相关设备的条目。为了提供更多可用的数据，这些程序通常在写入日志之前执行反向查找，从而写入名称而不是IP地址。</p>
</li>
</ul>
<h2 id="4-dns故障排查">4. DNS故障排查</h2>
<h3 id="1-故障原因">1. 故障原因</h3>
<p>DNS不能解析的常见原因有：</p>
<ol>
<li>域名本身已经过期或被停止；</li>
<li>域名的DNS服务器记录不正确；</li>
<li>域名的DNS服务器记录本身没有作解析；</li>
<li>域名的DNS服务器上named服务没有启动；</li>
<li>域名的DNS服务器上未解析；</li>
<li>域名的多个DNS服务器上的解析不一致；</li>
<li>域名的DNS服务器网络设置禁止了53端口TCP/UDP协议；</li>
<li>本地DNS cache未更新，与DNS服务器上的记录不同步</li>
</ol>
<h3 id="2-排查工具">2. 排查工具</h3>
<p>判断DNS故障的常用工具有：</p>
<ul>
<li>
<p>nslookup</p>
<p>windows/linux/unix支持</p>
</li>
<li>
<p>whois</p>
<p>unix/linux支持</p>
</li>
<li>
<p>dig</p>
<p>unix/linux支持</p>
</li>
<li>
<p>ping</p>
<p>windows/linux/unix支持</p>
</li>
</ul>
<h3 id="3-故障排查">3. 故障排查</h3>
<p><strong>1.判断与解决域名本身已经过期或被停止。</strong></p>
<p>通过whois查询。</p>
<p>linux shell下运行：<code>whois baidu.com</code> 会返回：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>  Domain Name: BAIDU.COM
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>   Registry Domain ID: 11181110_DOMAIN_COM-VRSN
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>   Registrar WHOIS Server: whois.markmonitor.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>   Registrar URL: http://www.markmonitor.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>   Updated Date: 2020-12-09T04:04:41Z
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>   Creation Date: 1999-10-11T11:05:17Z
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>   Registry Expiry Date: 2026-10-11T11:05:17Z
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>   Registrar: MarkMonitor Inc.
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>   Registrar IANA ID: <span style="color:#bd93f9">292</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>   Registrar Abuse Contact Email: abusecomplaints@markmonitor.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>   Registrar Abuse Contact Phone: +1.2083895740
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>   Domain Status: clientDeleteProhibited https://icann.org/epp#clientDeleteProhibited
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>   Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>   Domain Status: clientUpdateProhibited https://icann.org/epp#clientUpdateProhibited
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>   Domain Status: serverDeleteProhibited https://icann.org/epp#serverDeleteProhibited
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>   Domain Status: serverTransferProhibited https://icann.org/epp#serverTransferProhibited
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>   Domain Status: serverUpdateProhibited https://icann.org/epp#serverUpdateProhibited
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>   Name Server: NS1.BAIDU.COM
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>   Name Server: NS2.BAIDU.COM
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>   Name Server: NS3.BAIDU.COM
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>   Name Server: NS4.BAIDU.COM
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>   Name Server: NS7.BAIDU.COM
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>   DNSSEC: unsigned
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>   URL of the ICANN Whois Inaccuracy Complaint Form: https://www.icann.org/wicf/
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>&gt;&gt;&gt; Last update of whois database: 2021-08-12T13:11:57Z <span style="color:#ff79c6">&lt;&lt;&lt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>For more information on Whois status codes, please visit https://icann.org/epp
</code></pre></div><p><strong>2.判断与解决域名的DNS服务器记录不正确。</strong></p>
<p>使用nslookup（交互式） 或 dig（非交互式） 工具可以判断域名的DNS服务器记录正确与否。</p>
<p><code>dig www.baidu.com </code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>; &lt;&lt;&gt;&gt; DiG 9.16.1-Ubuntu &lt;&lt;&gt;&gt; www.baidu.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>;; global options: +cmd
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>;; Got answer:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>;; -&gt;&gt;HEADER<span style="color:#f1fa8c">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span style="color:#bd93f9">41128</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>;; flags: qr rd ra ad; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: <span style="color:#bd93f9">0</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>;; QUESTION SECTION:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>;www.baidu.com.                 IN      A
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>;; ANSWER SECTION:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>www.baidu.com.          <span style="color:#bd93f9">84</span>      IN      A       110.242.68.3
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>www.baidu.com.          <span style="color:#bd93f9">84</span>      IN      A       110.242.68.4
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>;; Query time: <span style="color:#bd93f9">5</span> msec
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>;; SERVER: 192.168.124.1#53<span style="color:#ff79c6">(</span>192.168.124.1<span style="color:#ff79c6">)</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>;; WHEN: Thu Aug <span style="color:#bd93f9">12</span> 21:17:11 DST <span style="color:#bd93f9">2021</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>;; MSG SIZE  rcvd: <span style="color:#bd93f9">63</span>
</code></pre></div><p><code> nslookup &gt; server www.baidu.com</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>&gt; server www.baidu.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>默认服务器:  www.a.shifen.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>Addresses:  110.242.68.4
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>          110.242.68.3
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>Aliases:  www.baidu.com  
</code></pre></div><p>如果只有Question，没有Answer，或者Answer不对，一般就是有问题。</p>
<p>关于dig与nslookup的用法及参数或命令，请自己查询相关手册文档。</p>
<p><strong>3.判断与解决域名的DNS服务器记录本身没有作解析</strong></p>
<p>依据DNS体系架构，域名的DNS服务器记录是一组主机名且它们必须要在Internic注册之后，才能用于域名注册。</p>
<p>注册之后，通过whois能够查到，而且在互联网根服务器上会为注册的DNS服务器作解析。</p>
<p>如上面的5iops.com为例，它的dns服务器为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>Domain servers in listed order:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>ns3.google.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>ns1.google.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>ns4.google.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>ns2.google.com
</code></pre></div><p>这些都可以通过whois以及dig @a.gtld-servers.net查到。</p>
<p>为确保可靠，所有注册过的DNS服务器，同时也应在它本身的域名服务器上作A纪录的解析。</p>
<p>否则，有的客户端可能不能正常工作。即ns1.google.COM本身在其自身的DNS服务器上也作了解析。</p>
<p>若注册了自己的DNS服务器，但没有为DNS服务器做解析，有可能会出现解析不稳定的情况。</p>
<p><strong>4.判断与解决域名的DNS服务器上named服务没有启动</strong></p>
<p>可通过dig或nslookup，如果返回no servers could be reached，那么基本可以断定named服务没有启动或者到nmed服务器的网络不通。</p>
<p>比如：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>dig @kkk.com kkk.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>; &lt;&lt;&gt;&gt; DiG 9.2.3 &lt;&lt;&gt;&gt; @kkk.com kkk.com
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>;; global options: printcmd
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>;; connection timed out; no servers could be reached
</code></pre></div><p>再登录上named服务器，使用<code>netstat -na|grep LISTEN</code>看看53端口是否仍然存在或<code>ps -ef|grep named</code>查看named进程是否存在。有可能是named服务异常退出了。</p>
<p><strong>5.判断与解决域名的DNS服务器上未解析</strong></p>
<p><del>登陆到域名的DNS服务器上，执行：<code>dig @localhost www.5iops.com</code></del></p>
<p><del>如果没有结果，可以看<code>/etc/named.conf</code>中有没有该域名的记录，以及记录中的zone文件是否存在，如果都存在，可以执行程序代码：<code>rndc reload 5iops.com </code>，然后执行：<code>tail /var/log/messages </code>，看log中有没有报错，有没有zone文件格式的问题。</del></p>
<p><strong>6.判断与解决域名的多个DNS服务器上的解析不一致</strong></p>
<p><del>依次查询该域名的每个DNS服务器，看结果是否一致。</del></p>
<p><del>在所有的服务器中，如果有的服务器没有返回结果，不会影响到域名的正常解析，因为此时解析客户端会尝试其他的服务器，只有当所有的服务器都没有结果才会报错。但是如果A服务器上和B服务器上的解析不一致，则会出现域名解析时对时不对的故障。</del></p>
<p><del>dig @ns1.google.com <a href="http://www.5iops.com">www.5iops.com</a></del></p>
<p><del>dig @ns2.google.com <a href="http://www.5iops.com">www.5iops.com</a></del></p>
<p><del>如果不一致，通常是服务器之间的同步问题。</del></p>
<p><del>不过，现在大型的互联网内容服务端，一般一个域名会对应有多个IP，很多情况下是不一样的:)这个问题的解决当然是需要同步或者修改为一致啦。</del></p>
<p><strong>7.判断与解决域名的DNS服务器网络设置是否正确</strong></p>
<p><del>可以从其他机器分别以tcp和udp协议连接，如：<code>dig +tcp @ns1.google.com 5iops.com</code>及<code>dig +notcp @ns1.google.com 5iops.com </code>，如果不能连接，而且服务器上named服务已经启动，多半是软件或硬件防火墙的原因。</del></p>
<p><del>在服务器上检查/etc/sysconfig/ipchains或 iptable中是否允许domain（53端口）的tcp及udp连接。或暂时停止ipchains/iptable服务，看外部是否能够连接。如果软件防火墙配置正确或根本未启动，则检查硬件防火墙有没有打开53端口。</del></p>
<p><del>现在多数DNS服务器为安全起见，都会关闭53端口的TCP连接。</del></p>
<p><strong>8.判断与解决本地DNS cache未更新</strong></p>
<p>可以查出域名的DNS服务器，检查这些服务器上解析是否正确，如果服务器上正确，而本地解析不正确，则说明使用的本地DNS服务器没有刷新，需要等到它刷新之后。</p>
<p>通常需要4到12个小时左右。如果需要快速解决，可以重启本地DNS服务器的NAMED服务。</p>
<p>本客户机也可能有DNS缓存，一般使用下面方法进行清DNS缓存：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>windows:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>ipconfig /flushdns
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span>linux:
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span>service nscd stop
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span>service nscd start
</code></pre></div>
      </div>
      <div class="footer">
        <span><a class="category" href="https://tomtomyoung.top/%20categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><a class="category" href="https://tomtomyoung.top/%20categories/%E7%B2%BE%E9%80%89/">精选</a></span>
        <span><a class="tag" href="https://tomtomyoung.top/%20tags/dns/">dns</a><a class="tag" href="https://tomtomyoung.top/%20tags/%E5%9F%9F%E5%90%8D/">域名</a></span>
      </div>
    </div>

    <ul class="menu">
    <li class="menu-item">
        <i class="iconfont icon-top item-btn" id="back_top_btn"></i>
    </li>
    <li class="menu-item">
        <a href="https://tomtomyoung.top/" id="back-btn">
            <i class="iconfont icon-home item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-switch item-btn" id="switch_btn"></i>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-search item-btn" id="search_btn"></i>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/js-%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8/" data-tooltip="js 迭代器与生成器">
            <i class="iconfont icon-left item-btn"></i>
            
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-http%E8%AF%B7%E6%B1%82%E4%B8%8E%E5%93%8D%E5%BA%94%E8%AF%A6%E8%A7%A3/" data-tooltip="计算机网络 http请求与响应详解">
            <i class="iconfont icon-right item-btn"></i>
            
        </a>
    </li>
</ul>

  </div>
</div>

<div class="cover" id="cover">
        <div class="search-container">
    <input type="search" class="docsearch-input search-input" placeholder="搜索关键词" />
    <div id="loading" class="loading-container"></div>
</div>
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
    var searchLoading = document.querySelector('#loading');

    docsearch({
        apiKey: 'f7f9aeb8485880cfd0e747129ea4ddf9',
        indexName: 'blogsearch',
        appId: 'SGIZDO9IMB',
        inputSelector: '.docsearch-input',
        debug: true,
        algoliaOptions: {
            hitsPerPage: 50
        },
        
        
        
        queryHook: query => {
            if (!!searchLoading) {
                searchLoading.innerHTML = '查询中';
                searchLoading.classList.add('show');
            }
        },
        transformData: tips => {
            if (!!searchLoading && tips instanceof Array && tips.length > 0) {
                searchLoading.innerHTML = '';
                searchLoading.classList.remove('show');
            } else {
                searchLoading.innerHTML = '没有结果';
                searchLoading.classList.add('show');
            }
        }
    });
</script>
    </div>
</body>






<script type="text/javascript" src="https://tomtomyoung.top/js/util.min.81898d6a244851004145f1b697282d711d450cd465598c7d1f1e6945f83344b6729293d34682bda992f6b7bc0adaf63cb6e8a78e4f0774992c9504eb373cf308.js" integrity=""></script></html>