<!DOCTYPE html>
<html lang="zh-cn" data-theme="light"><head>
    <meta name="google-site-verification" content="kw1N-Xm6qEr1c9PGuRd0U_T6DXkw_EHsLyz5LpuDDv8" />
    <meta name="msvalidate.01" content="EE98205D30806C22C519683EFC53E9BA" />
    <meta name="baidu-site-verification" content="iPC3wUcQLL" />
    <title>  react æ‰‹å†™react16.xç»„ä»¶æ¸²æŸ“ </title>
    <meta charset="utf-8" /><meta name="generator" content="Hugo 0.74.3" /><meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta name="description" itemprop="description"
        content=" react æ‰‹å†™react16.xç»„ä»¶æ¸²æŸ“ " />
    <meta name="keywords" itemprop="keywords"
        content=" [react æ‰‹å†™] " />
    <base href="https://tomtomyoung.top/">

    
    <link rel="shortcut icon" href="https://tomtomyoung.top/favicons//favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tomtomyoung.top/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tomtomyoung.top/favicons/favicon-16x16.png">
    <link rel="mask-icon" href="https://tomtomyoung.top/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="apple-touch-icon" sizes="180x180" href="https://tomtomyoung.top/favicons/apple-touch-icon.png">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="msapplication-TileImage" content="https://tomtomyoung.top/favicons/mstile-144x144.png">
    <link rel="manifest" href="https://tomtomyoung.top/manifest.json">

    <link rel="canonical" href="https://tomtomyoung.top/post/react-%E6%89%8B%E5%86%99react16.x%E7%BB%84%E4%BB%B6%E6%B8%B2%E6%9F%93/">
    <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_2450869_iypnqhtzjei.css">
    
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="https://tomtomyoung.top/css/style.min.css" integrity="" type="text/css">
    
    
    <script type="text/javascript" src="https://tomtomyoung.top/js/docsearch.min.js" integrity=""></script>
</head><body class="animated fadeInDown">
<div class="main"><div class="percentage_container">
    <div class="percentage" id="percentage"></div>
</div><div class="toc sub-container">
    <div class="toc-header">
        <span>ç›®å½•</span>
    </div><ul class="toc-h2"><li>
                <span class="toc-link">1. æ­å»ºé¡¹ç›®</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. åˆå§‹åŒ–é¡¹ç›®</span>
            </li>
            <li>
                <span class="toc-link">2. å®šä¹‰ç›®å½•ç»“æ„</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">2. index.js</span>
            </li>
            <li>
                <span class="toc-link">3. createElement</span>
            </li>
            <li>
                <span class="toc-link">4. render</span>
            </li>
            <li>
                <span class="toc-link">5. æ—¶é—´åˆ‡ç‰‡ä¸Fiber</span>
            </li>
            <li>
                <span class="toc-link">6. æ€»ç»“</span>
            </li>
            </div><div class="single-post container">
    <div class="post">
      <div class="header">
        <span class="title">react æ‰‹å†™react16.xç»„ä»¶æ¸²æŸ“</span>
        
        <div class="info">
          <span>ğŸ“… 2021-09-10</span>
          <span>ğŸ‘¦ Tomtom Young</span>
          <span>ğŸ“– 3128å­—</span>
          <span>â± 7åˆ†é’Ÿ</span>
        </div>
        
      </div>
      <div class="content markdown-body">
        <blockquote>
<p>å‚è€ƒï¼š</p>
<p><a href="https://cdmana.com/2021/08/20210825153526307k.html">8æœˆæ›´æ–‡æŒ‘æˆ˜ï½œreactæ‰‹å†™å®ç°æ¸²æŸ“JSXæ™®é€šç‰ˆ</a></p>
<p><a href="https://jelly.jd.com/article/60aceb6b27393b0169c85231">æ‰‹å†™ä¸€ä¸ªç®€å•çš„ React</a></p>
<p><a href="https://juejin.cn/post/6854573219682942983">æ‰‹å†™ä¸€ä¸ªreactç³»åˆ—ï¼ˆä¸€ï¼‰ï¼šå®ç°reactå’Œreact-dom</a></p>
<p><a href="https://github.com/YuetTusi/my-react">æ‰‹å†™ react æ ¸å¿ƒæºç </a></p>
<p><a href="https://www.bilibili.com/video/BV1qt4y1Y77R?from=search&amp;seid=8422079651592355486&amp;spm_id_from=333.337.0.0">é¢è¯•è£…ä¸äº†é€¼ï¼Ÿå½“åœºæ‰‹å†™ä¸ªreact16.xæ¡†æ¶ç»™ä»–çœ‹çœ‹</a></p>
</blockquote>
<h2 id="1-æ­å»ºé¡¹ç›®">1. æ­å»ºé¡¹ç›®</h2>
<h3 id="1-åˆå§‹åŒ–é¡¹ç›®">1. åˆå§‹åŒ–é¡¹ç›®</h3>
<p>æˆ‘ä»¬éœ€è¦åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„webpacké¡¹ç›®ï¼Œç”¨æ¥ç¼–å†™æˆ‘ä»¬è‡ªå·±çš„ React ï¼Œä¸€æ¬¡æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<p>åˆå§‹åŒ–é¡¹ç›®</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>npm init
</code></pre></div><p>å®‰è£…webpackå’Œwebpack-dev-serverï¼Œå¦‚æœè¿™é‡Œå¾ˆé™Œç”Ÿï¼Œå¯ä»¥çœ‹å¦ä¸€ç¯‡æ–‡ç« ï¼šã€Šjs webpackç®€ä»‹ã€‹</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>npm i webpack webpack-cli webpack-dev-server
</code></pre></div><p>å®‰è£…html-webpack-pluginï¼Œç”¨æ¥æŒ‡å®šé™æ€é¡µé¢<code>index.html</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>npm i html-webpack-plugin
</code></pre></div><p>å®‰è£…babelå„ç§æ’ä»¶ï¼Œç”¨æ¥æ”¯æŒJSXè¯­æ³•ï¼Œè¿™é‡Œå¦‚æœä¸ç†è§£ï¼Œå¯ä»¥çœ‹å¦ä¸€ç¯‡æ–‡ç« ï¼šã€Šreact JSXè¯¦è§£ã€‹</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>npm i @babel/core @babel/plugin-transform-react-jsx babel-loader
</code></pre></div><p>æœ€ç»ˆ<code>package.json</code>ï¼Œå¤§æ¦‚é•¿è¿™æ ·ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#ff79c6">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;my-react&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#ff79c6">&#34;version&#34;</span>: <span style="color:#f1fa8c">&#34;1.0.0&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#ff79c6">&#34;description&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  <span style="color:#ff79c6">&#34;main&#34;</span>: <span style="color:#f1fa8c">&#34;index.js&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  <span style="color:#ff79c6">&#34;scripts&#34;</span>: {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#ff79c6">&#34;build&#34;</span>: <span style="color:#f1fa8c">&#34;webpack&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    <span style="color:#ff79c6">&#34;dev&#34;</span>: <span style="color:#f1fa8c">&#34;webpack-dev-server&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  <span style="color:#ff79c6">&#34;author&#34;</span>: <span style="color:#f1fa8c">&#34;&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  <span style="color:#ff79c6">&#34;license&#34;</span>: <span style="color:#f1fa8c">&#34;ISC&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  <span style="color:#ff79c6">&#34;devDependencies&#34;</span>: {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    <span style="color:#ff79c6">&#34;@babel/core&#34;</span>: <span style="color:#f1fa8c">&#34;^7.14.6&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    <span style="color:#ff79c6">&#34;@babel/plugin-transform-react-jsx&#34;</span>: <span style="color:#f1fa8c">&#34;^7.14.5&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>    <span style="color:#ff79c6">&#34;babel-loader&#34;</span>: <span style="color:#f1fa8c">&#34;^8.2.2&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>    <span style="color:#ff79c6">&#34;webpack&#34;</span>: <span style="color:#f1fa8c">&#34;^5.40.0&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>    <span style="color:#ff79c6">&#34;webpack-dev-server&#34;</span>: <span style="color:#f1fa8c">&#34;^3.11.2&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>  },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>  <span style="color:#ff79c6">&#34;dependencies&#34;</span>: {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    <span style="color:#ff79c6">&#34;html-webpack-plugin&#34;</span>: <span style="color:#f1fa8c">&#34;^5.3.2&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    <span style="color:#ff79c6">&#34;webpack-cli&#34;</span>: <span style="color:#f1fa8c">&#34;^3.3.12&#34;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>}
</code></pre></div><p>é…ç½®webpackï¼š</p>
<p><code>webpack.config.js</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">const</span> path <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;path&#39;</span>),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>      HtmlWebpackPlugin <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;html-webpack-plugin&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>module.exports <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  entry<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;./src/index.js&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  output<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    filename<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;bundle.js&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    path<span style="color:#ff79c6">:</span> path.resolve(__dirname, <span style="color:#f1fa8c">&#39;dist&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  resolve<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    modules<span style="color:#ff79c6">:</span> [path.resolve(__dirname, <span style="color:#f1fa8c">&#39;&#39;</span>), path.resolve(__dirname, <span style="color:#f1fa8c">&#39;node_modules&#39;</span>)]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  module<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    rules<span style="color:#ff79c6">:</span> [
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>      {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>        test<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">/\.js$/</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>        use<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>          loader<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;babel-loader&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    ]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>  plugins<span style="color:#ff79c6">:</span> [
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>    <span style="color:#ff79c6">new</span> HtmlWebpackPlugin({ 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>      title<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;my-react-app&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>      template<span style="color:#ff79c6">:</span> path.resolve(__dirname, <span style="color:#f1fa8c">&#39;public/index.html&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>  ],
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>  devServer<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>    open<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">true</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>}
</code></pre></div><p>é…ç½®babelï¼š</p>
<p><code>.babelrc</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>{
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>    <span style="color:#f1fa8c">&#34;plugins&#34;</span><span style="color:#ff79c6">:</span> [<span style="color:#f1fa8c">&#34;@babel/plugin-transform-react-jsx&#34;</span>]
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>}
</code></pre></div><h3 id="2-å®šä¹‰ç›®å½•ç»“æ„">2. å®šä¹‰ç›®å½•ç»“æ„</h3>
<p>æˆ‘ä»¬éœ€è¦æ•´ç†ç›®å½•ç»“æ„ï¼Œå½¢æˆè¿™æ ·çš„ç›®å½•ç»“æ„ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/20210906221953.jpg" alt=""></p>
<p>å…¶ä¸­çš„<code>src/index.js</code>ã€<code>src/react</code>ã€<code>src/react-dom</code>å°±æ˜¯æˆ‘ä»¬ä¸»è¦çš„å·¥ä½œç›®å½•ã€‚</p>
<h2 id="2-indexjs">2. index.js</h2>
<p>æˆ‘ä»¬å…ˆåœ¨<code>index.js</code>ä¸­å†™ä¸€äº›æˆ‘ä»¬å¸¸ç”¨çš„Reactä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-jsx" data-lang="jsx"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">const</span> ReactDOM <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;./react-dom&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">const</span> React <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;./react&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#ff79c6">class</span> SubComponent <span style="color:#ff79c6">extends</span> React.Component {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  constructor(props) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    <span style="color:#ff79c6">super</span>(props);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  componentWillMount() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    console.log(<span style="color:#f1fa8c">&#34;subComponent will mount&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  componentDidMount() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    console.log(<span style="color:#f1fa8c">&#34;subComponent did mount&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  render() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>    <span style="color:#ff79c6">return</span> (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>      &lt;<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>        &lt;<span style="color:#ff79c6">h1</span>&gt;subComponent&lt;/<span style="color:#ff79c6">h1</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>      &lt;/<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span style="color:#ff79c6">class</span> Counter <span style="color:#ff79c6">extends</span> React.Component {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  constructor(props) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>    <span style="color:#ff79c6">super</span>(props);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    <span style="color:#ff79c6">this</span>.state <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>      name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;xiaoming&#39;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>  componentWillMount() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>    console.log(<span style="color:#f1fa8c">&#34;will&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>  componentDidMount() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>    console.log(<span style="color:#f1fa8c">&#34;did&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>  render() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>    <span style="color:#ff79c6">const</span> { name } <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.state;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>    <span style="color:#ff79c6">return</span> (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>      &lt;<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>        &lt;<span style="color:#ff79c6">h1</span>&gt;hello, react&lt;/<span style="color:#ff79c6">h1</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span>        &lt;<span style="color:#ff79c6">button</span>&gt;å“ˆå“ˆå“ˆ&lt;/<span style="color:#ff79c6">button</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>        &lt;<span style="color:#ff79c6">h2</span>&gt;{name}&lt;/<span style="color:#ff79c6">h2</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>        &lt;<span style="color:#ff79c6">SubComponent</span>/&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>      &lt;/<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>    )
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>ReactDOM.render(&lt;<span style="color:#ff79c6">Counter</span>/&gt;, <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;root&#34;</span>));
</code></pre></div><p>æˆ‘ä»¬åœ¨<code>index.js</code>ä¸­åšäº†è¿™ä¹ˆå‡ ä»¶äº‹ï¼š</p>
<ol>
<li>æˆ‘ä»¬å¯¼å…¥äº†<code>react</code>å’Œ<code>react-dom</code>ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>ReactDom.render</code>å’Œ<code>React.creatElement</code>æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¿…é¡»åœ¨å¯¹åº”çš„ä½ç½®å®šä¹‰å¥½ï¼›</li>
<li>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±»å¼ç»„ä»¶ï¼Œç»§æ‰¿äº†<code>React.Component</code>ç±»ï¼Œå¹¶ä¸”ä½¿ç”¨<code>&lt;Counter/&gt;</code>åˆå§‹åŒ–äº†ä¸€ä¸ªç»„ä»¶å®ä¾‹ï¼›</li>
</ol>
<blockquote>
<p>è¿™é‡Œ<code>&lt;Counter/&gt;</code>ç»è¿‡Babelå¯¹JSXçš„å¤„ç†ï¼Œä¼šè½¬æ¢ä¸º<code>React.createElement(Counter, null)</code>ï¼›</p>
</blockquote>
<p>æ ¹æ®æˆ‘ä»¬çš„æ“ä½œæˆ‘ä»¬æ¥æ„æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å“ªäº›åŠŸèƒ½ï¼š</p>
<ol>
<li><code>ReactDom.render</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ¹ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ ¹ç»„ä»¶æŒ‚è½½çš„èŠ‚ç‚¹ï¼›</li>
<li><code>React.creatElement</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—è‡³å°‘ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹ç±»å‹ï¼Œå¯èƒ½æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°æˆ–ç±»ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹çš„å±æ€§ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä½™å‚æ•°æ˜¯èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œå¤§æ¦‚æœ‰å¦‚ä¸‹å‡ ç§æƒ…å†µï¼š
<ol>
<li><code>React.createElement(&quot;h1&quot;, null, &quot;hello, react&quot;)</code>ï¼ŒèŠ‚ç‚¹ç±»å‹æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ²¡æœ‰å‚æ•°ï¼Œå­èŠ‚ç‚¹å°±æ˜¯é‡Œé¢åŒ…è£¹çš„å†…å®¹ï¼›</li>
<li><code>React.createElement(&quot;h1&quot;, { id: 'container' }, &quot;hello, react&quot;)</code>ï¼ŒèŠ‚ç‚¹ä¸Šæœ‰å±æ€§<code>id</code>ï¼›</li>
<li><code>React.createElement(Counter, null)</code>ï¼ŒèŠ‚ç‚¹ç±»å‹æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°æˆ–è€…ç±»ï¼Œéœ€è¦newï¼›</li>
<li><code>React.createElement(&quot;h1&quot;, null, React.createElement(&quot;h1&quot;, null, &quot;hello, react&quot;))</code>ï¼ŒèŠ‚ç‚¹æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼›</li>
<li><code>React.createElement(&quot;h1&quot;, null, React.createElement(&quot;h1&quot;, null, &quot;hello, react&quot;), React.createElement(&quot;h1&quot;, null, &quot;hello, react&quot;))</code>ï¼ŒèŠ‚ç‚¹æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼›</li>
</ol>
</li>
</ol>
<h2 id="3-createelement">3. createElement</h2>
<p>å¯¹äºReactå¯¹è±¡ï¼Œæˆ‘ä»¬ç›´æ¥å…ˆæ¥å®ç°æœ€åŸºç¡€çš„<code>createElement</code>å‡½æ•°ã€‚</p>
<p><code>react/element.js</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4">/**
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"> * @description åˆ›å»ºvDOM
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#6272a4"> * @param  type å…ƒç´ ç±»å‹
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#6272a4"> * @param  props å±æ€§å¯¹è±¡
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#6272a4"> * @param  {Array} children å­å…ƒç´ é›†åˆ
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#6272a4"> */</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#8be9fd;font-style:italic">function</span> createElement(type, props, ...children) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  <span style="color:#ff79c6">return</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    type,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    props,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    children<span style="color:#ff79c6">:</span> children.map(child =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>      <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">typeof</span> child <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;string&#39;</span> <span style="color:#ff79c6">?</span> 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>        createTextElement(child)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>        <span style="color:#ff79c6">:</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>        child
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>    })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#8be9fd;font-style:italic">function</span> createTextElement(textStr) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>  <span style="color:#ff79c6">return</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>    type<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#39;TEXT_ELEMENT&#39;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>    props<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>      nodeValue<span style="color:#ff79c6">:</span> textStr
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>    },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>    children<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">null</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span style="color:#ff79c6">export</span> <span style="color:#ff79c6">default</span> createElement;
</code></pre></div><p>è¿™ä¸ªè¯´å®è¯æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œåªæ˜¯åˆæ­¥å®šä¹‰äº†èŠ‚ç‚¹çš„æ ¼å¼ï¼ŒåŒ…æ‹¬<code>type</code>ã€<code>props</code>ã€<code>children</code>ï¼Œè¿™æ˜¯ä½¿ç”¨JSXå¸¦æ¥çš„å¿…ç„¶è¦æ±‚ï¼Œæˆ–è€…è¯´æˆ‘ä»¬ä¹¦å†™çš„ JSX å…¶å®æœ¬è´¨å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„elementå¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡å®šä¹‰<code>createElement</code>æ¥å®šä¹‰elementçš„æ ¼å¼ã€‚</p>
<p>å¦å¤–è¦æ³¨æ„çš„çš„æ˜¯ï¼Œè‡ªå®šä¹‰ç»„ä»¶çš„å¯¹è±¡è¿˜æ²¡æœ‰å®ä¾‹åŒ–ï¼Œç»„ä»¶çš„<code>render</code>å‡½æ•°ä¹Ÿæ²¡æœ‰è°ƒç”¨ï¼Œå› æ­¤åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè‡ªå®šä¹‰ç»„ä»¶çš„ element å¯¹è±¡ä¸ç»„ä»¶å†…éƒ¨<code>render</code>è¿”å›çš„çš„ JSX element å¯¹è±¡æ˜¯æ²¡æœ‰å…³è”çš„ï¼Œè¿™ä¹ˆè¯´å¯èƒ½ä¸å¥½ç†è§£ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å°±æ˜ç™½äº†ï¼š</p>
<p><code>index.js</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-jsx" data-lang="jsx"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>console.log(&lt;<span style="color:#ff79c6">Counter</span>/&gt;);
</code></pre></div><p>å¯¹äºè¿™æ ·çš„ç»„ä»¶ï¼Œæˆ‘ä»¬æ‰“å°<code>&lt;Counter/&gt;</code>ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/image-20210907210744684.png" alt="image-20210907210744684"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¹¶æ²¡æœ‰<code>children</code>ï¼Œä½†æ˜¯<code>render</code>å‡½æ•°å†…éƒ¨çš„<code>div</code>å’Œå…¶å­èŠ‚ç‚¹<code>h1</code>ç­‰å…¶å®æ˜¯æœ‰å…³ç³»çš„ï¼Œè¿™æ˜¯å› ä¸º<code>Counter</code>æ˜¯ä¸€ä¸ªç±»å¼ç»„ä»¶ï¼Œä¼ å…¥<code>&lt;Counter/&gt;</code>ä¼šè¢«Babelç¼–è¯‘æˆ<code>React.createElement(Counter, null)</code>ï¼Œå¿…é¡»å®ä¾‹åŒ–å¹¶ä¸”è°ƒç”¨renderå‡½æ•°ï¼Œæ‰èƒ½æ‹¿åˆ°é‡Œé¢çš„JSXå…ƒç´ ã€‚ä½†æ˜¯è¿™äº›å¤„ç†ä¸æ˜¯ç°åœ¨æ‰§è¡Œçš„ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬å®šä¹‰çš„<code>createElement</code>å‡½æ•°æ˜æ˜¾ä¸æ˜¯ç»™æˆ‘ä»¬è‡ªå·±ç”¨çš„ï¼Œè€Œæ˜¯ç»™ JSX ä½¿ç”¨çš„ï¼Œå› æ­¤åªè´Ÿè´£å¤„ç†æ•°æ®æ ¼å¼ï¼Œè€Œä¸è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè¿™é‡Œçš„ element èŠ‚ç‚¹æ˜¯ JSX æ ‡ç­¾çš„çœŸå®é¢è²Œï¼Œä¹Ÿæ˜¯ React ä¸­å¤§åé¼é¼çš„ VirtualDOM ã€‚</p>
<p>element çš„ç»“æ„æ˜¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/image-20210909112211371.png" alt="image-20210909112211371"></p>
<p>ç›®å‰æˆ‘ä»¬çš„ VirtualDOM æ ‘å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>ä¸Šå›¾ä¸­æœ‰é¢œè‰²çš„èŠ‚ç‚¹ï¼Œæ˜¯è‡ªå®šä¹‰ç»„ä»¶çš„èŠ‚ç‚¹ï¼Œéœ€è¦è°ƒç”¨renderå‡½æ•°ï¼Œæ‰èƒ½å½¢æˆä¸‹é¢çš„èŠ‚ç‚¹ï¼›</li>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯è™šæ‹ŸèŠ‚ç‚¹ï¼Œæ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„çœŸå® dom èŠ‚ç‚¹ä¸€ä¸€å¯¹åº”ï¼›</li>
</ol>
<h2 id="4-render">4. render</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#8be9fd;font-style:italic">function</span> createDOM(element){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#8be9fd;font-style:italic">let</span> eleWithDOM;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#ff79c6">if</span>(element.type <span style="color:#ff79c6">instanceof</span> <span style="color:#8be9fd;font-style:italic">Function</span>){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    <span style="color:#8be9fd;font-style:italic">let</span> elecConstructor <span style="color:#ff79c6">=</span> element.type;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#8be9fd;font-style:italic">let</span> obj <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> elecConstructor();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    eleWithDOM <span style="color:#ff79c6">=</span> createDOM(obj.render());
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  } <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">typeof</span> element.type <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;string&#39;</span>){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    <span style="color:#6272a4">// åˆ›å»ºdom
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">let</span> dom;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    <span style="color:#ff79c6">if</span>(element.type <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;TEXT_ELEMENT&#39;</span>){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>      dom <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.createTextNode(<span style="color:#f1fa8c">&#39;&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    } <span style="color:#ff79c6">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>      dom <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.createElement(element.type)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>    <span style="color:#6272a4">// æŒ‚è½½å±æ€§
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>element.props){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>      <span style="color:#8be9fd;font-style:italic">Object</span>.keys(element.props).forEach(prop =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>        dom[prop] <span style="color:#ff79c6">=</span> element.props[prop];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>      })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    <span style="color:#6272a4">// å¤„ç†children
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">let</span> children <span style="color:#ff79c6">=</span> [];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>    <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>element.children <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!!</span>element.children.length) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>      children <span style="color:#ff79c6">=</span> element.children.map(child =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>        <span style="color:#8be9fd;font-style:italic">let</span> childEleWithDOM <span style="color:#ff79c6">=</span> createDOM(child);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>        <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>dom <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!!</span>childEleWithDOM.dom){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>          dom.append(childEleWithDOM.dom);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>        }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>        <span style="color:#ff79c6">return</span> childEleWithDOM;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>      })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>    <span style="color:#6272a4">// å½¢æˆFiber
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span style="color:#6272a4"></span>    eleWithDOM <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>      ...element,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>      dom,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>      children
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>  <span style="color:#ff79c6">return</span> eleWithDOM;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span><span style="color:#8be9fd;font-style:italic">function</span> render(element, container){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>  <span style="color:#6272a4">// elementçš„æ ¼å¼å‚è§ createElement
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>element <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!!</span>container){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>    <span style="color:#8be9fd;font-style:italic">let</span> eleWithDOM <span style="color:#ff79c6">=</span> createDOM(element);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>    <span style="color:#6272a4">// console.log(eleWithDOM);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span><span style="color:#6272a4"></span>    container.append(eleWithDOM.dom);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span><span style="color:#8be9fd;font-style:italic">let</span> ReactDOM <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>  render
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span>};
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span><span style="color:#ff79c6">export</span> <span style="color:#ff79c6">default</span> ReactDOM;
</code></pre></div><p>åœ¨ render ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å¾ˆç®€å•çš„æ“ä½œï¼š</p>
<ol>
<li>å°†æ ¹ element é€’å½’çš„åˆ›å»ºå’ŒæŒ‚è½½ dom ï¼ˆé€’å½’çš„æ·±åº¦ä¼˜å…ˆéå†ï¼‰ï¼›</li>
<li>å°†æ ¹ element çš„domå…ƒç´ ï¼ŒæŒ‚è½½åˆ°å®¹å™¨ä¸Šï¼›</li>
</ol>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬çš„ element å…ƒç´ å°±å¯ä»¥åœ¨é¡µé¢ä¸Šçœ‹åˆ°äº†ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/image-20210909110501558.png" alt="image-20210909110501558"></p>
<p>ç»è¿‡è¿™ä¸€å±‚æ“ä½œï¼Œä¸Šé¢çš„ VirtualDOM æ ‘å˜æˆäº†è¿™æ ·ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/image-20210909112935483.png" alt="image-20210909112935483"></p>
<p>è¿™æ ·ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå† render ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨é€’å½’çš„æ·±åº¦ä¼˜å…ˆéå†ï¼Œä¸€æ¬¡å®Œæˆäº†domçš„åˆ›å»ºå’ŒæŒ‚è½½ï¼Œå¦‚æœèŠ‚ç‚¹å¾ˆå¤šï¼Œ<code>createDOM</code>å‡½æ•°å°±ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´</p>
<h2 id="5-æ—¶é—´åˆ‡ç‰‡ä¸fiber">5. æ—¶é—´åˆ‡ç‰‡ä¸Fiber</h2>
<p>å…³äºä»€ä¹ˆæ˜¯æ—¶é—´åˆ‡ç‰‡ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨æ—¶é—´åˆ‡ç‰‡æ€æƒ³ï¼Œåœ¨ã€Šreact æ—¶é—´åˆ‡ç‰‡ä¸requestIdleCallbackè¯¦è§£ã€‹ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚</p>
<p>å…³äºä»€ä¹ˆæ˜¯Fiberï¼Œä¸ºä»€ä¹ˆä½¿ç”¨Fiberï¼Œä»¥åŠFiberçš„ç»“æ„ï¼Œåœ¨ã€Šreact Fiberè¯¦è§£ã€‹ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨å¦‚ä½•ç”¨ä»£ç å®ç°æ—¶é—´åˆ‡ç‰‡æœºåˆ¶ï¼Œä»¥åŠå¦‚ä½•å°† element è½¬æ¢ä¸º Fiber è¿›è¡Œå·¥ä½œã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">import</span> Component from <span style="color:#f1fa8c">&#34;../react/component&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#8be9fd;font-style:italic">function</span> handleClassElement(element) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#ff79c6">if</span>(element.type.__proto__ <span style="color:#ff79c6">==</span> Component){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#8be9fd;font-style:italic">let</span> eleConstructor <span style="color:#ff79c6">=</span> element.type;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    <span style="color:#8be9fd;font-style:italic">let</span> eleObj <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> eleConstructor();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#ff79c6">return</span> eleObj.render();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>  } <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> (element.type <span style="color:#ff79c6">instanceof</span> <span style="color:#8be9fd;font-style:italic">Function</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    <span style="color:#ff79c6">return</span> element.type();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  } <span style="color:#ff79c6">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    <span style="color:#ff79c6">return</span> element;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#8be9fd;font-style:italic">function</span> createDOM(element){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>    <span style="color:#8be9fd;font-style:italic">let</span> dom;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>    <span style="color:#ff79c6">if</span>(element.type <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;TEXT_ELEMENT&#39;</span>){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>      dom <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.createTextNode(<span style="color:#f1fa8c">&#39;&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    } <span style="color:#ff79c6">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>      dom <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.createElement(element.type)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>    <span style="color:#6272a4">// æŒ‚è½½å±æ€§
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>element.props){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>      <span style="color:#8be9fd;font-style:italic">Object</span>.keys(element.props).forEach(prop =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>        dom[prop] <span style="color:#ff79c6">=</span> element.props[prop];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>      })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>    <span style="color:#ff79c6">return</span> dom; 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span style="color:#8be9fd;font-style:italic">let</span> taskStack <span style="color:#ff79c6">=</span> [];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span style="color:#ff79c6">const</span> sleep <span style="color:#ff79c6">=</span> delay =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>  <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">let</span> start <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">Date</span>.now(); <span style="color:#8be9fd;font-style:italic">Date</span>.now() <span style="color:#ff79c6">-</span> start <span style="color:#ff79c6">&lt;=</span> delay;) {}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37</span><span style="color:#8be9fd;font-style:italic">function</span> performUnitWork () {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38</span>  <span style="color:#8be9fd;font-style:italic">let</span> topFiber <span style="color:#ff79c6">=</span> taskStack.pop();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40</span>  topFiber.dom <span style="color:#ff79c6">=</span> createDOM(topFiber.element);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41</span>  topFiber.parent.dom.append(topFiber.dom);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42</span>  <span style="color:#8be9fd;font-style:italic">let</span> children <span style="color:#ff79c6">=</span> topFiber.element.children;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43</span>  <span style="color:#6272a4">// sleep(30);
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44</span><span style="color:#6272a4"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45</span>  <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>children <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!!</span>children.length){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46</span>    <span style="color:#8be9fd;font-style:italic">let</span> preFiber <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47</span>    children.reverse().forEach((child, index) =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48</span>      <span style="color:#8be9fd;font-style:italic">let</span> newFiber <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49</span>        element<span style="color:#ff79c6">:</span> handleClassElement(child),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50</span>        parent<span style="color:#ff79c6">:</span> topFiber,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51</span>        sibling<span style="color:#ff79c6">:</span> preFiber
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53</span>      preFiber <span style="color:#ff79c6">=</span> newFiber;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54</span>      <span style="color:#ff79c6">if</span>(index <span style="color:#ff79c6">==</span> children.length <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55</span>        topFiber.child <span style="color:#ff79c6">=</span> newFiber;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56</span>      }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57</span>      taskStack.push(newFiber);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58</span>    })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60</span>  console.log(<span style="color:#f1fa8c">&#39;æ¸²æŸ“äº†&#39;</span>, topFiber);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63</span><span style="color:#8be9fd;font-style:italic">function</span> workloop (deadline) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64</span>  console.log(<span style="color:#f1fa8c">`æ­¤å¸§çš„å‰©ä½™æ—¶é—´ä¸º: </span><span style="color:#f1fa8c">${</span>deadline.timeRemaining()<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66</span>  <span style="color:#ff79c6">while</span>(deadline.timeRemaining() <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!!</span>taskStack.length){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67</span>    performUnitWork();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70</span>  <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!</span>taskStack.length) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71</span>    <span style="color:#6272a4">// renderDom();
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72</span><span style="color:#6272a4"></span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74</span>  <span style="color:#6272a4">// å¦‚æœè¿˜æœ‰æœªå®Œæˆçš„ä»»åŠ¡ï¼Œç»§ç»­è°ƒç”¨requestIdleCallbackç”³è¯·ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>taskStack.length){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76</span>    requestIdleCallback(workloop)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80</span>requestIdleCallback(workloop);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82</span><span style="color:#8be9fd;font-style:italic">function</span> render(element, container){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83</span>  <span style="color:#6272a4">// elementçš„æ ¼å¼å‚è§ createElement
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!!</span>element <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!!</span>container){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85</span>    taskStack.push({
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86</span>      element<span style="color:#ff79c6">:</span> handleClassElement(element),
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87</span>      parent<span style="color:#ff79c6">:</span> { dom<span style="color:#ff79c6">:</span> container },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88</span>      sibling<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">null</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89</span>    });
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93</span><span style="color:#8be9fd;font-style:italic">let</span> ReactDOM <span style="color:#ff79c6">=</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94</span>  render
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95</span>};
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">97</span><span style="color:#ff79c6">export</span> <span style="color:#ff79c6">default</span> ReactDOM;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">98</span>
</code></pre></div><h2 id="6-æ€»ç»“">6. æ€»ç»“</h2>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬ç®€å•çš„å®ç°äº† React 16.x åœ¨å¼•å…¥ Fiber æ¶æ„åï¼Œè¿›è¡Œç»„ä»¶æ¸²æŸ“çš„è¿‡ç¨‹ï¼Œå…³äºç»„ä»¶çš„æ›´æ–°æµç¨‹ï¼Œä»¥åŠsetStateç­‰çš„å®ç°ï¼Œéœ€è¦æœ‰æ—¶é—´å†å†™å‡ ç¯‡æ–‡ç« è¿›è¡Œç ”ç©¶ã€‚</p>

      </div>
      <div class="footer">
        <span><a class="category" href="https://tomtomyoung.top/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a><a class="category" href="https://tomtomyoung.top/categories/%E7%B2%BE%E9%80%89/">ç²¾é€‰</a></span>
        <span><a class="tag" href="https://tomtomyoung.top/tags/react/">react</a></span>
      </div>
    </div>

    <ul class="menu">
    <li class="menu-item">
        <i class="iconfont icon-top item-btn" id="back_top_btn"></i>
    </li>
    <li class="menu-item">
        <a href="https://tomtomyoung.top/" id="back-btn">
            <i class="iconfont icon-home item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-switch item-btn" id="switch_btn"></i>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-search item-btn" id="search_btn"></i>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/react-%E6%97%B6%E9%97%B4%E5%88%87%E7%89%87%E4%B8%8Erequestidlecallback%E8%AF%A6%E8%A7%A3/" data-tooltip="react æ—¶é—´åˆ‡ç‰‡ä¸requestIdleCallbackè¯¦è§£">
            <i class="iconfont icon-left item-btn"></i>
            
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/react-fiber%E8%AF%A6%E8%A7%A3/" data-tooltip="react Fiberè¯¦è§£">
            <i class="iconfont icon-right item-btn"></i>
            
        </a>
    </li>
</ul>

  </div>
</div>

<div class="cover" id="cover">
        <div class="search-container">
    <input type="search" class="docsearch-input search-input" placeholder="æœç´¢å…³é”®è¯" />
    
</div>
    </div>
</body>






<script type="text/javascript" src="https://tomtomyoung.top/js/util.min.js" integrity=""></script>
<script>
    if ('serviceWorker' in navigator) {
        const PREFETCH = true;
        const PREFETCH_LINK_RELS = ['index', 'next', 'prev', 'prefetch'];
        function prefetchCache() {
            if (navigator.serviceWorker.controller) {
                let links = document.querySelectorAll(
                    PREFETCH_LINK_RELS.map((rel) => {
                        return 'link[rel=' + rel + ']';
                    }).join(',')
                );
                if (links.length > 0) {
                    Array.from(links)
                        .map((link) => {
                            let href = link.getAttribute('href');
                            navigator.serviceWorker.controller.postMessage({
                                action: 'cache',
                                url: href,
                            });
                        });
                }
            }
        }

        navigator.serviceWorker
            .register('/sw.js', { scope: '/' })
            .then(() => {
                console.log('Service Worker Registered');
            });

        navigator.serviceWorker
            .ready
            .then(() => {
                if (PREFETCH) {
                    console.log('Service Worker Ready');
                    prefetchCache();
                }
            });
    }
</script></html>