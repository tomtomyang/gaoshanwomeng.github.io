<!DOCTYPE html>
<html lang="zh-cn" data-theme="light"><head>
  <meta charset="utf-8" />
  <meta name="google-site-verification" content="kw1N-Xm6qEr1c9PGuRd0U_T6DXkw_EHsLyz5LpuDDv8" />
  <meta name="msvalidate.01" content="EE98205D30806C22C519683EFC53E9BA" />
  <meta name="baidu-site-verification" content="iPC3wUcQLL" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=5" /><meta name="generator" content="Hugo 0.99.1" /><title>js 模块化详解</title>
  <meta name="description" itemprop="description"
    content="js 模块化详解" />
  <meta name="keywords" itemprop="keywords"
    content="[js 模块化]" />
  <base href="https://tomtomyoung.top/" />
  <link rel="canonical" href="https://tomtomyoung.top/post/js-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AF%A6%E8%A7%A3/" />

  
  <link rel="preconnect" href="https://fonts.gstatic.font.im" crossorigin />
  <link rel="preload prefetch" as="style" href="https://fonts.font.im/css?family=Noto+Serif+SC&display=swap" />
  <link rel="stylesheet" href="https://fonts.font.im/css?family=Noto+Serif+SC&display=swap" media="print"
    onload="this.media='all'">

  
  <link rel="shortcut icon" href="https://tomtomyoung.top/favicons//favicon.ico" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://tomtomyoung.top/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://tomtomyoung.top/favicons/favicon-16x16.png" />
  <link rel="mask-icon" href="https://tomtomyoung.top/favicons/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="apple-touch-icon" sizes="180x180" href="https://tomtomyoung.top/favicons/apple-touch-icon.png">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="msapplication-TileImage" content="https://tomtomyoung.top/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#00aba9"/>
  <link rel="manifest" href="https://tomtomyoung.top/manifest.json">

  
  <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_2450869_5vzvggza71i.css" />
  
  
  
  
  
  
  
  
  
  <link rel="stylesheet" href="https://tomtomyoung.top/css/style.min.46bd946c9fc976eedee2dd0f852e95653f061da5150d3c4697e159cbf32a065347e3c413b804d38eb55888104c3ec12b5ecfff5d0323fd27b32b55f9792eb9c6.css" integrity="sha512-Rr2UbJ/Jdu7e4t0PhS6VZT8GHaUVDTxGl&#43;FZy/MqBlNH48QTuATTjrVYiBBMPsErXs//XQMj/SezK1X5eS65xg=="
    type="text/css" />
</head><body>
<div class="main"><div class="percentage_container">
    <div class="percentage" id="percentage"></div>
</div><div class="toc sub-container">
    <div class="toc-header animated fadeInDown">
        <span>目录</span>
    </div><ul class="toc-h2 animated fadeInDown"><li>
                <span class="toc-link">1. 模块化源起</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. 没有模块化的艰辛</span>
            </li>
            <li>
                <span class="toc-link">2. 命名空间</span>
            </li>
            <li>
                <span class="toc-link">3. 闭包与 IIFE</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">2. CommonJS 和 node.js</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. JS 在服务端运行的问题</span>
            </li>
            <li>
                <span class="toc-link">2. CommonJS 的诞生</span>
            </li>
            <li>
                <span class="toc-link">3. Node.js 的诞生</span>
            </li>
            <li>
                <span class="toc-link">4. CommonJS 和 Node.js 的关系</span>
            </li>
            <li>
                <span class="toc-link">5. CommonJS 模块规范</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. 引入模块</span>
            </li>
            <li>
                <span class="toc-link">2. 模块标识</span>
            </li>
            <li>
                <span class="toc-link">3. 定义模块</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">6. CommonJS 的局限</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">3. AMD 和 require.js</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. AMD</span>
            </li>
            <li>
                <span class="toc-link">2. require.js</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. 引入 require.js</span>
            </li>
            <li>
                <span class="toc-link">2. 定义模块</span>
            </li>
            
                    <ul class="toc-h5"><li>
                <span class="toc-link">1. 独立模块</span>
            </li>
            <li>
                <span class="toc-link">2. 非独立模块</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">3. 引入模块</span>
            </li>
            
                    <ul class="toc-h5"><li>
                <span class="toc-link">1. 直接调用</span>
            </li>
            <li>
                <span class="toc-link">2. 动态加载</span>
            </li>
            <li>
                <span class="toc-link">3. 网络请求</span>
            </li>
            <li>
                <span class="toc-link">4. 错误处理</span>
            </li>
            
                    </ul>
                    </ul>
                    </ul><li>
                <span class="toc-link">4. CMD 和 sea.js</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. CMD</span>
            </li>
            <li>
                <span class="toc-link">2. sea.js</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. 引入 sea.js</span>
            </li>
            <li>
                <span class="toc-link">1. 定义模块</span>
            </li>
            <li>
                <span class="toc-link">3. 引入模块</span>
            </li>
            <li>
                <span class="toc-link">4. 第三方文件引用</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">3. sea.js 的同步魔法</span>
            </li>
            <li>
                <span class="toc-link">4. sea.js 和 require.js 的不同</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. 遵循规范不同</span>
            </li>
            <li>
                <span class="toc-link">2. factory 执行时机不同</span>
            </li>
            <li>
                <span class="toc-link">3. 聚焦点不同</span>
            </li>
            
                    </ul>
                    </ul><li>
                <span class="toc-link">5. umd</span>
            </li>
            <li>
                <span class="toc-link">6. ES6 Module</span>
            </li>
            </div><div class="single-post container">
    <div class="post animated fadeInDown">
      <div class="header">
        <span class="title">js 模块化详解</span>
        
          <div class="info">
	        	
            <a href="https://tomtomyoung.top/">Tomtom Young</a>
            <span>发布于2021-08-24</span>
            <span>更新于2022-06-29</span>
            <span>共9117字</span>
            <span>阅读19分钟</span>
          </div>
        
      </div>
      <div class="content markdown-body">
        <blockquote>
<p>参考：</p>
<p><a href="https://juejin.cn/post/6844903576309858318">前端模块化：CommonJS,AMD,CMD,ES6</a></p>
<p><a href="https://zh.wikipedia.org/wiki/CommonJS">wikipedia_CommonJS</a></p>
<p><a href="https://www.kancloud.cn/simon_chang/srqcnodejs/199236">深入浅出 Node.js</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/113009496">前端科普系列-CommonJS：不是前端却革命了前端</a></p>
<p><a href="https://github.com/seajs/seajs/issues/269">从 CommonJS 到 Sea.js</a></p>
<p><a href="http://wiki.commonjs.org/wiki/CommonJS">CommonJS wiki</a></p>
<p><a href="https://wiki.mozilla.org/ServerJS">mozillaWiki_ServerJS</a></p>
<p><a href="https://segmentfault.com/a/1190000023017398">《编程时间简史系列》JavaScript 模块化的历史进程</a></p>
<p><a href="https://nodejs.org/api/modules.html#modules_modules_commonjs_modules">Node.js_CommonJS modules</a></p>
<p><a href="https://javascript.ruanyifeng.com/tool/requirejs.html">RequireJS 和 AMD 规范</a></p>
<p><a href="https://requirejs.org/docs/whyamd.html">requirejs_why amd</a></p>
<p><a href="https://www.ruanyifeng.com/blog/2012/10/asynchronous_module_definition.html">Javascript 模块化编程（二）：AMD 规范</a></p>
<p><a href="https://github.com/cmdjs/specification/blob/master/draft/module.md">Common Module Definition / draft</a></p>
<p><a href="https://seajs.github.io/seajs/docs/">sea.js_docs</a></p>
<p><a href="http://hexo.wbjiang.cn/sea.js%E7%9A%84%E5%90%8C%E6%AD%A5%E9%AD%94%E6%B3%95.html">sea.js 的同步魔法</a></p>
</blockquote>
<h2 id="1-模块化源起">1. 模块化源起</h2>
<p>在本站另一篇博客：《js webpack 简介》的第一个章节：为什么使用 webpack 中，我们介绍了 js 代码编写的不同阶段。这里更详细的说明一下。</p>
<h3 id="1-没有模块化的艰辛">1. 没有模块化的艰辛</h3>
<p>JavaScript 诞生之初只是作为一个脚本语言来使用，做一些简单的表单校验等等。所以代码量很少，最开始都是直接写到 <code>&lt;script&gt;</code> 标签里，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>// index.html
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>&lt;<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#8be9fd;font-style:italic">var</span> name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;morrain&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#8be9fd;font-style:italic">var</span> age <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">18</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span></code></pre></div><p>随着业务进一步复杂，Ajax 诞生以后，前端能做的事情越来越多，代码量飞速增长，开发者们开始把 JavaScript 写到独立的 js 文件中，与 html 文件解耦。像下面这样：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#6272a4">// index.html
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#6272a4"></span><span style="color:#ff79c6">&lt;</span>script src<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./mine.js&#34;</span><span style="color:#ff79c6">&gt;&lt;</span>/script&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#6272a4">// mine.js
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">var</span> name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;morrain&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span><span style="color:#8be9fd;font-style:italic">var</span> age <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">18</span>
</span></span></code></pre></div><p>再后来，更多的开发者参与进来，更多的 js 文件被引入进来:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>// index.html
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./mine.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./a.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./b.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>// mine.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>var name = &#39;morrain&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>var age = 18
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>// a.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>var name = &#39;lilei&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>var age = 15
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>// b.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>var name = &#39;hanmeimei&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>var age = 13
</span></span></code></pre></div><p>不难发现，问题已经来了！ JavaScript 在 ES6 之前是没有模块系统，所以上面三个 js 文件里申明的变量都会存在于全局作用域中。不同的开发者维护不同的 js 文件，很难保证不和其它 js 文件冲突。全局变量污染开始成为开发者的噩梦。</p>
<h3 id="2-命名空间">2. 命名空间</h3>
<p>为了解决全局变量污染的问题，开发者开始使用命名空间的方法，既然命名会冲突，那就加上命名空间呗，如下所示：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>// index.html
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./mine.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./a.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./b.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>// mine.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>app.mine = {}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>app.mine.name = &#39;morrain&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>app.mine.age = 18
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>// a.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>app.moduleA = {}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>app.moduleA.name = &#39;lilei&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>app.moduleA.age = 15
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>// b.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>app.moduleB = {}
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>app.moduleB.name = &#39;hanmeimei&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>app.moduleB.age = 13
</span></span></code></pre></div><p>此时，已经开始有隐隐约约的模块化的概念，只不过是用命名空间实现的。这样在一定程度上是解决了命名冲突的问题， b.js 模块的开发者，可以很方便的通过 <code>app.moduleA.name</code> 来取到模块 A 中的名字，但是也可以通过 <code>app.moduleA.name = 'rename'</code> 来任意改掉模块 A 中的名字，而这件事情，模块 A 却毫不知情！这显然是不被允许的。</p>
<p>这一时期的代表是雅虎的 YUI Library：</p>
<blockquote>
<p>2006 年 1 月，当时还是国际互联网巨头的 Yahoo（雅虎），开源了其内部使用已久的组件库 <strong>YUI Library</strong>。</p>
<p>YUI Library 采用了类似于 Java 命名空间的方式，来隔离各个模块之间的变量，避免全局变量造成的冲突。其写法类似于：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>YUI.util.module.doSomthing();
</span></span></code></pre></div><p>这种写法无论是封装还是调用时都十分繁琐，而且当时的 IDE 对于 JavaScript 来说智能感知非常弱，开发者很难知道他需要的某个方法存在于哪个命名空间下，经常需要频繁地查阅开发手册，导致开发体验十分不友好。</p>
</blockquote>
<h3 id="3-闭包与-iife">3. 闭包与 IIFE</h3>
<p>聪明的开发者又开始利用 JavaScript 语言的函数作用域，使用闭包的特性来解决上面的这一问题。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>// index.html
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./mine.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./a.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;./b.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>// mine.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>app.mine = (function(){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    var name = &#39;morrain&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>    var age = 18
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    return {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>        getName: function(){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>            return name
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>})()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>// a.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span>app.moduleA = (function(){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span>    var name = &#39;lilei&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span>    var age = 15
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span>    return {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span>        getName: function(){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span>            return name
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span><span>})()
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span><span>// b.js
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span><span>app.moduleB = (function(){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span><span>    var name = &#39;hanmeimei&#39;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span><span>    var age = 13
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span><span>    return {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span><span>        getName: function(){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span><span>            return name
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36</span><span>})()
</span></span></code></pre></div><p>现在 b.js 模块可以通过 <code>app.moduleA.getName()</code> 来取到模块 A 的名字，但是各个模块的名字都保存在各自的函数内部，没有办法被其它模块更改。这样的设计，已经有了模块化的影子，每个模块内部维护私有的东西，开放接口给其它模块使用，但依然不够优雅，不够完美。譬如上例中，模块 B 可以取到模块 A 的东西，但模块 A 却取不到模块 B 的，因为上面这三个模块加载有先后顺序，互相依赖。当一个前端应用业务规模足够大后，这种依赖关系又变得异常难以维护。</p>
<p>这一时期的代表是 JQuery：</p>
<blockquote>
<p>YUI 发布之后不久，<em>John Resig</em> 发布了 <strong>jQuery</strong>。当时年仅 23 岁的他，不会知道自己这一时兴起在 BarCamp 会议上写下的代码，将占据未来十几年的 Web 领域。</p>
<p><strong>jQuery</strong> 使用了一种新的组织方式，它利用了 JavaScript 的 IIFE（立即执行函数表达式）和闭包的特性，将所依赖的外部变量传给一个包装了自身代码的匿名函数，在函数内部就可以使用这些依赖，最后在函数的结尾把自身暴露给 <code>window</code>。这种写法被很多后来的框架所模仿，其写法类似于：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>(<span style="color:#8be9fd;font-style:italic">function</span>(root){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style="color:#6272a4">// balabala
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#6272a4"></span>    root.jQuery <span style="color:#ff79c6">=</span> root.$ <span style="color:#ff79c6">=</span> jQuery;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>})(<span style="color:#8be9fd;font-style:italic">window</span>);
</span></span></code></pre></div></blockquote>
<p>综上所述，前端需要模块化，并且模块化不光要处理全局变量污染、数据保护的问题，还要很好的解决模块之间依赖关系的维护。</p>
<p>对于 JS 模块化在客户端的探讨我们告一段落，下面讲的是另一回事。</p>
<h2 id="2-commonjs-和-nodejs">2. CommonJS 和 node.js</h2>
<h3 id="1-js-在服务端运行的问题">1. JS 在服务端运行的问题</h3>
<p>早期 JavaScript 主要在浏览器环境中运行。</p>
<p>由于官方规范（ECMAScript）规范化的时间较早，规范涵盖的范畴非常小。这些规范中包含词法、类型、上下文、表达式、声明（statement）、方法、对象等语言的基本要素。</p>
<p>在实际应用中，JavaScript 的表现能力取决于宿主环境中的 API 支持程度。在 Web1.0 时代，只有对 DOM、BOM 等基本的支持。随着 Web2.0 的推进，HTML5 崭露头角，它将 Web 网页带入 Web 应用的时代，在浏览器中出现了更多、更强大的 API 供 JavaScript 调用，这得感谢 W3C 组织对 HTML5 规范的推进以及各大浏览器厂商对规范的支持。浏览器对 JS 的支持越来越强，JS 在前端的表现越来越好，但是 JS 脱离了浏览器环境之后，能不能发挥作用？</p>
<p>与前端情景不同的是，后端 JavaScript 的规范却远远落后，导致了 JS 作为一种后端语言时，存在以下缺点：</p>
<ul>
<li>
<p>没有模块系统</p>
</li>
<li>
<p>标准库较少</p>
<p>ECMAScript 仅定义了部分核心库，对于文件系统，I/O 流等常见需求却没有标准的 API。</p>
<p>就 HTML5 的发展状况而言，W3C 标准化在一定意义上是在推进这个过程，但它仅限于浏览器端。</p>
</li>
<li>
<p>缺少标准接口</p>
<p>在 JavaScript 中，几乎没有定义过如 Web 服务器或者数据库之类的标准统一接口。</p>
</li>
<li>
<p>缺乏包管理系统</p>
<p>这导致 JavaScript 应用中基本没有自动加载和安装依赖的能力。</p>
</li>
</ul>
<p>也就是说让 JS 运行在服务端，还只能是一种假设，JS 还不具备作为后端语言的能力。</p>
<h3 id="2-commonjs-的诞生">2. CommonJS 的诞生</h3>
<p>2009 年 1 月，Mozilla 旗下的工程师 <em>Kevin Dangoor</em>，在工作之余，与同事们一起制订了一套 JavaScript 模块化的标准规范，并取名为 <strong>ServerJS</strong>。</p>
<p><strong>ServerJS</strong> 最早用于服务端 JavaScript，旨在给 js 提供运行在服务端的标准库以及为配合自动化测试等工作而提供模块导入功能。这就是 CommonJS 的雏形。</p>
<p>也就是说，**ServerJS **很大程度上解决了 JS 作为服务端语言最致命的问题：</p>
<blockquote>
<p><strong>Current Efforts</strong></p>
<p>his is a list of issues currently being discussed / standardized. They come from the &ldquo;Low level&rdquo; department, as we need to have a solid basics prior to building a tower.</p>
<ol>
<li><a href="https://wiki.mozilla.org/ServerJS/Modules">Modules</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/Filesystem_API">Filesystem API</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/Binary">Binary Data Objects</a> (byte arrays and/or strings)</li>
<li><a href="https://wiki.mozilla.org/ServerJS/IO">I/O Streams</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/Encodings">Encodings and character sets</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/System">System Interface</a> (stdin, stdout, stderr, &amp;c)</li>
<li><a href="https://wiki.mozilla.org/ServerJS/C_API">C unified API</a> to our Target Platforms</li>
<li><a href="https://wiki.mozilla.org/ServerJS/Unit_Testing">Unit testing</a></li>
</ol>
<p><strong>Future Efforts</strong></p>
<p><strong>Low-level APIs</strong></p>
<p>This is the collection of APIs that we&rsquo;d like to see behaving consistently across JavaScript interpreters.</p>
<ul>
<li><a href="https://wiki.mozilla.org/ServerJS/Runtime_Services">Language and Runtime Services</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/Sockets">Socket I/O</a> (TCP/IP)</li>
<li><a href="https://wiki.mozilla.org/ServerJS/Command_Line">Command line processing</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/Logging">Logging</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/RDBMS">Relational database interface</a></li>
<li>ResultSets (collections of data maybe from RDBMS, maybe from other sources)</li>
<li><a href="https://wiki.mozilla.org/ServerJS/WSGI">Web server to application interface</a> (plus middleware)</li>
<li><a href="https://wiki.mozilla.org/ServerJS/Concurrency">Concurrency</a></li>
<li><a href="https://wiki.mozilla.org/index.php?title=ServerJS/String_IO&amp;action=edit&amp;redlink=1">String / ByteString I/O</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/Promises">Promises</a></li>
</ul>
<p><strong>High-level APIs</strong></p>
<p>This is the collection of APIs that implement common functionality on top of the low-level API.</p>
<ul>
<li><a href="https://wiki.mozilla.org/ServerJS/HTTP_Client">HTTP client</a> APIs</li>
<li><a href="https://wiki.mozilla.org/ServerJS/Email">Email</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/XMPP">Jabber (XMPP)</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/i18n">Internationalization</a></li>
<li><a href="https://wiki.mozilla.org/ServerJS/Promise_Manager">Promise Manager</a></li>
</ul>
</blockquote>
<blockquote>
<p>题外话：</p>
<p>早在 1995 年，Netsacpe（网景）公司就提供了有在服务端执行 JavaScript 能力的产品，名为 Netscape Enterprise Server。但此时服务端能做的 JavaScript 还是基于浏览器来实现的，本身没有脱离其自带的 API 范围。直到 2009 年 5 月，Node.js 诞生，赋予了其文件系统、I/O 流、网络通信等能力，才真正意义上的成为了一门服务端编程语言。</p>
</blockquote>
<h3 id="3-nodejs-的诞生">3. Node.js 的诞生</h3>
<p>2009 年年初，<em>Ryan Dahl</em> 产生了创造一个跨平台编程框架的想法，想要基于 Google（谷歌）的 Chromium V8 引擎来实现。</p>
<p>经过几个月紧张的开发工作，在 5 月中旬，Node.js 首个预览版本的开发工作已全部结束。同年 8 月，欧洲 JSConf 开发者大会上，<strong>Node.js</strong> 惊艳亮相。</p>
<p>此时，Node.js 还没有一款包管理工具，外部依赖依然要手动下载到项目目录内再引用。</p>
<p>欧洲 JSConf 大会结束后，<em>Isaac Z. Schlueter</em> 注意到了 <em>Ryan Dahl</em> 的 Node.js，两人一拍即合，决定开发一款包管理工具，也就是后来大名鼎鼎的 Node Package Manager（即 npm）。</p>
<p>在开发包管理器之初，摆在二人面前的第一个问题就是，采用何种模块化方案？</p>
<p>二人将目光锁定在了几个月前（2009 年 4 月）举办的美国 JSConf 大会上公布的 ServerJS。此时的 ServerJS 已经更名为 CommonJS，并重新制订了标准规范，即 Modules/1.0 ，展现了更大的野心，企图一统所有编程语言的模块化方案。</p>
<blockquote>
<p>Modules/1.0 标准规范包含以下内容：</p>
<ol>
<li>模块的标识应遵循一定的书写规则。</li>
<li>定义全局函数 <code>require(dependency)</code>，通过传入模块标识来引入模块，执行的结果即为模块暴漏出来的 API。</li>
<li>如果被 <code>require</code> 函数引入的模块中也包含外部依赖，则依次加载这些依赖。</li>
<li>如果引入模块失败，那么 <code>require</code> 函数应该抛出一个异常。</li>
<li>模块通过变量 <code>exports</code> 来向外暴露 API，<code>exports</code> 只能是一个 <code>object</code> 对象，暴漏的 API 须作为该对象的属性。</li>
</ol>
</blockquote>
<p>由于这个规范简单而直接，Node.js 和 npm 很快就决定采用这种模块化的方案。至此，第一个 JavaScript 模块化方案正式登上了历史舞台。</p>
<h3 id="4-commonjs-和-nodejs-的关系">4. CommonJS 和 Node.js 的关系</h3>
<p>CommonJS 对自己的定义是：</p>
<blockquote>
<p>Welcome to <a href="http://commonjs.org/">CommonJS</a> , a group with a goal of building up the JavaScript ecosystem for web servers, desktop and command line apps and in the browser.</p>
<p>欢迎来到 CommonJS，该组织的目标是为 Web 服务器、桌面和命令行应用程序以及浏览器构建 JavaScript 生态系统。</p>
</blockquote>
<p>CommonJS 作为一个不断完善 JS 的组织，提出了一系列的标准规范，从最早 ServerJS 时的 <em>Modules/0.1</em>，到更名为 CommonJS 后的 <em>Modules/1.0</em>，再到现在成为主流的 <em>Modules/1.1</em>。</p>
<p>这些规范有很多具体的实现，且不只局限于 JavaScript 这一种语言，只要遵循了这一规范，都可以称之为 CommonJS。其中，Node.js 的实现叫做 Common Node Modules。</p>
<p>最终 CommonJS 虽然没有进入 ECMAScript 标准范围内，但 CommonJS 项目组的很多成员，也都是 TC39（即制订 ECMAScript 标准的委员会组织）的成员。这也为日后 ES6 引入模块化特性打下了坚实的基础。</p>
<h3 id="5-commonjs-模块规范">5. CommonJS 模块规范</h3>
<h4 id="1-引入模块">1. 引入模块</h4>
<p>模块引用的示例代码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#ff79c6">const</span> math <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;math&#39;</span>);
</span></span></code></pre></div><p>在 CommonJS 规范中，存在 require()方法，这个方法接受模块标识符，以此引入一个模块的 API 到当前上下文中。</p>
<h4 id="2-模块标识">2. 模块标识</h4>
<p>模块标识其实就是传递给 require()方法的参数，它必须是符合小驼峰命名的字符串，或者以.、..开头的相对路径、绝对路径。可以没有文件名后缀 .js 。</p>
<p>模块的定义非常简单，接口也十分简洁。它的意义在于将类聚的方法和变量等限定在私有的作用域中，同时支持引入和导出功能以顺畅的连接上下游的依赖。每个模块都有独立的空间，它们互不打扰，在引用时也显得干净利落，如图：</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/2016-08-25_57bdc8fb7dbd0.png" alt="img"></p>
<p>CommonJS 构建的这套模块导出和引入机制使得用户完全不必考虑变量污染，命名空间等方案与之相比相形见绌。</p>
<h4 id="3-定义模块">3. 定义模块</h4>
<p>在模块中，上下文提供 require()方法来引入外部模块。对应引入的功能，上下文提供了 exports 对象用于导出当前模块的方法或者变量，并且它是唯一导出的入口。在模块中，还存在一个 module 对象，它代表模块自身，而 exports 是 module 的属性。在 Node 中，一个文件就是一个模块，将方法挂载在 exports 对象上作为属性即可定义导出的方式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#6272a4">//math.js
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#6272a4"></span>exports.add <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>(){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#8be9fd;font-style:italic">let</span> sum <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    i<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    args <span style="color:#ff79c6">=</span> arguments,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>    l <span style="color:#ff79c6">=</span> args.length;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    <span style="color:#ff79c6">while</span>(i<span style="color:#ff79c6">&lt;</span>l){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>        sum <span style="color:#ff79c6">+=</span> args[i<span style="color:#ff79c6">++</span>];
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    <span style="color:#ff79c6">return</span> sum;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>};
</span></span></code></pre></div><p>在另一个文件中，我们通过 require()方法引入模块后，就能调用定义的属性或者方法了：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#f1fa8c">&#34;use strict&#34;</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#6272a4">//program.js
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#6272a4"></span><span style="color:#ff79c6">const</span> math <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;./math&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>console.log(math.add(<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">2</span>));
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>exports.increment <span style="color:#ff79c6">=</span> (val)=&gt;{
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>  <span style="color:#ff79c6">return</span> math.add(val, <span style="color:#bd93f9">1</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>};
</span></span></code></pre></div><ul>
<li>CommonJS 规范加载模块是同步的，也就是说，只有加载完成，才能执行后面的操作。</li>
<li>对于基本数据类型，属于复制。即会被模块缓存。同时，在另一个模块可以对该模块输出的变量重新赋值。</li>
<li>对于复杂数据类型，属于浅拷贝。由于两个模块引用的对象指向同一个内存空间，因此对该模块的值做修改时会影响另一个模块。</li>
<li>当使用 require 命令加载某个模块时，就会运行整个模块的代码。</li>
<li>当使用 require 命令加载同一个模块时，不会再执行该模块，而是取到缓存之中的值。也就是说，CommonJS 模块无论加载多少次，都只会在第一次加载时运行一次，以后再加载，就返回第一次运行的结果，除非手动清除系统缓存。</li>
<li>commonJS 用同步的方式加载模块。在服务端，模块文件都存在本地磁盘，读取非常快，所以这样做不会有问题。但是在浏览器端，限于网络原因，更合理的方案是使用异步加载。</li>
</ul>
<h3 id="6--commonjs-的局限">6.  CommonJS 的局限</h3>
<p>我们对 CommonJS 的规范已经非常熟悉了，<code>require</code> 命令的基本功能是，读入并执行一个 js 文件，然后返回该模块的 exports 对象，这在服务端是可行的，因为服务端加载并执行一个文件的时间消费是可以忽略的，模块的加载是运行时同步加载的，<code>require</code> 命令执行完后，文件就执行完了，并且成功拿到了模块导出的值。</p>
<p>这种规范天生就不适用于浏览器，因为它是同步的。可想而知，浏览器端每加载一个文件，要发网络请求去取，如果网速慢，就非常耗时，浏览器就要一直等 <code>require</code> 返回，就会一直卡在那里，阻塞后面代码的执行，从而阻塞页面渲染，使得页面出现假死状态。</p>
<p>为了解决这个问题，后面发展起来了众多的前端模块化规范，包括 CommonJS 大致有如下几种：</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/v2-daf2d469b3376d042e11c58782170e55_720w.jpg" alt="img"></p>
<h2 id="3-amd-和-requirejs">3. AMD 和 require.js</h2>
<p>了解了 CommonJS 应用在浏览器端表现出来的弊端后，再来了解适合浏览器端模块化的方案，首先是 AMD。</p>
<h3 id="1-amd">1. AMD</h3>
<p>AMD 是&quot;Asynchronous Module Definition&quot;的缩写，意思就是&quot;异步模块定义&quot;。它采用异步方式加载模块，模块的加载不影响它后面语句的运行。所有依赖这个模块的语句，都定义在一个回调函数中，等到加载完成之后，这个回调函数才会运行。</p>
<h3 id="2-requirejs">2. require.js</h3>
<p>AMD 和 require.js 的关系，就像 CommonJS 和 Node.js 的关系一样，AMD 是一种实现前端模块化的标准，require.js 是一个工具库，主要用于客户端的模块管理，而 require.js 使用的模块化规范就是 AMD。</p>
<p>和 CommonJS 和 Node.js 不同的是，并不是现有 AMD 再有 require.js，而是在开发 require.js 的过程中，逐步形成了 AMD 规范。</p>
<h4 id="1-引入-requirejs">1. 引入 require.js</h4>
<p>require.js 的使用和其他 js 库的使用方法一样，直接使用 <code>&lt;script&gt;</code> 标签进行引入，然后就能在网页中进行模块化编程了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">data-main</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;scripts/main&#34;</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;scripts/require.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span></code></pre></div><p>上面代码的 data-main 属性不可省略，用于指定主代码所在的脚本文件，在上例中为 scripts 子目录下的 main.js 文件。用户自定义的代码就放在这个 main.js 文件中。</p>
<p><code>main.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#6272a4">// 首先用config()指定各模块路径和引用名
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#6272a4"></span>require.config({
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>  baseUrl<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;js/lib&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>  paths<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    <span style="color:#f1fa8c">&#34;jquery&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;jquery.min&#34;</span>,  <span style="color:#6272a4">//实际路径为js/lib/jquery.min.js
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span><span style="color:#6272a4"></span>    <span style="color:#f1fa8c">&#34;underscore&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;underscore.min&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>  }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>});
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>require([<span style="color:#f1fa8c">&#34;jquery&#34;</span>,<span style="color:#f1fa8c">&#34;underscore&#34;</span>],<span style="color:#8be9fd;font-style:italic">function</span>($,_){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>  <span style="color:#6272a4">// some code here
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span><span style="color:#6272a4"></span>});
</span></span></code></pre></div><h4 id="2-定义模块">2. 定义模块</h4>
<p>define 方法用于定义模块，require.js 要求每个模块放在一个单独的文件里。</p>
<p>按照是否依赖其他模块，可以分成两种情况讨论。第一种情况是定义独立模块，即所定义的模块不依赖其他模块；第二种情况是定义非独立模块，即所定义的模块依赖于其他模块。</p>
<h5 id="1-独立模块">1. 独立模块</h5>
<p>如果被定义的模块是一个独立模块，不需要依赖任何其他模块，可以直接用 define 方法生成。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define({
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    method1<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span>() {},
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    method2<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span>() {},
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>});
</span></span></code></pre></div><p>上面代码生成了一个拥有 method1、method2 两个方法的模块。</p>
<p>另一种等价的写法是，把对象写成一个函数，该函数的返回值就是输出的模块。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define(<span style="color:#8be9fd;font-style:italic">function</span> () {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>        method1<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span>() {},
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>        method2<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span>() {},
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    };
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>});
</span></span></code></pre></div><p>后一种写法的自由度更高一点，可以在函数体内写一些模块初始化代码。</p>
<p>值得指出的是，define 定义的模块可以返回任何值，不限于对象。</p>
<h5 id="2-非独立模块">2. 非独立模块</h5>
<p>如果被定义的模块需要依赖其他模块，则 define 方法必须采用下面的格式。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define([<span style="color:#f1fa8c">&#39;module1&#39;</span>, <span style="color:#f1fa8c">&#39;module2&#39;</span>], <span style="color:#8be9fd;font-style:italic">function</span>(m1, m2) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>   ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>});
</span></span></code></pre></div><p>define 方法的第一个参数是一个数组，它的成员是当前模块所依赖的模块。比如，[‘module1’, ‘module2’]表示我们定义的这个新模块依赖于 module1 模块和 module2 模块，只有先加载这两个模块，新模块才能正常运行。一般情况下，module1 模块和 module2 模块指的是，当前目录下的 module1.js 文件和 module2.js 文件，等同于写成[’./module1’, ‘./module2’]。</p>
<p>define 方法的第二个参数是一个函数，当前面数组的所有成员加载成功后，它将被调用。它的参数与数组的成员一一对应，比如 function(m1, m2)就表示，这个函数的第一个参数 m1 对应 module1 模块，第二个参数 m2 对应 module2 模块。这个函数必须返回一个对象，供其他模块调用。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define([<span style="color:#f1fa8c">&#39;module1&#39;</span>, <span style="color:#f1fa8c">&#39;module2&#39;</span>], <span style="color:#8be9fd;font-style:italic">function</span>(m1, m2) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>        method<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>            m1.methodA();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>           m2.methodB();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>    };
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>});
</span></span></code></pre></div><p>上面代码表示新模块返回一个对象，该对象的 method 方法就是外部调用的接口，menthod 方法内部调用了 m1 模块的 methodA 方法和 m2 模块的 methodB 方法。</p>
<p>需要注意的是，回调函数必须返回一个对象，这个对象就是你定义的模块。</p>
<p>如果依赖的模块很多，参数与模块一一对应的写法非常麻烦。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    [<span style="color:#f1fa8c">&#39;dep1&#39;</span>, <span style="color:#f1fa8c">&#39;dep2&#39;</span>, <span style="color:#f1fa8c">&#39;dep3&#39;</span>, <span style="color:#f1fa8c">&#39;dep4&#39;</span>, <span style="color:#f1fa8c">&#39;dep5&#39;</span>, <span style="color:#f1fa8c">&#39;dep6&#39;</span>, <span style="color:#f1fa8c">&#39;dep7&#39;</span>, <span style="color:#f1fa8c">&#39;dep8&#39;</span>],
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style="color:#8be9fd;font-style:italic">function</span>(dep1,   dep2,   dep3,   dep4,   dep5,   dep6,   dep7,   dep8){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>        ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>);
</span></span></code></pre></div><p>为了避免像上面代码那样繁琐的写法，RequireJS 提供一种更简单的写法。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>define(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#8be9fd;font-style:italic">function</span> (require) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>        <span style="color:#8be9fd;font-style:italic">var</span> dep1 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep1&#39;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>            dep2 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep2&#39;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>            dep3 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep3&#39;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>            dep4 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep4&#39;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>            dep5 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep5&#39;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>            dep6 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep6&#39;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>            dep7 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep7&#39;</span>),
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>            dep8 <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;dep8&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>            ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>});
</span></span></code></pre></div><p>下面是一个 define 实际运用的例子。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define([<span style="color:#f1fa8c">&#39;math&#39;</span>, <span style="color:#f1fa8c">&#39;graph&#39;</span>], 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style="color:#8be9fd;font-style:italic">function</span> ( math, graph ) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>        <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>            plot<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span>(x, y){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>                <span style="color:#ff79c6">return</span> graph.drawPie(math.randomGrid(x,y));
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>            }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>    };
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>);
</span></span></code></pre></div><p>上面代码定义的模块依赖 math 和 graph 两个库，然后返回一个具有 plot 接口的对象。</p>
<blockquote>
<p>非独立的模块的定义体现了：</p>
<p>AMD 的理念是依赖前置，也就是在定义模块时，要提前声明其依赖的其他模块。</p>
</blockquote>
<h4 id="3-引入模块">3. 引入模块</h4>
<h5 id="1-直接调用">1. 直接调用</h5>
<p>require 方法用于调用模块。它的参数与 define 方法类似。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>require([<span style="color:#f1fa8c">&#39;foo&#39;</span>, <span style="color:#f1fa8c">&#39;bar&#39;</span>], <span style="color:#8be9fd;font-style:italic">function</span> ( foo, bar ) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>        foo.doSomething();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>});
</span></span></code></pre></div><p>上面方法表示加载 foo 和 bar 两个模块，当这两个模块都加载成功后，执行一个回调函数。该回调函数就用来完成具体的任务。</p>
<p>require 方法也可以用在 define 方法内部。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define(<span style="color:#8be9fd;font-style:italic">function</span> (require) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>   <span style="color:#8be9fd;font-style:italic">var</span> otherModule <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;otherModule&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>});
</span></span></code></pre></div><h5 id="2-动态加载">2. 动态加载</h5>
<p>下面的例子显示了如何动态加载模块。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>define(<span style="color:#8be9fd;font-style:italic">function</span> ( require ) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> isReady <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>, foobar;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span> 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    require([<span style="color:#f1fa8c">&#39;foo&#39;</span>, <span style="color:#f1fa8c">&#39;bar&#39;</span>], <span style="color:#8be9fd;font-style:italic">function</span> (foo, bar) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>        isReady <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>        foobar <span style="color:#ff79c6">=</span> foo() <span style="color:#ff79c6">+</span> bar();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>    });
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span> 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    <span style="color:#ff79c6">return</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>        isReady<span style="color:#ff79c6">:</span> isReady,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>        foobar<span style="color:#ff79c6">:</span> foobar
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    };
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>});
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span> 
</span></span></code></pre></div><p>上面代码所定义的模块，内部加载了 foo 和 bar 两个模块，在没有加载完成前，isReady 属性值为 false，加载完成后就变成了 true。因此，可以根据 isReady 属性的值，决定下一步的动作。</p>
<p>下面的例子是模块的输出结果是一个 promise 对象。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define([<span style="color:#f1fa8c">&#39;lib/Deferred&#39;</span>], <span style="color:#8be9fd;font-style:italic">function</span>( Deferred ){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> defer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Deferred(); 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    require([<span style="color:#f1fa8c">&#39;lib/templates/?index.html&#39;</span>,<span style="color:#f1fa8c">&#39;lib/data/?stats&#39;</span>],
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>        <span style="color:#8be9fd;font-style:italic">function</span>( template, data ){
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>            defer.resolve({ template<span style="color:#ff79c6">:</span> template, data<span style="color:#ff79c6">:</span>data });
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>    );
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>    <span style="color:#ff79c6">return</span> defer.promise();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>});
</span></span></code></pre></div><p>上面代码的 define 方法返回一个 promise 对象，可以在该对象的 then 方法，指定下一步的动作。</p>
<h5 id="3-网络请求">3. 网络请求</h5>
<p>如果服务器端采用 JSONP 模式，则可以直接在 require 中调用，方法是指定 JSONP 的 callback 参数为 define。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>require( [ 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style="color:#f1fa8c">&#34;http://someapi.com/foo?callback=define&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>], <span style="color:#8be9fd;font-style:italic">function</span> (data) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>    console.log(data);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>});
</span></span></code></pre></div><h5 id="4-错误处理">4. 错误处理</h5>
<p>require 方法允许添加第三个参数，即错误处理的回调函数。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>require(
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    [ <span style="color:#f1fa8c">&#34;backbone&#34;</span> ], 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style="color:#8be9fd;font-style:italic">function</span> ( Backbone ) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>        <span style="color:#ff79c6">return</span> Backbone.View.extend({ <span style="color:#6272a4">/* ... */</span> });
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>    }, 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>    <span style="color:#8be9fd;font-style:italic">function</span> (err) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>        <span style="color:#6272a4">// ...
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span><span style="color:#6272a4"></span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span>);
</span></span></code></pre></div><h2 id="4-cmd-和-seajs">4. CMD 和 sea.js</h2>
<h3 id="1-cmd">1. CMD</h3>
<p>CMD 的全称是“Common Module Definition”， 这里也出现了 Common 这个单词，那么 CMD 是不是和 CommonJS 有点关系呢，答案是确实有关系。</p>
<p>很多博客中都介绍 CMD 和 CommonJS 是一个东西，其实并不是，但是两者确实有千丝万缕的关系。</p>
<p>这里涉及到一个人：蚂蚁金服的玉伯，他是 CMD 和 sea.js 的缔造者，同时他还有一个厉害的产品就是 Ant Design。</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/8de420a889a8441f9e53dc571a782f24.png" alt="mceclip1_20200509104332_PT8K.png"></p>
<p>个人认为玉伯在设计 sea.js 的过程中，肯定是借鉴了 CommonJS 的思想，又或者说，设计 sea.js 的初衷就是将 CommonJS 的模块化规范在浏览器端更好的实现。</p>
<h3 id="2-seajs">2. sea.js</h3>
<p>sea.js 就是基于 CMD 规范开发的 JS 库：</p>
<blockquote>
<p>Sea.js 追求简单、自然的代码书写和组织方式，具有以下核心特性：</p>
<ul>
<li>简单友好的模块定义规范：Sea.js 遵循 CMD 规范，可以像 Node.js 一般书写模块代码。</li>
<li>自然直观的代码组织方式：依赖的自动加载、配置的简洁清晰，可以让我们更多地享受编码的乐趣。</li>
</ul>
<p>Sea.js 还提供常用插件，非常有助于开发调试和性能优化，并具有丰富的可扩展接口。</p>
</blockquote>
<p>sea.js 是 CMD 规范的实现，但是 sea.js 和 CMD 是同时被提出的，而不是先有规范再有技术实践，换一种说法就是 CMD 规范是在开发 sea.js 的过程中形成的。</p>
<h4 id="1-引入-seajs">1. 引入 sea.js</h4>
<p>与 require.js 一样，使用 <code>&lt;script&gt;</code> 标签进行引入：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;../sea-modules/seajs/seajs/2.2.0/sea.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span></code></pre></div><p>引入 sea.js 之后，需要再配置一下，包括定义模块名，设置主模块：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>&lt;<span style="color:#ff79c6">script</span>&gt;
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    seajs.config({
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>        alias<span style="color:#ff79c6">:</span>{
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>            <span style="color:#f1fa8c">&#39;changeText&#39;</span><span style="color:#ff79c6">:</span><span style="color:#f1fa8c">&#39;../static/changeText.js&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>        }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>    });
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>    seajs.use(<span style="color:#f1fa8c">&#39;./static/main.js&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>&lt;/<span style="color:#ff79c6">script</span>&gt;
</span></span></code></pre></div><h4 id="1-定义模块">1. 定义模块</h4>
<p>在 CMD 规范中，一个模块就是一个文件。代码的书写格式如下：</p>
<p><code>changeText.js</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>define(<span style="color:#8be9fd;font-style:italic">function</span> (require, exports, module) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> init <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>        <span style="color:#8be9fd;font-style:italic">var</span> textContent <span style="color:#ff79c6">=</span> [
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>            <span style="color:#f1fa8c">&#39;yes it works&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>            <span style="color:#f1fa8c">&#39;seajs demo&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>            <span style="color:#f1fa8c">&#39;it is a lucky day&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>            <span style="color:#f1fa8c">&#39;wish this help you&#39;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span>            <span style="color:#f1fa8c">&#39;thank you for reading&#39;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>        ];
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>        <span style="color:#8be9fd;font-style:italic">var</span> index <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">Math</span>.floor(<span style="color:#8be9fd;font-style:italic">Math</span>.random()<span style="color:#ff79c6">*</span>textContent.length);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>        <span style="color:#ff79c6">return</span> textContent[index];
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    module.exports <span style="color:#ff79c6">=</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>        init<span style="color:#ff79c6">:</span>init
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span>})
</span></span></code></pre></div><h4 id="3-引入模块-1">3. 引入模块</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>define(<span style="color:#8be9fd;font-style:italic">function</span> (require, exports, module) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> changeText <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;changeText&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>    <span style="color:#8be9fd;font-style:italic">var</span> title <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#39;title&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>    title.innerHTML <span style="color:#ff79c6">=</span> changeText.init();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>})
</span></span></code></pre></div><h4 id="4-第三方文件引用">4. 第三方文件引用</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>seajs.config({
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>  base<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;../sea-modules/&#34;</span>,
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>  alias<span style="color:#ff79c6">:</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>    <span style="color:#f1fa8c">&#34;jquery&#34;</span><span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;jquery/jquery/1.10.1/jquery.js&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>  }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>})
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span><span style="color:#6272a4">// 加载入口模块
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9</span><span><span style="color:#6272a4"></span>seajs.use(<span style="color:#f1fa8c">&#34;../static/hello/src/main&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span>define(<span style="color:#8be9fd;font-style:italic">function</span>(require, exports, module) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>  <span style="color:#6272a4">// 通过 require 引入依赖
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">var</span> $ <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;jquery&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>  <span style="color:#8be9fd;font-style:italic">var</span> Spinning <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;./spinning&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>  <span style="color:#6272a4">// 通过 exports 对外提供接口
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#6272a4"></span>  exports.doSomething <span style="color:#ff79c6">=</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>  <span style="color:#6272a4">// 或者通过 module.exports 提供整个接口
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span><span style="color:#6272a4"></span>  module.exports <span style="color:#ff79c6">=</span> ...
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>});
</span></span></code></pre></div><h3 id="3-seajs-的同步魔法">3. sea.js 的同步魔法</h3>
<p>sea.js 采用依赖后置，使用的时候才加载，但是这样看起来不就是同步加载了吗，这个同步写法进行异步操作的模式，是怎么实现的呢？</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/sea.js%E5%90%8C%E6%AD%A5%E5%86%99%E6%B3%95%E8%A7%A3%E9%87%8A.png" alt=""></p>
<p>也就是说，<code>require.js</code> 和 <code>sea.js</code> 都是在执行模块前预加载了依赖的模块，并没有比 <code>require.js</code> 显得更“懒加载”，只是所依赖模块的代码执行时机不同。<code>require.js</code> 加载时执行，而 <code>sea.js</code> 是使用时执行。</p>
<p>其实从代码的写法也看得出来，<code>require.js</code> 的依赖模块在加载后便有了执行结果，并作为回调函数的实参传入。</p>
<ul>
<li><code>reuiqre.js</code> 写法：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#6272a4">// 加载完jquery.js后，得到的执行结果$作为参数传入了回调函数
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#6272a4"></span>define([<span style="color:#f1fa8c">&#39;jquery&#39;</span>], <span style="color:#8be9fd;font-style:italic">function</span>($) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>  $(<span style="color:#f1fa8c">&#39;#header&#39;</span>).hide();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>});
</span></span></code></pre></div><ul>
<li><code>sea.js</code> 写法：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#6272a4">// 预加载了jquery.js
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#6272a4"></span>define(<span style="color:#8be9fd;font-style:italic">function</span>(require, exports, module) {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>  <span style="color:#6272a4">// 执行jquery.js模块，并得到结果赋值给$
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">var</span> $ <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;jquery&#39;</span>);
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>  <span style="color:#6272a4">// 调用jquery.js模块提供的方法
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span><span style="color:#6272a4"></span>  $(<span style="color:#f1fa8c">&#39;#header&#39;</span>).hide();
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>});
</span></span></code></pre></div><p>从这一点上来看，两者在性能上并没有太多差异。因为最影响页面渲染速度的当然是资源的加载速度，既然都是预加载，那么加载模块资源的耗时是一样的（网络情况相同时）。</p>
<p>而模块代码的执行时机并没有那么影响性能（除非你的模块太大），现在的 <code>js</code> 引擎如 <code>V8</code> 引擎足够强，没什么压力。</p>
<h3 id="4-seajs-和-requirejs-的不同">4. sea.js 和 require.js 的不同</h3>
<h4 id="1-遵循规范不同">1. 遵循规范不同</h4>
<p>RequireJS 遵循 AMD（异步模块定义）规范，SeaJS 遵循 CMD （通用模块定义）规范。</p>
<h4 id="2-factory-执行时机不同">2. factory 执行时机不同</h4>
<p>sea.js 按需执行依赖避免浪费，但是 require 时才解析的行为对性能有影响。sea.js 是异步加载模块的没错, 但执行模块的顺序也是严格按照模块在代码中出现(require)的顺序。</p>
<p>require.js 更遵从 js 异步编程方式，提前执行依赖，输出顺序取决于哪个 js 先加载完（不过 require.js 从 2.0 开始，也改成可以延迟执行）。如果一定要让 模块 B 在 模块 A 之后执行，需要在 define 模块时申明依赖，或者通过 require.config 配置依赖。</p>
<p>如果两个模块之间突然模块 A 依赖模块 B，SeaJS 的懒执行可能有问题，而 RequireJS 不需要修改当前模块。当模块 A 依赖模块 B，模块 B 出错了：如果是 SeaJS，模块 A 执行了某操作，可能需要回滚。RequireJS 因为尽早执行依赖可以尽早发现错误，不需要回滚。</p>
<h4 id="3-聚焦点不同">3. 聚焦点不同</h4>
<p>SeaJS 努力成为浏览器端的模块加载器，RequireJS 牵三挂四，兼顾 Rhino 和 node，因此 RequireJS 比 SeaJS 的文件大。</p>
<h2 id="5-umd">5. umd</h2>
<p>ump 的内容很多，这一部分可以看另一篇文章《js umd 详解》</p>
<h2 id="6-es6-module">6. ES6 Module</h2>
<p>ES6 module 的内容很多，这一部分可以看另一篇文章《js es6_module 详解》</p>
<p>本篇文章是 js 模块化的第 1 篇，下一篇是《js umd 详解》。</p>
<p>最后的最后，附一段玉伯的访谈对话：</p>
<blockquote>
<p>我从开始做前端到现在已经有 13 年。一直以来，我觉得自己做技术时，追求的就是保持简单，追求技术的简单性，也追求做技术时心态的简单性。</p>
<p>在很多圈，包括技术圈，都有鄙视链的存在，比如说做 Java 的可能看不起做前端的，做前端的可能看不起做测试的，做产品的可能看不起做技术的，做运营的觉得产品都是为业务打工的。在这个鄙视链里，很多岗位的同学或多或少都会有职业上的困惑。</p>
<p>我知道很多前端同学，都会问自己一个问题，前端职业发展的天花板在什么地方？我究竟应该做几年前端？临近 35 岁要不要转型？很多同学都会有疑惑。但在这几年的工作经历里，我觉得其实每个岗位都很重要。我印象中逍遥子说过一句话，他说在公司里面，如果一个岗位不重要的话，其实早就取消了。每一位前端同学，每一位技术岗位的同学，职业上的困惑往往源自心态，要想在某个领域做到好，心态一定要保持简单，这一点很关键。</p>
<p>我经历过从前端转 Java，在做前端之前我是写 C++的。在转行过程中，我会问自己一个问题，究竟什么样的工作能让自己进入心流状态，能够让自己开心、有成就感、有价值感。然后我会发现在做前端写界面时，在做人机交互实现时，自己会没日没夜地去写代码，最终调试产出后很有喜悦感。只要一个岗位能够带给自己这种心流和喜悦感，那这个岗位对自己来说，就是很重要的。其实没必要去做很多横向比较。</p>
<p>比如说现在 AI 很火，算法很火，是不是我们都要去转型做人工智能？如果 AI 这一块确实能让你感觉到心流状态，能持续兴奋，去做就好。但如果只是为了去趁一个热点，那千万别去做。每一个岗位都很重要，不必去做比较。踢足球跟打篮球谁更重要？并不存在这种比较，每个人都很重要。这是我想分享的第一个点。</p>
</blockquote>

      </div>
      <div class="footer">
        <span><a class="category" href="https://tomtomyoung.top/categories/%E5%89%8D%E7%AB%AF/">前端</a><a class="category" href="https://tomtomyoung.top/categories/%E7%B2%BE%E9%80%89/">精选</a></span>
        <span><a class="tag" href="https://tomtomyoung.top/tags/js/">js</a><a class="tag" href="https://tomtomyoung.top/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/">模块化</a></span>
      </div>

      
    </div><ul class="menu">
    <li class="menu-item">
        <i class="iconfont icon-top item-btn" id="back_top_btn"></i>
    </li>
    <li class="menu-item">
        <a href="https://tomtomyoung.top/" id="back-btn">
            <i class="iconfont icon-home item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-switch item-btn" id="switch_btn"></i>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-search item-btn" id="search_btn"></i>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/js-%E9%97%AD%E5%8C%85%E8%AF%A6%E8%A7%A3/" data-tooltip="js 闭包详解">
            <i class="iconfont icon-left item-btn"></i>
            
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/js-%E8%A7%A3%E6%9E%84%E8%B5%8B%E5%80%BC/" data-tooltip="js 解构赋值">
            <i class="iconfont icon-right item-btn"></i>
            
        </a>
    </li>
</ul></div>
</div>

<div class="cover" id="cover">
        <div class="search-container">
    <input type="search" class="docsearch-input search-input" placeholder="搜索关键词" />
    
</div>
    </div>
</body>









<script src="https://tomtomyoung.top/js/util.min.de62c5a4eeb4a15e570ce5ace15cdc7bbf96a4c8c7a3dcfcddbaa34cf355658113e177923a32dcd98ba79b0f1a1af230cb9184da7bbf2c5bf86668b3615eff79.js" integrity="sha512-3mLFpO60oV5XDOWs4Vzce7&#43;WpMjHo9z83bqjTPNVZYET4XeSOjLc2Yunmw8aGvIwy5GE2nu/LFv4ZmizYV7/eQ=="></script></html>