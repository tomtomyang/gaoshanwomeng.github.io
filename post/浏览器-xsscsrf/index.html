<!DOCTYPE html>
<html lang="zh-cn" data-theme="light"><head>
  <meta name="google-site-verification" content="kw1N-Xm6qEr1c9PGuRd0U_T6DXkw_EHsLyz5LpuDDv8" />
  <meta name="msvalidate.01" content="EE98205D30806C22C519683EFC53E9BA" />
  <meta name="baidu-site-verification" content="iPC3wUcQLL" />
  <title> æµè§ˆå™¨ xss&amp;csrf</title>
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.74.3" /><meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1" />
  <meta name="description" itemprop="description"
    content=" æµè§ˆå™¨ xss&amp;csrf " />
  <meta name="keywords" itemprop="keywords"
    content=" [xss csrf] " />
  <base href="https://tomtomyoung.top/" />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap" media="print" onload="this.media='all'">

  
  <link rel="shortcut icon" href="https://tomtomyoung.top/favicons//favicon.ico" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://tomtomyoung.top/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://tomtomyoung.top/favicons/favicon-16x16.png" />
  <link rel="mask-icon" href="https://tomtomyoung.top/favicons/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="apple-touch-icon" sizes="180x180" href="https://tomtomyoung.top/favicons/apple-touch-icon.png">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="msapplication-TileImage" content="https://tomtomyoung.top/favicons/mstile-144x144.png">
  <link rel="manifest" href="https://tomtomyoung.top/manifest.json">

  
  <link rel="canonical" href="https://tomtomyoung.top/post/%E6%B5%8F%E8%A7%88%E5%99%A8-xsscsrf/" />
  <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_2450869_5vzvggza71i.css" />
  
  
  
  
  
  
  
  
  
  <link rel="stylesheet" href="https://tomtomyoung.top/css/style.min.css" integrity="" type="text/css" />

  
  
  
  <script type="text/javascript" src="https://tomtomyoung.top/js/docsearch.min.js" integrity=""></script>
</head><body class="animated fadeInDown">
<div class="main"><div class="percentage_container">
    <div class="percentage" id="percentage"></div>
</div><div class="toc sub-container">
    <div class="toc-header">
        <span>ç›®å½•</span>
    </div><ul class="toc-h3"><li>
                <span class="toc-link">1ï¼šä»€ä¹ˆæ˜¯XSSæ”»å‡»ï¼Ÿ</span>
            </li>
            <li>
                <span class="toc-link">2. å¸¸è§çš„XSSæ”»å‡»</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. åå°„å‹</span>
            </li>
            <li>
                <span class="toc-link">2. å­˜å‚¨å‹</span>
            </li>
            <li>
                <span class="toc-link">3. åŸºäºDOM</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">3. XSSæ”»å‡»çš„é˜²èŒƒ</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. CSP</span>
            </li>
            <li>
                <span class="toc-link">2. cookieå®‰å…¨ç­–ç•¥</span>
            </li>
            <li>
                <span class="toc-link">3. è¾“å…¥æ£€æŸ¥</span>
            </li>
            <li>
                <span class="toc-link">4. è¾“å‡ºæ£€æŸ¥</span>
            </li>
            <li>
                <span class="toc-link">5. CSS ç¼–ç </span>
            </li>
            
                    </ul><li>
                <span class="toc-link">4. CSRFæ”»å‡»</span>
            </li>
            <li>
                <span class="toc-link">5. CSRFçš„é˜²èŒƒ</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. éªŒè¯ HTTP Referer å­—æ®µ</span>
            </li>
            <li>
                <span class="toc-link">2. åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ  token</span>
            </li>
            </div><div class="single-post container">
    <div class="post">
      <div class="header">
        <span class="title">æµè§ˆå™¨ xss&amp;csrf</span>
        
        <div class="info">
          <span>ğŸ“… 2021-07-14</span>
          <span>ğŸ‘¦ Tomtom Young</span>
          <span>ğŸ“– 3728å­—</span>
          <span>â± 8åˆ†é’Ÿ</span>
        </div>
        
      </div>
      <div class="content markdown-body">
        <h3 id="1ä»€ä¹ˆæ˜¯xssæ”»å‡»">1ï¼šä»€ä¹ˆæ˜¯XSSæ”»å‡»ï¼Ÿ</h3>
<ul>
<li>XSSï¼Œå³ Cross Site Scriptï¼Œè·¨ç«™è„šæœ¬æ”»å‡»ï¼›</li>
<li>XSS æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åœ¨ç½‘ç«™ä¸Šæ³¨å…¥æ¶æ„çš„å®¢æˆ·ç«¯ä»£ç ï¼Œå¯¹å®¢æˆ·ç«¯ç½‘é¡µè¿›è¡Œç¯¡æ”¹ï¼Œå¯¹ç”¨æˆ·æµè§ˆå™¨è¿›è¡Œæ§åˆ¶æˆ–è€…è·å–ç”¨æˆ·éšç§æ•°æ®ï¼›</li>
<li>XSSæ”»å‡»å¯ä»¥åˆ†ä¸º3ç±»ï¼šåå°„å‹ï¼ˆéæŒä¹…å‹ï¼‰ã€å­˜å‚¨å‹ï¼ˆæŒä¹…å‹ï¼‰ã€åŸºäºDOMã€‚</li>
</ul>
<h3 id="2-å¸¸è§çš„xssæ”»å‡»">2. å¸¸è§çš„XSSæ”»å‡»</h3>
<h4 id="1-åå°„å‹">1. åå°„å‹</h4>
<ul>
<li>åå°„å‹æ˜¯ç®€å•åœ°æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œåå°„â€ ç»™æµè§ˆå™¨ï¼›</li>
<li>éœ€è¦æ”»å‡»è€…è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæ¶æ„é“¾æ¥ï¼Œæˆ–è€…æäº¤ä¸€ä¸ªè¡¨å•ï¼Œæˆ–è€…è¿›å…¥ä¸€ä¸ªæ¶æ„ç½‘ç«™æ—¶ï¼Œæ³¨å…¥è„šæœ¬è¿›å…¥è¢«æ”»å‡»è€…çš„ç½‘ç«™ã€‚</li>
</ul>
<p>å¸¸è§çš„åå°„æ€§XSSï¼šæ¶æ„é“¾æ¥ã€‚</p>
<blockquote>
<p>æ¯”å¦‚æˆ‘ç°åœ¨åšä¸€ä¸ªdemoï¼Œæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">&lt;!DOCTYPE html&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>&lt;<span style="color:#ff79c6">html</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>&lt;<span style="color:#ff79c6">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">charset</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">utf-8</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;referrer&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;never&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  &lt;<span style="color:#ff79c6">title</span>&gt;csrfæ”»å‡»&lt;/<span style="color:#ff79c6">title</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>&lt;/<span style="color:#ff79c6">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>&lt;<span style="color:#ff79c6">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  &lt;<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;http://localhost:3001/xss&#34;</span>&gt;xxs æ”»å‡»&lt;/<span style="color:#ff79c6">a</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;http://localhost:3001/testcookie&#34;</span>&gt;testcookie æ”»å‡»&lt;/<span style="color:#ff79c6">a</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  &lt;/<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>&lt;/<span style="color:#ff79c6">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></div><p>åœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªç®€å•çš„æœåŠ¡å™¨ï¼Œç„¶ånodeä¸­app.js ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">const</span> Koa <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">const</span> fs <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;fs&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">const</span> path <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;path&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span style="color:#ff79c6">const</span> router <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa-router&#39;</span>)();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#ff79c6">const</span> koaBody <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa-body&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#ff79c6">const</span> <span style="color:#ff79c6">static</span> <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#39;koa-static&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span style="color:#ff79c6">const</span> app <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Koa();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>router.get(<span style="color:#f1fa8c">&#39;/&#39;</span>, (ctx, next) =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  <span style="color:#6272a4">// è®¾ç½®å¤´ç±»å‹, å¦‚æœä¸è®¾ç½®ï¼Œä¼šç›´æ¥ä¸‹è½½è¯¥é¡µé¢
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#6272a4"></span>  ctx.type <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;html&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  <span style="color:#6272a4">// è¯»å–æ–‡ä»¶
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">const</span> pathUrl <span style="color:#ff79c6">=</span> path.join(__dirname, <span style="color:#f1fa8c">&#39;/static/index.html&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  ctx.body <span style="color:#ff79c6">=</span> fs.createReadStream(pathUrl);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>  next();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>});
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>router.get(<span style="color:#f1fa8c">&#39;/xss&#39;</span>, (ctx, next) =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>  ctx.body <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&lt;script&gt;alert(&#34;åå°„å‹ XSS æ”»å‡»&#34;)&lt;/script&gt;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>});
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>router.get(<span style="color:#f1fa8c">&#39;/testcookie&#39;</span>, (ctx, next) =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>  console.log(ctx.cookies.get(<span style="color:#f1fa8c">&#39;connect.sid&#39;</span>));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>  ctx.body <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&lt;script&gt;alert(&#34;&#39;</span><span style="color:#ff79c6">+</span>ctx.cookies.get(<span style="color:#f1fa8c">&#39;connect.sid&#39;</span>)<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#39;&#34;)&lt;/script&gt;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  next();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>});
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>app.use(<span style="color:#ff79c6">static</span>(path.join(__dirname)));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>app.use(router.routes());
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31</span>app.use(router.allowedMethods());
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33</span>app.listen(<span style="color:#bd93f9">3001</span>, () =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34</span>  console.log(<span style="color:#f1fa8c">&#39;server is listen in 3001&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35</span>});
</code></pre></div><p>å½“ç”¨æˆ·ç‚¹å‡»xxs æ”»å‡»æ¶æ„é“¾æ¥æ—¶å€™ï¼Œé¡µé¢ä¼šè·³è½¬åˆ° http://localhost:3001/xss æ”»å‡»è€…é¢„å…ˆå‡†å¤‡çš„é¡µé¢ï¼Œç„¶åä¼šè¿”å›æ”»å‡»è€…å‡†å¤‡çš„jsè„šæœ¬ï¼Œè¯¥jsè„šæœ¬å°±åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œäº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231214099-1234219577.png" alt="img"></p>
<p>å½“ç”¨æˆ·ç‚¹å‡» testcookie æ”»å‡» è¿™ä¸ªé“¾æ¥çš„æ—¶å€™ï¼Œé¦–å…ˆè¦ä¿è¯é¡µé¢ä¸Šæœ‰cookieï¼Œæ¯”å¦‚æˆ‘è¯·æ±‚å¦‚ä¸‹çš„cookie:</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231229205-1557810526.png" alt="img"></p>
<p>ç„¶åæˆ‘ä»¬ç‚¹å‡» testcookie è¯¥é“¾æ¥ï¼Œä¹Ÿä¼šè°ƒç”¨nodeä¸­çš„ router.get('/testcookie&rsquo;, (ctx, next) =&gt; {}) è¿™ä¸ªè¯·æ±‚è·å–åˆ°cookieï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231254328-364209115.png" alt="img"></p>
<p>æˆ‘ä»¬å°±é€šè¿‡xssæ”»å‡»æ‹¿åˆ°å¯¹æ–¹çš„cookieä¿¡æ¯äº†ã€‚</p>
</blockquote>
<h4 id="2-å­˜å‚¨å‹">2. å­˜å‚¨å‹</h4>
<ul>
<li>å­˜å‚¨å‹æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ® â€œå­˜å‚¨â€ åœ¨æœåŠ¡å™¨ç«¯ï¼Œå½“æµè§ˆå™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œè„šæœ¬ä»æœåŠ¡å™¨ä¸Šä¼ å›å¹¶æ‰§è¡Œã€‚è¿™ç§ XSS æ”»å‡»å…·æœ‰å¾ˆå¼ºçš„ç¨³å®šæ€§ï¼›</li>
<li>å¸¸è§çš„åœºæ™¯æ˜¯åŒ…å«æ¶æ„ JavaScript ä»£ç çš„æ–‡ç« æˆ–è¯„è®ºï¼Œå‘è¡¨åæ‰€æœ‰è®¿é—®è¯¥æ–‡ç« æˆ–è¯„è®ºçš„äººï¼Œéƒ½ä¼šæ‰§è¡Œè¿™æ®µæ¶æ„ä»£ç ã€‚</li>
</ul>
<h4 id="3-åŸºäºdom">3. åŸºäºDOM</h4>
<ul>
<li>åŸºäº DOM çš„ XSS æ”»å‡»æ˜¯æŒ‡é€šè¿‡æ¶æ„è„šæœ¬ä¿®æ”¹é¡µé¢çš„ DOM ç»“æ„ï¼Œæ˜¯çº¯ç²¹å‘ç”Ÿåœ¨å®¢æˆ·ç«¯çš„æ”»å‡»ã€‚</li>
<li>ä¸€èˆ¬æœ‰å¦‚ä¸‹DOMæ“ä½œï¼š
<ol>
<li>ä½¿ç”¨document.writeç›´æ¥è¾“å‡ºæ•°æ®ï¼›</li>
<li>ä½¿ç”¨innerHTMLç›´æ¥è¾“å‡ºæ•°æ®ï¼›</li>
<li>ä½¿ç”¨locationã€location.hrefã€location.replaceã€iframe.srcã€document.refererã€window.nameç­‰è¿™äº›ï¼›</li>
</ol>
</li>
</ul>
<blockquote>
<p><strong>ä½¿ç”¨document.writeã€innerHTMLç›´æ¥è¾“å‡ºå¯¼è‡´æµè§ˆå™¨è§£ææ¶æ„ä»£ç </strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">&lt;!DOCTYPE html&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>&lt;<span style="color:#ff79c6">html</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>&lt;<span style="color:#ff79c6">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">charset</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">utf-8</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;referrer&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;never&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  &lt;<span style="color:#ff79c6">title</span>&gt;&lt;/<span style="color:#ff79c6">title</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>&lt;/<span style="color:#ff79c6">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>&lt;<span style="color:#ff79c6">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;test&#39;</span>&gt;&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>&gt;&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    <span style="color:#6272a4">// è¿”å›URLä¸­çš„æŸ¥è¯¢éƒ¨åˆ†ï¼ˆï¼Ÿä¹‹åçš„å†…å®¹ï¼‰
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> location.search;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    <span style="color:#6272a4">// ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬å‡å¦‚urlæ˜¯ å¦‚ä¸‹è¿™æ ·çš„
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// http://127.0.0.1/xsstest.html?url=javascript:alert(&#39;xsstest&#39;); 
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// ç„¶åæˆ‘ä»¬çš„æ˜¯ s çš„å€¼å°±ä¸ºå¦‚ä¸‹ï¼š
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#6272a4"></span>    s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;?url=javascript:alert(&#39;xsstest&#39;)&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>    s <span style="color:#ff79c6">=</span> s.substring(<span style="color:#bd93f9">1</span>, s.length);       <span style="color:#6272a4">// è¿”å›æ•´ä¸ªæŸ¥è¯¢å†…å®¹
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">var</span> url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;                       <span style="color:#6272a4">// å®šä¹‰å˜é‡url
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">if</span> (s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) {       <span style="color:#6272a4">// åˆ¤æ–­URLæ˜¯å¦ä¸ºç©º 
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">var</span> pos <span style="color:#ff79c6">=</span> s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">4</span>;  <span style="color:#6272a4">// è¿‡æ»¤æ‰&#34;url=&#34;å­—ç¬¦
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span><span style="color:#6272a4"></span>      url <span style="color:#ff79c6">=</span> s.substring(pos, s.length);  <span style="color:#6272a4">// å¾—åˆ°åœ°å€æ é‡Œçš„urlå‚æ•°
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span><span style="color:#6272a4"></span>    } <span style="color:#ff79c6">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>      url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;urlå‚æ•°ä¸ºç©º&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>    <span style="color:#8be9fd;font-style:italic">document</span>.write(<span style="color:#f1fa8c">&#39;url: &lt;a href=&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&gt;&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&lt;/a&gt;&#39;</span>); 
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>    <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;test&#34;</span>).innerHTML <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;æˆ‘çš„urlæ˜¯: &lt;a href=&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&gt;&#34;&#39;</span> <span style="color:#ff79c6">+</span> url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&#34;&lt;/a&gt;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>  &lt;/<span style="color:#ff79c6">script</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>&lt;/<span style="color:#ff79c6">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></div><p>é¡µé¢æ¸²æŸ“å®Œæˆåï¼Œç‚¹å‡»å¼¹çª—å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/561794-20190522231742177-474046373.png" alt="img"></p>
<p><strong>ä½¿ç”¨location/location.href/location.replace/iframe.src é€ æˆçš„XSS</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">&lt;!DOCTYPE html&gt;</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>&lt;<span style="color:#ff79c6">html</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>&lt;<span style="color:#ff79c6">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">charset</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">utf-8</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  &lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;referrer&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;never&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  &lt;<span style="color:#ff79c6">title</span>&gt;&lt;/<span style="color:#ff79c6">title</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>&lt;/<span style="color:#ff79c6">head</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>&lt;<span style="color:#ff79c6">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> location.search;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;?url=javascript:alert(&#39;xsstest&#39;)&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    s <span style="color:#ff79c6">=</span> s.substring(<span style="color:#bd93f9">1</span>, s.length);       <span style="color:#6272a4">// è¿”å›æ•´ä¸ªæŸ¥è¯¢å†…å®¹
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">var</span> url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;                       <span style="color:#6272a4">// å®šä¹‰å˜é‡url
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">if</span> (s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) {       <span style="color:#6272a4">// åˆ¤æ–­URLæ˜¯å¦ä¸ºç©º 
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">var</span> pos <span style="color:#ff79c6">=</span> s.indexOf(<span style="color:#f1fa8c">&#34;url=&#34;</span>) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">4</span>;  <span style="color:#6272a4">// è¿‡æ»¤æ‰&#34;url=&#34;å­—ç¬¦
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#6272a4"></span>      url <span style="color:#ff79c6">=</span> s.substring(pos, s.length);  <span style="color:#6272a4">// å¾—åˆ°åœ°å€æ é‡Œçš„urlå‚æ•°
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span style="color:#6272a4"></span>    } <span style="color:#ff79c6">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>      url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;urlå‚æ•°ä¸ºç©º&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>  &lt;/<span style="color:#ff79c6">script</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>  &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;test&#39;</span>&gt;&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>&gt;&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>    location.href <span style="color:#ff79c6">=</span> url;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>  &lt;/<span style="color:#ff79c6">script</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>&lt;/<span style="color:#ff79c6">body</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></div><p>åˆ·æ–°ä¸‹é¡µé¢ï¼Œä¹Ÿä¼šå¼¹å‡ºçª—å£æ‰§è¡Œ xssæ”»å‡»äº†ã€‚</p>
</blockquote>
<h3 id="3-xssæ”»å‡»çš„é˜²èŒƒ">3. XSSæ”»å‡»çš„é˜²èŒƒ</h3>
<h4 id="1-csp">1. CSP</h4>
<ul>
<li>CSPæ˜¯å†…å®¹å®‰å…¨ç­–ç•¥ï¼›</li>
<li>CSPå°±æ˜¯ä¸€ä¸ªæŠŠç™½åå•ï¼šç½‘ç«™é€šè¿‡å‘é€ä¸€ä¸ª CSP å¤´éƒ¨å‘Šè¯‰æµè§ˆå™¨è¿™ä¸ªç½‘ç«™ä»€ä¹ˆæ˜¯è¢«å¯ä»¥æ‰§è¡Œçš„ï¼Œä»€ä¹ˆæ˜¯éœ€è¦è¢«ç¦æ­¢çš„ã€‚</li>
</ul>
<blockquote>
<p>æˆ‘ä»¬åªéœ€è¦åœ¨metaå±æ€§ä¸­è®¾ç½®ä¸‹å³å¯ï¼šå¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>&lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">http-equiv</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Content-Security-Policy&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>&gt;
</code></pre></div><p>æ¯”å¦‚å¦‚ä¸‹çš„åˆ—å­ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>&lt;<span style="color:#ff79c6">meta</span> <span style="color:#50fa7b">http-equiv</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Content-Security-Policy&#34;</span> <span style="color:#50fa7b">content</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span style="color:#f1fa8c">default-src http: https:  *.xxx.com &#39;self&#39; &#39;unsafe-inline&#39; ;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span style="color:#f1fa8c">style-src &#39;self&#39; &#39;unsafe-inline&#39; *.yyy.com;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span style="color:#f1fa8c">script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; ;
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span style="color:#f1fa8c">&#34;</span>&gt;
</code></pre></div><p><strong>contentä¸‹æœ‰å¦‚ä¸‹ç±»åˆ«ï¼š</strong></p>
<p>default-src ç»™ä¸‹é¢æ‰€æœ‰çš„è§„åˆ™è®¾å®šä¸€ä¸ªé»˜è®¤å€¼
script-src å¤–éƒ¨è„šæœ¬
style-src æ ·å¼è¡¨
img-src å›¾åƒ
media-src åª’ä½“æ–‡ä»¶ï¼ˆéŸ³é¢‘å’Œè§†é¢‘ï¼‰
font-src å­—ä½“æ–‡ä»¶
object-src æ’ä»¶ï¼ˆæ¯”å¦‚ Flashï¼‰
child-src æ¡†æ¶
frame-ancestors åµŒå…¥çš„å¤–éƒ¨èµ„æºï¼ˆæ¯”å¦‚ã€<code>&lt;iframe&gt;</code>ã€å’Œï¼‰
connect-src HTTP è¿æ¥ï¼ˆé€šè¿‡ XHRã€WebSocketsã€EventSourceç­‰ï¼‰
worker-src workerè„šæœ¬
manifest-src manifest æ–‡ä»¶</p>
<p><strong>script-srcæœ‰å¦‚ä¸‹å±æ€§å€¼ï¼š</strong></p>
<p>unsafe-inline å…è®¸æ‰§è¡Œé¡µé¢å†…åµŒçš„<code>&lt;script&gt;</code>æ ‡ç­¾å’Œäº‹ä»¶ç›‘å¬å‡½æ•°
unsafe-eval å…è®¸å°†å­—ç¬¦ä¸²å½“ä½œä»£ç æ‰§è¡Œï¼Œæ¯”å¦‚ä½¿ç”¨evalã€setTimeoutã€setIntervalå’ŒFunctionç­‰å‡½æ•°
nonce æ¯æ¬¡HTTPå›åº”ç»™å‡ºä¸€ä¸ªæˆæƒtokenï¼Œé¡µé¢å†…åµŒè„šæœ¬å¿…é¡»æœ‰è¿™ä¸ªtokenï¼Œæ‰ä¼šæ‰§è¡Œ
hash åˆ—å‡ºå…è®¸æ‰§è¡Œçš„è„šæœ¬ä»£ç çš„Hashå€¼ï¼Œé¡µé¢å†…åµŒè„šæœ¬çš„å“ˆå¸Œå€¼åªæœ‰å»åˆçš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ‰§è¡Œ</p>
</blockquote>
<h4 id="2-cookieå®‰å…¨ç­–ç•¥">2. cookieå®‰å…¨ç­–ç•¥</h4>
<ul>
<li>æ”»å‡»è€…å¯ä»¥é€šè¿‡æ³¨å…¥æ¶æ„è„šæœ¬è·å–ç”¨æˆ·çš„ Cookie ä¿¡æ¯ã€‚é€šå¸¸ Cookie ä¸­éƒ½åŒ…å«äº†ç”¨æˆ·çš„ç™»å½•å‡­è¯ä¿¡æ¯ï¼›</li>
</ul>
<blockquote>
<ul>
<li>
<p><strong>http-only:</strong></p>
<p>åªå…è®¸httpæˆ–httpsè¯·æ±‚è¯»å–cookieã€JSä»£ç æ˜¯æ— æ³•è¯»å–cookieçš„(document.cookieä¼šæ˜¾ç¤ºhttp-onlyçš„cookieé¡¹è¢«è‡ªåŠ¨è¿‡æ»¤æ‰)ã€‚å‘é€è¯·æ±‚æ—¶è‡ªåŠ¨å‘é€cookie.</p>
</li>
<li>
<p><strong>secure-only:</strong></p>
<p>åªå…è®¸httpsè¯·æ±‚è¯»å–ï¼Œå‘é€è¯·æ±‚æ—¶è‡ªåŠ¨å‘é€cookieã€‚</p>
</li>
<li>
<p><strong>host-only:</strong></p>
<p>åªå…è®¸ä¸»æœºåŸŸåä¸domainè®¾ç½®å®Œæˆä¸€è‡´çš„ç½‘ç«™æ‰èƒ½è®¿é—®è¯¥cookieã€‚</p>
</li>
</ul>
</blockquote>
<h4 id="3-è¾“å…¥æ£€æŸ¥">3. è¾“å…¥æ£€æŸ¥</h4>
<ul>
<li>ä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„ä»»ä½•è¾“å…¥ã€‚ å¯¹äºç”¨æˆ·çš„ä»»ä½•è¾“å…¥è¦è¿›è¡Œæ£€æŸ¥ã€è¿‡æ»¤å’Œè½¬ä¹‰ï¼›</li>
<li>å»ºç«‹å¯ä¿¡ä»»çš„å­—ç¬¦å’Œ HTML æ ‡ç­¾ç™½åå•ï¼Œå¯¹äºä¸åœ¨ç™½åå•ä¹‹åˆ—çš„å­—ç¬¦æˆ–è€…æ ‡ç­¾è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ï¼›</li>
<li>æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸­æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ï¼Œä¹Ÿç§°ä¸º XSS Filterï¼›</li>
<li>åœ¨ä¸€äº›å‰ç«¯æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä»½ decodingMapï¼Œ ç”¨äºå¯¹ç”¨æˆ·è¾“å…¥æ‰€åŒ…å«çš„ç‰¹æ®Šå­—ç¬¦æˆ–æ ‡ç­¾è¿›è¡Œç¼–ç æˆ–è¿‡æ»¤ã€‚</li>
</ul>
<h4 id="4-è¾“å‡ºæ£€æŸ¥">4. è¾“å‡ºæ£€æŸ¥</h4>
<ul>
<li>ç”¨æˆ·çš„è¾“å…¥ä¼šå­˜åœ¨é—®é¢˜ï¼ŒæœåŠ¡ç«¯çš„è¾“å‡ºä¹Ÿä¼šå­˜åœ¨é—®é¢˜ï¼›</li>
<li>åœ¨å˜é‡è¾“å‡ºåˆ° HTML é¡µé¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç æˆ–è½¬ä¹‰çš„æ–¹å¼æ¥é˜²å¾¡ XSS æ”»å‡»ã€‚</li>
</ul>
<blockquote>
<p><strong>HTMLç¼–ç </strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4">// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°htmlç¼–ç 
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">function</span> htmlEncodeByRegExp(str) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>  <span style="color:#ff79c6">if</span> (str.length <span style="color:#ff79c6">===</span> <span style="color:#bd93f9">0</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#ff79c6">return</span> s;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  <span style="color:#ff79c6">return</span> (s <span style="color:#ff79c6">+</span> str)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    .replace(<span style="color:#f1fa8c">/&amp;/g</span>, <span style="color:#f1fa8c">&#34;&amp;amp;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    .replace(<span style="color:#f1fa8c">/&lt;/g</span>, <span style="color:#f1fa8c">&#34;&amp;lt;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>    .replace(<span style="color:#f1fa8c">/&gt;/g</span>, <span style="color:#f1fa8c">&#34;&amp;gt;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    .replace(<span style="color:#f1fa8c">/ /g</span>, <span style="color:#f1fa8c">&#34;&amp;nbsp;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    .replace(<span style="color:#f1fa8c">/\&#39;/g</span>, <span style="color:#f1fa8c">&#34;&amp;#39&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    .replace(<span style="color:#f1fa8c">/\&#34;/g</span>, <span style="color:#f1fa8c">&#34;&amp;quot;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>    .replace(<span style="color:#f1fa8c">/\//g</span>, <span style="color:#f1fa8c">&#39;&amp;#x2F;&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#6272a4">// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å®ç°htmlè§£ç 
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">function</span> htmlDecodeByRegExp(str) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>  <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>  <span style="color:#ff79c6">if</span> (str.length <span style="color:#ff79c6">===</span> <span style="color:#bd93f9">0</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    <span style="color:#ff79c6">return</span> s;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>  <span style="color:#ff79c6">return</span> (s <span style="color:#ff79c6">+</span> str)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>    .replace(<span style="color:#f1fa8c">/&amp;amp;/g</span>, <span style="color:#f1fa8c">&#34;&amp;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>    .replace(<span style="color:#f1fa8c">/&amp;lt;/g</span>, <span style="color:#f1fa8c">&#34;&lt;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>    .replace(<span style="color:#f1fa8c">/&amp;gt;/g</span>, <span style="color:#f1fa8c">&#34;&gt;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>    .replace(<span style="color:#f1fa8c">/&amp;nbsp;/g</span>, <span style="color:#f1fa8c">&#34; &#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    .replace(<span style="color:#f1fa8c">/&amp;#39/g</span>, <span style="color:#f1fa8c">&#34;\&#39;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>    .replace(<span style="color:#f1fa8c">/&amp;quot;/g</span>, <span style="color:#f1fa8c">&#34;\&#34;&#34;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>    .replace(<span style="color:#f1fa8c">/&amp;#x2F;/g</span>, <span style="color:#f1fa8c">&#34;\/&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>}
</code></pre></div><p><strong>HTML Attributeç¼–ç </strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#8be9fd;font-style:italic">function</span> encodeForHTMLAttibute(str) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#8be9fd;font-style:italic">let</span> encoded <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#ff79c6">for</span>(<span style="color:#8be9fd;font-style:italic">let</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> str.length; i<span style="color:#ff79c6">++</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    <span style="color:#8be9fd;font-style:italic">let</span> ch <span style="color:#ff79c6">=</span> hex <span style="color:#ff79c6">=</span> str[i];
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span><span style="color:#f1fa8c">/[A-Za-z0-9]/</span>.test(str[i]) <span style="color:#ff79c6">&amp;&amp;</span> str.charCodeAt(i) <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">256</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>      hex <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&amp;#x&#39;</span> <span style="color:#ff79c6">+</span> ch.charCodeAt(<span style="color:#bd93f9">0</span>).toString(<span style="color:#bd93f9">16</span>) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>    encoded <span style="color:#ff79c6">+=</span> hex;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>  <span style="color:#ff79c6">return</span> encoded;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>};
</code></pre></div><p><strong>URL ç¼–ç </strong></p>
<p>å°†ä¸å¯ä¿¡æ•°æ®ä½œä¸º URL å‚æ•°å€¼æ—¶éœ€è¦å¯¹å‚æ•°è¿›è¡Œ URL ç¼–ç </p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span style="color:#8be9fd;font-style:italic">function</span> encodeForURL(str){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>  <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">encodeURIComponent</span>(str);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span>};
</code></pre></div></blockquote>
<h4 id="5-css-ç¼–ç ">5. CSS ç¼–ç </h4>
<ul>
<li>å°†ä¸å¯ä¿¡æ•°æ®ä½œä¸º CSS æ—¶è¿›è¡Œ CSS ç¼–ç ï¼›</li>
</ul>
<blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span>&lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">style</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;background-image: url(javascript:alert(&#39;xss&#39;));&#34;</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span>&lt;<span style="color:#ff79c6">style</span>&gt;<span style="color:#ff79c6">body</span>{<span style="color:#ff79c6">background-image</span>: <span style="color:#8be9fd;font-style:italic">url</span>(<span style="color:#f1fa8c">&#34;javascript:alert(&#39;xss&#39;)&#34;</span>);}&lt;/<span style="color:#ff79c6">style</span>&gt;
</code></pre></div><p>ç¼–ç è§„åˆ™ï¼šé™¤äº†å­—æ¯æ•°å­—å­—ç¬¦ä»¥å¤–ï¼Œä½¿ç”¨\XXXXXXæ ¼å¼æ¥è½¬ä¹‰ASCIIå€¼å°äº256çš„æ‰€æœ‰å­—ç¬¦ã€‚ ç¼–ç ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#8be9fd;font-style:italic">function</span> encodeForCSS (attr, str){
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>  <span style="color:#8be9fd;font-style:italic">let</span> encoded <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">let</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> str.length; i<span style="color:#ff79c6">++</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>    <span style="color:#8be9fd;font-style:italic">let</span> ch <span style="color:#ff79c6">=</span> str.charAt(i);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>ch.match(<span style="color:#f1fa8c">/[a-zA-Z0-9]/</span>) {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>      <span style="color:#8be9fd;font-style:italic">let</span> hex <span style="color:#ff79c6">=</span> str.charCodeAt(i).toString(<span style="color:#bd93f9">16</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>      <span style="color:#8be9fd;font-style:italic">let</span> pad <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;000000&#39;</span>.substr((hex.length));
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>      encoded <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;\\&#39;</span> <span style="color:#ff79c6">+</span> pad <span style="color:#ff79c6">+</span> hex;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>    } <span style="color:#ff79c6">else</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>      encoded <span style="color:#ff79c6">+=</span> ch;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>    }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  <span style="color:#ff79c6">return</span> encoded;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>};
</code></pre></div></blockquote>
<h3 id="4-csrfæ”»å‡»">4. CSRFæ”»å‡»</h3>
<ul>
<li>CSRFï¼ŒCross Site Request Forgeryï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ï¼Œæ˜¯ä¸€ç§åŠ«æŒå—ä¿¡ä»»ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€éé¢„æœŸè¯·æ±‚çš„æ”»å‡»æ–¹å¼ï¼›</li>
<li>æ”»å‡»è€…å€ŸåŠ©å—å®³è€…çš„ Cookie éª—å–æœåŠ¡å™¨çš„ä¿¡ä»»ï¼Œåœ¨å—å®³è€…ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä»¥å—å®³è€…åä¹‰ä¼ªé€ è¯·æ±‚å‘é€ç»™å—æ”»å‡»æœåŠ¡å™¨ã€‚</li>
</ul>
<p><strong>1. æµè§ˆå™¨çš„ Cookie ç­–ç•¥</strong></p>
<ul>
<li>
<p>Cookie æ˜¯æœåŠ¡å™¨å‘é€åˆ°ç”¨æˆ·æµè§ˆå™¨å¹¶ä¿å­˜åœ¨æœ¬åœ°çš„ä¸€å°å—æ•°æ®ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹æ¬¡å‘åŒä¸€æœåŠ¡å™¨å†å‘èµ·è¯·æ±‚æ—¶è¢«æºå¸¦å¹¶å‘é€åˆ°æœåŠ¡å™¨ä¸Šï¼›</p>
</li>
<li>
<p>Cookie ç»å¸¸ç”¨åœ¨ä¼šè¯çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ã€æ¸¸æˆåˆ†æ•°æˆ–å…¶å®ƒéœ€è¦è®°å½•çš„ä¿¡æ¯ï¼‰ï¼›</p>
</li>
<li>
<p>æµè§ˆå™¨æ‰€æŒæœ‰çš„ Cookie åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>Session Cookie(ä¼šè¯æœŸ Cookie)ï¼Œä»…åœ¨ä¼šè¯æœŸå†…æœ‰æ•ˆï¼Œæµè§ˆå™¨å…³é—­ä¹‹åå®ƒä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼›</li>
<li>Permanent Cookie(æŒä¹…æ€§ Cookie)ï¼Œ å¯ä»¥æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„è¿‡æœŸæ—¶é—´ï¼ˆExpiresï¼‰æˆ–æœ‰æ•ˆæœŸï¼ˆMax-Ageï¼‰ï¼›</li>
</ul>
</li>
<li>
<p>æ¯ä¸ª Cookie éƒ½ä¼šæœ‰å…³è”çš„åŸŸï¼Œè¿™ä¸ªåŸŸçš„èŒƒå›´ä¸€èˆ¬é€šè¿‡ donmain å±æ€§æŒ‡å®šï¼›</p>
</li>
<li>
<p>å¦‚æœ Cookie çš„åŸŸå’Œé¡µé¢çš„åŸŸç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™ä¸ª Cookie ä¸ºç¬¬ä¸€æ–¹ Cookieï¼›</p>
</li>
<li>
<p>å¦‚æœ Cookie çš„åŸŸå’Œé¡µé¢çš„åŸŸä¸åŒï¼Œåˆ™ç§°ä¹‹ä¸ºç¬¬ä¸‰æ–¹ Cookieï¼›</p>
</li>
<li>
<p>ä¸€ä¸ªé¡µé¢åŒ…å«å›¾ç‰‡æˆ–å­˜æ”¾åœ¨å…¶ä»–åŸŸä¸Šçš„èµ„æºï¼ˆå¦‚å›¾ç‰‡ï¼‰æ—¶ï¼Œç¬¬ä¸€æ–¹çš„ Cookie ä¹Ÿä¼šå‘é€ç»™è®¾ç½®å®ƒä»¬çš„æœåŠ¡å™¨ã€‚</p>
</li>
</ul>
<p><strong>2. é€šè¿‡ Cookie è¿›è¡Œ CSRF æ”»å‡»</strong></p>
<ul>
<li>å­˜åœ¨ç½‘ç«™a.comï¼Œç™»é™†åa.comå·²ç»ä¿å­˜äº†Cookieï¼›</li>
<li>ä¼ªé€ ä¸€ä¸ªæ”»å‡»è€…ç½‘ç«™ï¼Œç½‘ç«™å†…æ”¾ç½®ä¸€ä¸ªå›¾ç‰‡imgï¼ŒsrcæŒ‡å‘äº†ä¸€ä¸ªa.comçš„è¯·æ±‚a.com/delete?id=1ï¼›</li>
<li>å½“aè·³è½¬åˆ°b.comæ—¶ï¼Œå°±ä¼šå‘èµ·srcä¸­çš„è¯·æ±‚ï¼Œä¸”æºå¸¦äº†è‡ªå·±çš„Cookieï¼›</li>
<li>a.comçš„æœåŠ¡å™¨æ¥åˆ°äº†è¯·æ±‚ï¼Œä»¥ä¸ºæ˜¯ç½‘é¡µè‡ªå·±ä¸»åŠ¨å‘å‡ºçš„ï¼Œå°±æ‰§è¡Œäº†è¯·æ±‚ã€‚</li>
</ul>
<h3 id="5-csrfçš„é˜²èŒƒ">5. CSRFçš„é˜²èŒƒ</h3>
<h4 id="1-éªŒè¯-http-referer-å­—æ®µ">1. éªŒè¯ HTTP Referer å­—æ®µ</h4>
<ul>
<li>HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œå®ƒè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ï¼›</li>
<li>é˜²å¾¡ CSRF æ”»å‡»ï¼Œåªéœ€è¦å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚éªŒè¯å…¶ Referer å€¼ï¼ŒéªŒè¯è¯¥è¯·æ±‚æ˜¯æ¥è‡ªç½‘ç«™è‡ªå·±çš„è¯·æ±‚ï¼Œ</li>
</ul>
<h4 id="2-åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ -token">2. åœ¨è¯·æ±‚åœ°å€ä¸­æ·»åŠ  token</h4>
<ul>
<li>CSRF æ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºå¯ä»¥å®Œå…¨ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­æ‰€æœ‰çš„ç”¨æˆ·éªŒè¯ä¿¡æ¯éƒ½æ˜¯å­˜åœ¨äº cookie ä¸­ï¼›</li>
<li>æŠµå¾¡ CSRFï¼Œå…³é”®åœ¨äºåœ¨è¯·æ±‚ä¸­æ”¾å…¥é»‘å®¢æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯ä¸å­˜åœ¨äº cookie ä¹‹ä¸­ï¼›</li>
<li>åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯æ‹¦æˆªéªŒè¯ï¼Œå¦‚æœæ²¡æœ‰ token æˆ–å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™æ‹’ç»ã€‚</li>
</ul>

      </div>
      <div class="footer">
        <span><a class="category" href="https://tomtomyoung.top/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a><a class="category" href="https://tomtomyoung.top/categories/%E7%B2%BE%E9%80%89/">ç²¾é€‰</a></span>
        <span><a class="tag" href="https://tomtomyoung.top/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/">æµè§ˆå™¨</a><a class="tag" href="https://tomtomyoung.top/tags/xss/">xss</a><a class="tag" href="https://tomtomyoung.top/tags/csrf/">csrf</a></span>
      </div>
    </div>

    <ul class="menu">
    <li class="menu-item">
        <i class="iconfont icon-top item-btn" id="back_top_btn"></i>
    </li>
    <li class="menu-item">
        <a href="https://tomtomyoung.top/" id="back-btn">
            <i class="iconfont icon-home item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-switch item-btn" id="switch_btn"></i>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-search item-btn" id="search_btn"></i>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/js-promise%E8%AF%A6%E8%A7%A3/" data-tooltip="js Promiseè¯¦è§£">
            <i class="iconfont icon-left item-btn"></i>
            
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/js-map%E8%AF%A6%E8%A7%A3/" data-tooltip="js Mapè¯¦è§£">
            <i class="iconfont icon-right item-btn"></i>
            
        </a>
    </li>
</ul>

  </div>
</div>

<div class="cover" id="cover">
        <div class="search-container">
    <input type="search" class="docsearch-input search-input" placeholder="æœç´¢å…³é”®è¯" />
    
</div>
    </div>
</body>








<script type="text/javascript" src="https://tomtomyoung.top/js/util.min.js" integrity=""></script>
<script>
    if ('serviceWorker' in navigator) {
        const PREFETCH = true;
        const PREFETCH_LINK_RELS = ['index', 'next', 'prev', 'prefetch'];
        function prefetchCache () {
            if (navigator.serviceWorker.controller) {
                let links = document.querySelectorAll(
                    PREFETCH_LINK_RELS.map((rel) => {
                        return 'link[rel=' + rel + ']';
                    }).join(',')
                );
                if (links.length > 0) {
                    Array.from(links)
                        .map((link) => {
                            let href = link.getAttribute('href');
                            navigator.serviceWorker.controller.postMessage({
                                action: 'cache',
                                url: href,
                            });
                        });
                }
            }
        }

        navigator.serviceWorker
            .register('/serviceWorker.js', { scope: '/' })
            .then(() => {
                console.log('Service Worker Registered');
            });

        navigator.serviceWorker
            .ready
            .then(() => {
                if (PREFETCH) {
                    console.log('Service Worker Ready');
                    prefetchCache();
                }
            });
    }
</script></html>