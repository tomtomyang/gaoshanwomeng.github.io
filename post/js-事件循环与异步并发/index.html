<!DOCTYPE html>
<html lang="zh-cn" data-theme="light"><head>
    <meta name="google-site-verification" content="kw1N-Xm6qEr1c9PGuRd0U_T6DXkw_EHsLyz5LpuDDv8" />
    <meta name="msvalidate.01" content="EE98205D30806C22C519683EFC53E9BA" />
    <meta name="baidu-site-verification" content="iPC3wUcQLL" />
    <title>  js äº‹ä»¶å¾ªç¯ä¸å¼‚æ­¥å¹¶å‘ </title>
    <meta charset="utf-8" /><meta name="generator" content="Hugo 0.74.3" /><meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta name="description" itemprop="description"
        content=" js äº‹ä»¶å¾ªç¯ä¸å¼‚æ­¥å¹¶å‘ " />
    <meta name="keywords" itemprop="keywords"
        content=" [js äº‹ä»¶å¾ªç¯ä¸å¼‚æ­¥å¹¶å‘] " />
    <base href="https://tomtomyoung.top/">
    <link rel="shortcut icon" href="https://tomtomyoung.top/favicons//favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="https://tomtomyoung.top/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://tomtomyoung.top/favicons/favicon-16x16.png">
    <link rel="canonical" href="https://tomtomyoung.top/post/js-%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E4%B8%8E%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91/">
    <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_2450869_iypnqhtzjei.css">
    
    
    
    
    
    
    
    
    
    <link rel="stylesheet" href="https://tomtomyoung.top/css/style.min.055753282b6ac09fa55cab335d0b741082b8d559a711f8f22b98b98ac3dd1bb2.css" integrity="" type="text/css">
    
    
    <script type="text/javascript" src="https://tomtomyoung.top/js/docsearch.min.69f8ad33daa0ba1950834aaf16111d935f6a7e2b03db2cc2ae537724142b2719782bcea9aba5996af27f6f94a8365b6575ce2eff90506c2bba9aa0411587116c.js" integrity=""></script>
</head><body class="animated fadeInDown">
<div class="main"><div class="percentage_container">
    <div class="percentage" id="percentage"></div>
</div><div class="toc sub-container">
    <div class="toc-header">
        <span>ç›®å½•</span>
    </div><ul class="toc-h3"><li>
                <span class="toc-link">1. JSäº‹ä»¶</span>
            </li>
            <li>
                <span class="toc-link">2. JSäº‹ä»¶çš„ç»„ç»‡å½¢å¼</span>
            </li>
            <li>
                <span class="toc-link">3. JSäº‹ä»¶å¾ªç¯</span>
            </li>
            <li>
                <span class="toc-link">4. å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</span>
            </li>
            <li>
                <span class="toc-link">5. asyncå’Œawait</span>
            </li>
            </div><div class="single-post container">
    <div class="post">
      <div class="header">
        <span class="title">js äº‹ä»¶å¾ªç¯ä¸å¼‚æ­¥å¹¶å‘</span>
        
        <div class="info">
          <span>ğŸ“… 2021-06-25</span>
          <span>ğŸ‘¦ Tomtom Young</span>
          <span>ğŸ“– 6376å­—</span>
          <span>â± 13åˆ†é’Ÿ</span>
        </div>
        
      </div>
      <div class="content markdown-body">
        <blockquote>
<p>å‚è€ƒï¼š</p>
<p><a href="https://towardsdev.com/event-loop-in-javascript-672c07618dc9">The JavaScript Event Loop: Explained</a></p>
<p><a href="https://262.ecma-international.org/6.0/">ES2015(ES6)</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/EventLoop">MDN_å¹¶å‘æ¨¡å‹ä¸äº‹ä»¶å¾ªç¯</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide/In_depth">MDN_æ·±å…¥ï¼šå¾®ä»»åŠ¡å’Œ JavaScript è¿è¡Œæ—¶ç¯å¢ƒ</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide">MDN_åœ¨ JavaScript ä¸­é€šè¿‡ queueMicrotask() ä½¿ç”¨å¾®ä»»åŠ¡</a></p>
<p><a href="https://nodejs.org/zh-cn/docs/guides/event-loop-timers-and-nexttick/#what-is-the-event-loop">Node.js_event_loop</a></p>
<p><a href="https://html.spec.whatwg.org/multipage/webappapis.html#event-loops">WHATWGè§„èŒƒ_event_loop</a></p>
<p><a href="https://javascript.info/event-loop">JavaScript Info_event-loop</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1701427">å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html">JavaScript è¿è¡Œæœºåˆ¶è¯¦è§£ï¼šå†è°ˆEvent Loop</a></p>
<p><a href="https://zh.javascript.info/event-loop">äº‹ä»¶å¾ªç¯ï¼šå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡</a></p>
<p><a href="https://www.cnblogs.com/wxcbg/p/11040362.html">æµè§ˆå™¨äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼ˆevent loopï¼‰</a></p>
</blockquote>
<h3 id="1-jsäº‹ä»¶">1. JSäº‹ä»¶</h3>
<blockquote>
<p>The event loop is the secret behind JavaScriptâ€™s asynchronous programming. JS executes all operations on a single thread, but using a few smart data structures, gives us the illusion of multi-threading. The asynchronous behavior is not part of the JavaScript language itself, rather it is built on top of the core JavaScript language in the browser (or the programming environment) and accessed through the browser APIs.</p>
</blockquote>
<p>äº‹ä»¶å¾ªç¯æ˜¯JavaScriptå¼‚æ­¥ç¼–ç¨‹èƒŒåçš„ç§˜å¯†ã€‚JSåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸Šæ‰§è¡Œæ‰€æœ‰çš„æ“ä½œï¼Œä½†æ˜¯ä½¿ç”¨ä¸€äº›ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼Œè¿›è¡Œä¸€äº›ç‰¹æ®Šçš„æ“ä½œï¼Œç»™æˆ‘ä»¬ä¸€ç§å¤šçº¿ç¨‹çš„é”™è§‰ã€‚å¼‚æ­¥è¡Œä¸ºä¸æ˜¯JavaScriptè¯­è¨€æœ¬èº«çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯æ„å»ºåœ¨æµè§ˆå™¨(æˆ–ç¼–ç¨‹ç¯å¢ƒ)çš„æ ¸å¿ƒJavaScriptè¯­è¨€ä¹‹ä¸Šï¼Œå¹¶é€šè¿‡æµè§ˆå™¨apiè¿›è¡Œè®¿é—®ã€‚</p>
<blockquote>
<p>Browser JavaScript execution flow, as well as in Node.js, is based on an <em>event loop</em>. The <em>event loop</em> concept is very simple. Thereâ€™s an endless loop, where the JavaScript engine waits for tasks, executes them, and then sleeps, waiting for more tasks.</p>
</blockquote>
<p>JSå¼•æ“å¤§å¤šæ•°æ—¶é—´éƒ½å¤„äºç©ºé—²çŠ¶æ€ï¼Œåªæœ‰å½“è„šæœ¬ã€äº‹ä»¶å¤„ç†å‡½æ•°ã€äº‹åŠ¡å‘ç”Ÿæ—¶ï¼ŒJSå¼•æ“æ‰å¼€å§‹å·¥ä½œã€‚</p>
<blockquote>
<p>Examples of tasks:</p>
<ul>
<li>When an external script <code>&lt;script src=&quot;...&quot;&gt;</code> loads, the task is to execute it.</li>
<li>When a user moves their mouse, the task is to dispatch <code>mousemove</code> event and execute handlers.</li>
<li>When the time is due for a scheduled <code>setTimeout</code>, the task is to run its callback.</li>
<li>â€¦and so on.</li>
</ul>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>å½“å¤–éƒ¨è„šæœ¬é€šè¿‡<code>script</code>æ ‡ç­¾è¿›è¡ŒåŠ è½½æ—¶ï¼Œè„šæœ¬å°†ä¼šä½œä¸ºä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œ</li>
<li>å½“ç½‘é¡µä¸Šçš„äº‹ä»¶å‘ç”Ÿå¹¶ä¸”æœ‰ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ç»‘å®šåœ¨è¯¥äº‹ä»¶ä¸Šæ—¶ï¼Œæ¯”å¦‚ï¼Œå½“ä½¿ç”¨è€…åœ¨ç½‘é¡µä¸Šç§»åŠ¨é¼ æ ‡ï¼Œå°±ä¼šæ´¾ç”Ÿå‡º <code>mousemove</code> äº‹ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹ä»¶çš„å¤„ç†å‡½æ•°ï¼ˆhandlerï¼‰å°±ä¼šä½œä¸ºä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œã€‚ï¼ˆå¦‚æœåªè§¦å‘äº†äº‹ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰äº‹ä»¶ç›‘å¬å™¨ï¼Œæ²¡æœ‰ç»‘å®šäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œé‚£å°±ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹ï¼‰ã€‚</li>
<li>å½“<code>setTimeout</code>è®¡åˆ’çš„æ—¶é—´åˆ°æœŸï¼Œå®šä¹‰çš„å›è°ƒå‡½æ•°å°±ä¼šä½œä¸ºä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œã€‚</li>
<li>è¯¸å¦‚æ­¤ç±»&hellip;</li>
</ul>
<h3 id="2-jsäº‹ä»¶çš„ç»„ç»‡å½¢å¼">2. JSäº‹ä»¶çš„ç»„ç»‡å½¢å¼</h3>
<p>æŒ‰ç…§ä¸Šé¢çš„è¯´æ³•ï¼Œä»»åŠ¡çš„æ¥æºå¤šç§å¤šæ ·ï¼Œè€Œä¸”ï¼ŒåŒæ—¶å¯èƒ½ä¼šæœ‰å¥½å‡ ä¸ªä»»åŠ¡éœ€è¦è¢«æ‰§è¡Œï¼Œä½†æ˜¯JSæ˜¯å•çº¿ç¨‹çš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªç‰¹å®šçš„æœºåˆ¶å’Œä¸€å—ç‰¹å®šçš„ç©ºé—´æ¥è®°å½•è¿™äº›éœ€è¦è¢«æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒåŒæ—¶ï¼Œç»™è¿™äº›ä»»åŠ¡æ’é˜Ÿï¼Œè¿™å°±æ˜¯JSçš„å¹¶å‘æ¨¡å‹ï¼ˆæµè§ˆå™¨å¼•æ“çš„å®ç°å’ŒNode.jså¹¶ä¸ç›¸åŒï¼Œè¿™é‡Œä»‹ç»æµè§ˆå™¨å¼•æ“çš„å®ç°æ–¹å¼ï¼‰ã€‚</p>
<p>å…³äºå¹¶å‘æ¨¡å‹ï¼Œæœ‰ä¸¤ç§å›¾ç¤ºç»“æ„ï¼Œä¸¤ç§ç»“æ„éƒ½åŒ…å«äº†ï¼šå †ã€æ ˆã€é˜Ÿåˆ—ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*MnRk2ZVl5acI5BFmmw7IRg.png" alt="img" style="zoom:50%;" /></p>
<blockquote>
<ul>
<li><strong>Memory Heap</strong> : Objects are allocated in a heap which is just a name to denote a large mostly unstructured region of memory.</li>
</ul>
<p>å†…å­˜å †ï¼šJSä¸­çš„å¯¹è±¡è¢«åˆ†é…åœ¨å †ï¼ˆHeapï¼‰ä¸­ï¼Œè¯¥å †ä»…æ˜¯ä¸€ä¸ªåç§°ï¼Œç”¨æ¥è¡¨ç¤ºä¸€å¤§å—ï¼ˆé€šå¸¸æ˜¯éç»“æ„åŒ–çš„ï¼‰å†…å­˜åŒºåŸŸ</p>
<ul>
<li><strong>Call Stack</strong> : This represents the single thread provided for JavaScript code execution. Function calls form a stack of frames. It is responsible for keeping track of all the operations in line to be executed. Whenever a function is finished, it is popped from the stack. It is a <strong>LIFO queue</strong> (Last In, First Out).</li>
</ul>
<p>è°ƒç”¨æ ˆï¼šè¿™å°±æ˜¯JavaScriptä»£ç å•çº¿ç¨‹æ‰§è¡Œçš„è¡¨ç°ã€‚ æ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¼šå½¢æˆä¸€ä¸ªå¸§ï¼Œå¸§è´Ÿè´£è·Ÿè¸ªæ‰€æœ‰è¦æ‰§è¡Œçš„æ“ä½œã€‚ æ¯å½“å‡½æ•°å®Œæˆæ—¶ï¼Œå¯¹åº”çš„å¸§ä¼šä»å †æ ˆä¸­å¼¹å‡ºï¼Œç„¶åæ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œè¿™æ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºç»“æ„ã€‚</p>
<ul>
<li><strong>Browser or Web APIs</strong> : They are built into your web browser and are able to expose data from the browser and surrounding computer environment and do useful complex things with it. They are not part of the JavaScript language itself, rather they are built on top of the core JavaScript language, providing you with extra superpowers to use in your JavaScript code.</li>
</ul>
<p>WEB APIï¼šå®ƒä»¬å†…ç½®åœ¨ä½ çš„ç½‘ç»œæµè§ˆå™¨ä¸­ï¼Œèƒ½å°†æµè§ˆå™¨å’Œè®¡ç®—æœºæ“ä½œç³»ç»Ÿä¸­çš„éƒ¨åˆ†æ•°æ®å¼€æ”¾å‡ºæ¥ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨è¿™äº›æ•°æ®åšä¸€äº›æœ‰ç”¨çš„å¤æ‚çš„äº‹ã€‚å®ƒä»¬ä¸æ˜¯JavaScriptè¯­è¨€æœ¬èº«çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯æ„å»ºåœ¨JavaScriptè¯­è¨€æ ¸å¿ƒä¹‹ä¸Šï¼Œåœ¨ç¼–å†™JavaScriptä»£ç æ—¶æä¾›é¢å¤–çš„ã€å¼ºåŠ›çš„å¸®åŠ©ã€‚</p>
<ul>
<li><strong>Event or Callback Queue</strong> : It is responsible for sending new functions to the track for processing. It follows the queue data structure to maintain the correct sequence in which all operations should be sent for execution.</li>
</ul>
<p>äº‹ä»¶é˜Ÿåˆ—ï¼šè´Ÿè´£å°†æ–°ä»»åŠ¡å‘é€åˆ°æ‰§è¡Œæ ˆè¿›è¡Œå¤„ç†ã€‚ è¿™æ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ç»“æ„ï¼Œç”¨æ¥ç»´æŠ¤æ‰€æœ‰åº”è¯¥è¢«æ‰§è¡Œçš„çš„ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºã€‚</p>
</blockquote>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/The_Javascript_Runtime_Environment_Example.svg" alt="Stack, heap, queue" style="zoom:150%;" /></p>
<blockquote>
<ul>
<li><strong>æ ˆï¼ˆè°ƒç”¨æ ˆã€æ‰§è¡Œæ ˆï¼‰</strong>
<ul>
<li>æ‰€æœ‰åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆï¼ˆexecution context stackï¼‰ã€‚</li>
<li>æ ˆï¼ˆStackï¼‰ ç”± å‡½æ•°è°ƒç”¨å½¢æˆçš„è‹¥å¹²å¸§ï¼ˆFrameï¼Œåœ¨å¾ˆå¤šåœ°æ–¹ä¹Ÿè¢«å«åšæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œexecution contextï¼‰ ç»„æˆã€‚</li>
<li>Frameä¼šåŒ…å«ä¸€äº›å½“å‰å‡½æ•°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ä¹‹ç±»çš„ä¿¡æ¯ï¼›</li>
</ul>
</li>
<li><strong>é˜Ÿåˆ—ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰</strong>
<ul>
<li>ä¸€ä¸ª JavaScript è¿è¡Œæ—¶åŒ…å«äº†ä¸€ä¸ªå¾…å¤„ç†æ¶ˆæ¯çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½å…³è”ç€ä¸€ä¸ªç”¨ä»¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°ã€‚</li>
<li>åœ¨ äº‹ä»¶å¾ªç¯ æœŸé—´çš„æŸä¸ªæ—¶åˆ»ï¼Œè¿è¡Œæ—¶ä¼šä»æœ€å…ˆè¿›å…¥é˜Ÿåˆ—çš„æ¶ˆæ¯å¼€å§‹å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li>
<li>è¢«å¤„ç†çš„æ¶ˆæ¯ä¼šè¢«ç§»å‡ºé˜Ÿåˆ—ï¼Œå¹¶ä½œä¸ºè¾“å…¥å‚æ•°æ¥è°ƒç”¨ä¸ä¹‹å…³è”çš„å‡½æ•°ã€‚</li>
<li>æ­£å¦‚å‰é¢æ‰€æåˆ°çš„ï¼Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°æ€»æ˜¯ä¼šä¸ºå…¶åˆ›é€ ä¸€ä¸ªæ–°çš„æ ˆå¸§ã€‚</li>
<li>å‡½æ•°çš„å¤„ç†ä¼šä¸€ç›´è¿›è¡Œåˆ°æ‰§è¡Œæ ˆå†æ¬¡ä¸ºç©ºä¸ºæ­¢ï¼›ç„¶åäº‹ä»¶å¾ªç¯å°†ä¼šå¤„ç†é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªæ¶ˆæ¯ï¼ˆå¦‚æœè¿˜æœ‰çš„è¯ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>å †</strong>
<ul>
<li>å¯¹è±¡è¢«åˆ†é…åœ¨å †ä¸­ï¼Œå †æ˜¯ä¸€ä¸ªç”¨æ¥è¡¨ç¤ºä¸€å¤§å—ï¼ˆé€šå¸¸æ˜¯éç»“æ„åŒ–çš„ï¼‰å†…å­˜åŒºåŸŸçš„è®¡ç®—æœºæœ¯è¯­ã€‚</li>
</ul>
</li>
</ul>
</blockquote>
<p>ä»ä¸Šé¢çš„è¡¨è¿°å¯ä»¥çŸ¥é“ï¼ŒJSè¿è¡Œæ—¶ä¼šå­˜åœ¨ä¸€ä¸ªç”¨äºå¤„ç†å¤šä»»åŠ¡å¹¶å‘çš„æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹å¤§æ¦‚åŒ…æ‹¬äº†æ‰§è¡Œæ ˆï¼Œä»»åŠ¡é˜Ÿåˆ—ï¼Œå­˜å‚¨å †ä¸‰ç§ç»“æ„ï¼Œæ‰§è¡Œæ ˆæ˜¯ç”¨æ¥æ‰§è¡Œå‡½æ•°è°ƒç”¨å½¢æˆçš„å¸§çš„ã€‚ä»»åŠ¡é˜Ÿåˆ—æ˜¯ç”¨æ¥æš‚å­˜è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ç»™ä»»åŠ¡æ’é˜Ÿçš„ã€‚å­˜å‚¨å †æ˜¯ç”¨æ¥å­˜å‚¨å¯¹è±¡çš„ã€‚</p>
<h3 id="3-jsäº‹ä»¶å¾ªç¯">3. JSäº‹ä»¶å¾ªç¯</h3>
<p>äº†è§£äº†JSçš„å¹¶å‘æ¨¡å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å‹æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿæ ¹æ®æ‰€æŸ¥èµ„æ–™ï¼Œå½“å¹¶å‘æ¨¡å‹æŒ‰ç…§æ—¢å®šå·¥ä½œæ–¹å¼è¿›è¡Œè¿ä½œæ—¶ï¼Œå°±å½¢æˆäº†JSçš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œæˆ–è€…è¯´å¹¶å‘æ¨¡å‹å°±æ˜¯æŒ‰ç…§äº‹ä»¶å¾ªç¯æœºåˆ¶è¿›è¡Œå·¥ä½œçš„ã€‚</p>
<p>æ‰§è¡Œæ ˆçš„å·¥ä½œæ¨¡å¼ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*yE9mbYWzwZGpc1jUcUw69Q.png" alt="img" style="zoom:50%;" /></p>
<p>ä»»åŠ¡é˜Ÿåˆ—çš„å·¥ä½œæ¨¡å¼ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*KRkTIajDBcG2wf21-RdR5Q.png" alt="img" style="zoom:50%;" /></p>
<p>äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*WGEUuqPJu4ti7kBfufwdXw.png" alt="img" style="zoom:50%;" /></p>
<p>ç”¨ä¸€æ®µä»£ç æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„è¿‡ç¨‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#ff79c6">const</span> foo <span style="color:#ff79c6">=</span> () =&gt; console.log(<span style="color:#f1fa8c">&#34;First&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#ff79c6">const</span> bar <span style="color:#ff79c6">=</span> () =&gt; setTimeout(() =&gt; console.log(<span style="color:#f1fa8c">&#34;Second&#34;</span>), <span style="color:#bd93f9">500</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">const</span> baz <span style="color:#ff79c6">=</span> () =&gt; console.log(<span style="color:#f1fa8c">&#34;Third&#34;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>bar();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>foo();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>baz();
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span style="color:#6272a4">// Output:
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#6272a4">// First
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#6272a4">// Third 
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span style="color:#6272a4">// Second
</span></code></pre></div><p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*7coLKNPemPd9o40PmUvuvQ.gif" alt="img"  /></p>
<ol>
<li>å½“å¼€å§‹æ‰§è¡Œ JS ä»£ç æ—¶ï¼Œé¦–å…ˆä¼šæ‰§è¡Œä¸€ä¸ª <code>main</code> å‡½æ•°ï¼Œç„¶åæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ï¼›</li>
<li>barå‡½æ•°è¢«è°ƒç”¨ï¼Œå½¢æˆå‡½æ•°è°ƒç”¨å¸§ï¼Œå‹å…¥æ‰§è¡Œæ ˆï¼›</li>
<li>barå‡½æ•°ä½¿ç”¨äº†setTimeout APIï¼Œå¹¶æŒ‡å®šäº†å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°è¿›å…¥å¤„ç†setTimeoutçš„æµè§ˆå™¨çº¿ç¨‹è¿›è¡Œç­‰å¾…ï¼›</li>
<li>setTimeoutç­‰å¾…æ—¶é—´åˆ°äº†ä¹‹åï¼Œå›è°ƒå‡½æ•°è¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›</li>
<li>è¿™æ—¶å€™çœ‹æ‰§è¡Œæ ˆä¸­æœ‰æ²¡æœ‰åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œå¦‚æœæœ‰åˆ™ç­‰å¾…ï¼Œå¦‚æœæ²¡æœ‰åˆ™å‡ºé˜Ÿåˆ—å…¥æ ˆï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ï¼›</li>
</ol>
<blockquote>
<p><strong>setTimeout</strong></p>
<ul>
<li>å‡½æ•° <code>setTimeout</code> æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šå›è°ƒå‡½æ•°å’Œä¸€ä¸ªæ—¶é—´å€¼ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º 0ï¼‰ã€‚è¿™ä¸ªæ—¶é—´å€¼ä»£è¡¨äº†å›è°ƒå‡½æ•°è¢«å®é™…åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„<strong>æœ€å°</strong>å»¶è¿Ÿæ—¶é—´ã€‚</li>
<li>å¦‚æœé˜Ÿåˆ—ä¸­ï¼Œå›è°ƒå‡½æ•°å‰é¢æ²¡æœ‰å…¶å®ƒä»»åŠ¡ï¼Œå¹¶ä¸”æ‰§è¡Œæ ˆä¸ºç©ºï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¹¶å½¢æˆå‡½æ•°è°ƒç”¨å¸§ï¼Œå‹å…¥æ ˆã€‚</li>
<li>ä½†æ˜¯ï¼Œå¦‚æœå‰é¢æœ‰å…¶å®ƒä»»åŠ¡æˆ–è€…æ‰§è¡Œæ ˆè¿˜ä¸ä¸ºç©ºï¼Œ<code>setTimeout</code> æ¶ˆæ¯å¿…é¡»ç­‰å¾…ã€‚</li>
<li>å› æ­¤ç¬¬äºŒä¸ªå‚æ•°ä»…ä»…è¡¨ç¤ºæœ€å°‘å»¶è¿Ÿæ—¶é—´ï¼Œè€Œéç¡®åˆ‡çš„ç­‰å¾…æ—¶é—´ã€‚</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>(<span style="color:#8be9fd;font-style:italic">function</span>() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>  console.log(<span style="color:#f1fa8c">&#39;è¿™æ˜¯å¼€å§‹&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>  setTimeout(<span style="color:#8be9fd;font-style:italic">function</span> cb() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>    console.log(<span style="color:#f1fa8c">&#39;è¿™æ˜¯æ¥è‡ªç¬¬ä¸€ä¸ªå›è°ƒçš„æ¶ˆæ¯&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>  });
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>  console.log(<span style="color:#f1fa8c">&#39;è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>  setTimeout(<span style="color:#8be9fd;font-style:italic">function</span> cb1() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>    console.log(<span style="color:#f1fa8c">&#39;è¿™æ˜¯æ¥è‡ªç¬¬äºŒä¸ªå›è°ƒçš„æ¶ˆæ¯&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>  }, <span style="color:#bd93f9">0</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>  console.log(<span style="color:#f1fa8c">&#39;è¿™æ˜¯ç»“æŸ&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>})();
</code></pre></div><p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/image-20210705143824688.png" alt="image-20210705143824688"></p>
</blockquote>
<h3 id="4-å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡">4. å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡</h3>
<p>æ ¹æ®ä¸Šé¢çš„äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œå¯ä»¥çŸ¥é“çš„æ˜¯ï¼ŒsetTimeoutä½œä¸ºä¸€ä¸ªè°ƒç”¨æµè§ˆå™¨APIçš„å¼‚æ­¥äº‹ä»¶ï¼Œå®ƒçš„å›è°ƒå‡½æ•°ä¼šåœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼Œè¢«åŠ å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¿›å…¥æ‰§è¡Œæ ˆã€‚</p>
<p>è€Œå¦ä¸€ç§å¼‚æ­¥äº‹ä»¶åƒPromiseï¼Œæ²¡æœ‰è°ƒç”¨æµè§ˆå™¨æˆ–Web APIï¼Œæ˜¯ç”±JSæœ¬èº«æ¥æ§åˆ¶çš„å¼‚æ­¥äº‹ä»¶ï¼Œè¿™ç§äº‹ä»¶è¯¥å¦‚ä½•å¤„ç†ï¼Œæ€ä¹ˆåŠ å…¥é˜Ÿåˆ—ç­‰å¾…è¢«æ‰§è¡Œï¼Œå¦‚æœåŒæ—¶å‡ºç°äº†æµè§ˆå™¨æ§åˆ¶çš„å¼‚æ­¥äº‹ä»¶å’ŒJSæœ¬èº«æ§åˆ¶çš„å¼‚æ­¥äº‹ä»¶ï¼Œåº”è¯¥æ€ä¹ˆå¤„ç†ï¼Œæ€ä¹ˆæ”¾å…¥é˜Ÿåˆ—ï¼Œè°å…ˆæ‰§è¡Œï¼Ÿ</p>
<p>è¿™å°±å¼•å‡ºäº†å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡çš„æ¦‚å¿µï¼š</p>
<blockquote>
<p><strong>Micro-tasks within an event loop:</strong></p>
<ul>
<li>
<p>A micro-task is said to be a function that is executed after the function or program which created it exits and only if the JavaScript execution stack is empty, but before returning control to the event loop being used by the user agent to drive the scriptâ€™s execution environment. A Micro-task is also capable of en-queuing other micro-tasks.</p>
<p>å¾®ä»»åŠ¡ æ˜¯ åœ¨åˆ›å»ºå®ƒçš„å‡½æ•°æˆ–ç¨‹åºæ‰§è¡Œå®Œæˆå æ‰§è¡Œçš„å‡½æ•°æˆ–ç¨‹åºï¼Œå¹¶ä¸”åªæœ‰åœ¨JSæ‰§è¡Œæ ˆä¸ºç©ºã€åœ¨ä½¿ç”¨ç”¨æˆ·ä»£ç†æ§åˆ¶äº‹ä»¶å¾ªç¯æ¥é©±åŠ¨è„šæœ¬ä¹‹å‰æ‰§è¡Œã€‚å¾®ä»»åŠ¡éœ€è¦æ’é˜Ÿæ‰§è¡Œã€‚</p>
</li>
<li>
<p>Micro-tasks are often scheduled for things that are required to be completed immediately after the execution of the current script. <strong>On completion of one macro-task, the event loop moves on to the micro-task queue</strong>. The event loop does not move to the next task outside of the micro-task queue until all the tasks inside the micro-task queue are completed. This implies that the <strong>micro-task queue has a higher priority</strong>.</p>
<p>å¾®ä»»åŠ¡ é€šå¸¸æ˜¯ å½“å‰ä»»åŠ¡å®Œæˆåç«‹å³æ‰§è¡Œçš„å‡½æ•°æˆ–ç¨‹åºã€‚ æ¯å®Œæˆä¸€ä¸ªå®ä»»åŠ¡åï¼Œäº‹ä»¶å¾ªç¯å°†å¼€å§‹å…³æ³¨å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚ å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°†è¢«ä¾æ¬¡æ‰§è¡Œï¼Œç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆã€‚ è¿™æ„å‘³ç€å¾®ä»»åŠ¡é˜Ÿåˆ—å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</p>
</li>
<li>
<p>Once all the tasks inside the micro-task queue are finished, only then does the event loop shift back to the macro-task queue. The primary reason for prioritizing the micro-task queue is to <strong>improve the user experience</strong>. The micro-task queue is processed after callbacks given that any other JavaScript is not under mid-execution. Micro-tasks include <strong>mutation observer callbacks</strong> as well as <strong>promise callbacks</strong>.</p>
<p>åªæœ‰å¾®ä»»åŠ¡é˜Ÿåˆ—å†…çš„æ‰€æœ‰ä»»åŠ¡éƒ½å®Œæˆåï¼Œäº‹ä»¶å¾ªç¯æ‰ä¼šç»§ç»­å…³æ³¨å®ä»»åŠ¡é˜Ÿåˆ—ã€‚ ä¼˜å…ˆè€ƒè™‘å¾®ä»»åŠ¡é˜Ÿåˆ—çš„ä¸»è¦åŸå› æ˜¯æé«˜ç”¨æˆ·ä½“éªŒã€‚ å¦‚æœæ‰§è¡Œæ ˆä¸­æ²¡æœ‰ä»»ä½•JSä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå°±ç«‹å³å¤„ç†å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°ã€‚ å¾®ä»»åŠ¡åŒ…æ‹¬<strong>mutation observer callbacks</strong>ä»¥åŠ<strong>promise callbacks</strong>ã€‚</p>
</li>
<li>
<p>In such a case wherein new micro-tasks are being added to the queue, these additional micro-tasks are added at the end of the micro-queue and these are also processed. This is because the event loop will keep on calling micro-tasks until there are no more micro-tasks left in the queue, even if new tasks keep getting added. Another important reason for using micro-tasks is to ensure consistent ordering of tasks as well as simultaneously reducing the risk of delays caused by users.</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†æ–°çš„å¾®ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­æ—¶ï¼Œä¼šå°†è¿™äº›ä»»åŠ¡æ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œå¹¶ä¸”å¤„ç†è¿™äº›å¾®ä»»åŠ¡ã€‚å³ä½¿å®ä»»åŠ¡æŒç»­æ·»åŠ ï¼Œ äº‹ä»¶å¾ªç¯ä¹Ÿå°†ç»§ç»­è°ƒç”¨å¾®ä»»åŠ¡ï¼Œç›´åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰æ›´å¤šçš„å¾®ä»»åŠ¡ï¼Œ ä½¿ç”¨å¾®ä»»åŠ¡è¿™ä¸ªæ¦‚å¿µçš„å¦ä¸€ä¸ªé‡è¦åŸå› æ˜¯ç¡®ä¿ä»»åŠ¡æ‰§è¡Œçš„é¡ºåºï¼Œé™ä½å»¶è¿Ÿé£é™©ã€‚</p>
</li>
</ul>
<p><strong>Macro-tasks within an event loop:</strong></p>
<ul>
<li>
<p>Macro-task represents some <strong>discrete and independent work</strong>. These are always the execution of the JavaScript code and micro-task queue is empty. Macro-task queue is often considered the same as the task queue or the event queue. However, the macro-task queue works the same as the task queue. The only small difference between the two is that the <strong>task queue is used for synchronous statements</strong> whereas the <strong>macro-task queue is used for asynchronous statements.</strong></p>
<p>å®ä»»åŠ¡æŒ‡çš„æ˜¯ä¸€äº›ç¦»æ•£å’Œç‹¬ç«‹çš„å·¥ä½œã€‚å®ä»»åŠ¡åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—æ˜¯ç©ºçš„æ—¶å€™æ‰§è¡Œã€‚å®ä»»åŠ¡é˜Ÿåˆ—é€šå¸¸è¢«è®¤ä¸ºä¸ä»»åŠ¡é˜Ÿåˆ—æˆ–äº‹ä»¶é˜Ÿåˆ—ç›¸åŒã€‚<del>ä½†æ˜¯ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—çš„å·¥ä½œæ–¹å¼ä¸ä»»åŠ¡é˜Ÿåˆ—ç›¸åŒã€‚ä¸¤è€…ä¹‹é—´å”¯ä¸€çš„ç»†å¾®åŒºåˆ«æ˜¯ï¼Œä»»åŠ¡é˜Ÿåˆ—ç”¨äºåŒæ­¥è¯­å¥ï¼Œè€Œå®ä»»åŠ¡é˜Ÿåˆ—ç”¨äºå¼‚æ­¥è¯­å¥ã€‚</del></p>
</li>
<li>
<p>In JavaScript, no code is allowed to execute until an event has occurred. It is worth mentioning that the <strong>execution of a JavaScript code execution is itself a macro-task</strong>. The event is queued as a macro-task. When a (macro) task, present in the macro-task queue is being executed, new events may be registered and in turn, created and added to the queue.</p>
<p>åœ¨JavaScriptä¸­ï¼Œåœ¨äº‹ä»¶å‘ç”Ÿä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•ä»£ç ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒJavaScriptä»£ç æ‰§è¡Œæœ¬èº«å°±æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ã€‚ è¯¥äº‹ä»¶è¢«æ’é˜Ÿä¸ºå®ä»»åŠ¡ã€‚ <del>å½“å®ä»»åŠ¡é˜Ÿåˆ—ä¸­å­˜åœ¨çš„å®ä»»åŠ¡æ—¶ï¼Œå¯ä»¥åœ¨åˆ›å»ºå¹¶æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ–°äº‹ä»¶</del>ã€‚</p>
</li>
<li>
<p>Upon initialization, the JavaScript engine first pulls off the first task in the macro-task queue and executes the callback handler. The JavaScript engine then sends these asynchronous functions to the API module, and the module pushes them to the macro-task queue at the right time. Once inside the macro-task queue, each macro-task is required to wait for the next round of the event loop. In this way, the code is executed.</p>
<p>åˆå§‹åŒ–åï¼ŒJavaScriptå¼•æ“é¦–å…ˆä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ä¸­å–å‡ºä»»åŠ¡å¹¶æ‰§è¡Œå›è°ƒå¤„ç†å‡½æ•°ã€‚ ç„¶åï¼ŒJavaScriptå¼•æ“å°†è¿™äº›å¼‚æ­¥å‡½æ•°å‘é€åˆ°APIæ¨¡å—ï¼Œæ¨¡å—ï¼ˆåœ¨ç‰¹å®šæ—¶é—´ï¼‰å°†å®ƒä»¬æ¨å‘æ­£ç¡®æ—¶é—´çš„å®ä»»åŠ¡é˜Ÿåˆ—ã€‚ åœ¨å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªå®ä»»åŠ¡éƒ½éœ€è¦ç­‰å¾…ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ã€‚ ä»¥è¿™ç§æ–¹å¼ï¼Œæ‰§è¡Œä»£ç ã€‚</p>
</li>
<li>
<p>All micro-tasks logged are processed in one fell swoop in a single macro-task execution cycle. In comparison, the <strong>macro-task queue has a lower priority</strong>. Macro-tasks include parsing HTML, generating DOM, executing main thread JavaScript code, and other events such as page loading, input, network events, timer events, etc.</p>
<p>æ‰€æœ‰å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å¾®ä»»åŠ¡éƒ½åœ¨å•ä¸ªå®ä»»åŠ¡æ‰§è¡Œå‘¨æœŸä¸­ä¸€æ¬¡æ€§å¤„ç†ã€‚ ç›¸æ¯”ä¹‹ä¸‹ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—çš„ä¼˜å…ˆçº§è¾ƒä½ã€‚ å®ä»»åŠ¡åŒ…æ‹¬è§£æHTMLï¼Œç”ŸæˆDOMï¼Œæ‰§è¡Œä¸»çº¿ç¨‹JavaScriptä»£ç å’Œå…¶ä»–äº‹ä»¶ï¼Œä¾‹å¦‚é¡µé¢åŠ è½½ï¼Œè¾“å…¥ï¼Œç½‘ç»œäº‹ä»¶ï¼Œè®¡æ—¶å™¨äº‹ä»¶ç­‰ã€‚</p>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>
<p>ES6 è§„èŒƒä¸­ï¼Œå¾®ä»»åŠ¡ ç§°ä¸º <code>jobs</code>ï¼Œå®ä»»åŠ¡ ç§°ä¸º <code>task</code> ï¼›</p>
<p>æ¥æºï¼š<a href="https://262.ecma-international.org/6.0/#sec-jobs-and-job-queues">ES6_Jobs and Job Queues</a></p>
</li>
<li>
<p>å®ä»»åŠ¡æ˜¯ç”±å®¿ä¸»ï¼ˆæµè§ˆå™¨/Node.jsï¼‰å‘èµ·çš„ï¼Œè€Œå¾®ä»»åŠ¡ç”±JavaScriptè‡ªèº«å‘èµ·ï¼›</p>
</li>
<li>
<p>åœ¨ESä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼ŒJavaScriptæœ¬èº«æ²¡æœ‰å¤„ç†å¼‚æ­¥çš„èƒ½åŠ›ï¼Œä¹Ÿå°±æ²¡æœ‰å¾®ä»»åŠ¡çš„å­˜åœ¨ï¼›</p>
</li>
<li>
<p>JavaScriptå¼•å…¥<code>Promise</code>ä¹‹åï¼Œä¸éœ€è¦æµè§ˆå™¨åŠå…¶ä»–å¤–éƒ¨ç¯å¢ƒï¼ŒJavaScriptå¼•æ“è‡ªèº«ä¹Ÿèƒ½å¤Ÿå‘èµ·å¼‚æ­¥ä»»åŠ¡äº†ã€‚</p>
</li>
</ul>
</blockquote>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰</th>
<th align="left">å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">è°å‘èµ·çš„</td>
<td align="left">å®¿ä¸»ï¼ˆNode.jsã€æµè§ˆå™¨ï¼‰</td>
<td align="left">JSå¼•æ“ï¼ˆJSè‡ªèº«ï¼‰</td>
</tr>
<tr>
<td align="left">å…·ä½“äº‹ä»¶</td>
<td align="left">1. script (å¯ä»¥ç†è§£ä¸ºå¤–å±‚åŒæ­¥ä»£ç )<br>2. setTimeout/setInterval<br/>3. UI rendering/UIäº‹ä»¶<br/>4. postMessage/MessageChannel<br/>5. setImmediate/I/Oï¼ˆNode.jsï¼‰<br/></td>
<td align="left">1. Promise<br/>2. MutaionObserverï¼ˆç›‘å¬DOMæ ‘å˜åŒ–ï¼‰<br/>3. Object.observeï¼ˆå¼‚æ­¥åœ°ç›‘è§†ä¸€ä¸ªå¯¹è±¡çš„ä¿®æ”¹ï¼Œå·²åºŸå¼ƒï¼‰<br/>4. process.nextTickï¼ˆNode.jsï¼‰</td>
</tr>
<tr>
<td align="left">è°å…ˆè¿è¡Œ</td>
<td align="left">åè¿è¡Œ</td>
<td align="left">å…ˆè¿è¡Œ</td>
</tr>
<tr>
<td align="left">ä¼šè§¦å‘æ–°ä¸€è½®Tickå—</td>
<td align="left">ä¼š</td>
<td align="left">ä¸ä¼š</td>
</tr>
</tbody>
</table>
<p>æ—¢ç„¶å®ä»»åŠ¡å’Œå¾®ä»»åŠ¡éœ€è¦åŒºåˆ«å¯¹å¾…ï¼Œé‚£ä¹ˆå°±æœ‰å¿…è¦å¯¹å¾®ä»»åŠ¡è¿›è¡Œå•ç‹¬çš„ç®¡ç†ï¼Œé‚£å°±äº§ç”Ÿäº†å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ·»åŠ äº†å¾®ä»»åŠ¡é˜Ÿåˆ—ä¹‹åï¼Œäº‹ä»¶å¾ªç¯çš„å¹¶å‘æ¨¡å‹å°±å˜æˆäº†å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/dpjs7sc1yk.png" style="zoom: 50%;" /></p>
<p>è€Œæ•´ä¸ªäº‹ä»¶å¾ªç¯å°±å˜æˆäº†ï¼š</p>
<blockquote>
<ul>
<li><code>Task1</code>: a function that&rsquo;s added to the call stack immediately, for example by invoking it instantly in our code.</li>
<li><code>Task2</code>, <code>Task3</code>, <code>Task4</code>: microtasks, for example, a promise <code>then</code> callback, or a task added with <code>queueMicrotask</code>.</li>
<li><code>Task5</code>, <code>Task6</code>: a (macro)task, for example, a <code>setTimeout</code> or <code>setImmediate</code> callback.</li>
</ul>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*0xDGBNrA1WtfSfYY3FJOdw.gif" alt="img" style="zoom:80%;" /></p>
</blockquote>
<p>å†ç”¨ä¸€ä¸ªå®é™…çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span>console.log(<span style="color:#f1fa8c">&#39;Start!&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span>setTimeout(() =&gt; {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>	console.log(<span style="color:#f1fa8c">&#39;Timeout!&#39;</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span>}, <span style="color:#bd93f9">0</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#8be9fd;font-style:italic">Promise</span>.resolve(<span style="color:#f1fa8c">&#39;Promise!&#39;</span>)
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>	.then((res) =&gt; { console.log(res) })
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>console.log(<span style="color:#f1fa8c">&#39;End!&#39;</span>);
</code></pre></div><ol>
<li>åœ¨ç¬¬ä¸€è¡Œï¼ŒJSå¼•æ“é‡åˆ°<code>console.log()</code>æ–¹æ³•ã€‚ å®ƒè¢«æ·»åŠ åˆ°æ‰§è¡Œæ ˆï¼Œä¹‹åä¼šå°†æŒ‡å®šå†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚ è¯¥æ–¹æ³•å¼¹å‡ºæ‰§è¡Œæ ˆï¼ŒJSå¼•æ“ç»§ç»­ï¼›</li>
</ol>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*5K5JL9jhX10Yt2iArGVv4w.gif" alt="img" style="zoom:80%;" /></p>
<ol start="2">
<li>è¯¥å‘åŠ¨æœºé‡åˆ°äº†<code>setTimeout</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ·»åŠ åˆ°æ‰§è¡Œæ ˆä¸­ã€‚ <code>setTimeout</code>æ–¹æ³•æµè§ˆå™¨æä¾›çš„APIï¼Œæ‰€ä»¥å°†åœ¨JSå¤–éƒ¨è¿›è¡Œæ‰§è¡Œï¼Œå…¶å›è°ƒå‡½æ•°<code>() =&gt; { console.log('Timeout!'); }</code>å°†è¢«æ·»åŠ åˆ°Web APIï¼Œç›´åˆ°å®šæ—¶å™¨å®Œæˆï¼Œä¹‹åå›è°ƒå‡½æ•°è¢«æ·»åŠ åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ï¼›</li>
</ol>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*a_X8_BfQGJ6oHR-XmuPGRQ.gif" alt="img" style="zoom:80%;" /></p>
<ol start="3">
<li>JSå¼•æ“ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œé‡åˆ°<code>Promise.resolve()</code>æ–¹æ³•ï¼Œ è¿™ä¸ªæ–¹æ³•å°†æ·»åŠ åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œå½“å®Œæˆ<code>resolve</code>ä¹‹åï¼Œ<code>.then</code>ä¸­æŒ‡å®šçš„å›è°ƒå‡½æ•°è¢«æ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›</li>
</ol>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*Q5xtSx914wUAo_msjNk8qQ.gif" alt="img" style="zoom:80%;" /></p>
<ol start="4">
<li>JSå¼•æ“ç»§ç»­æ‰§è¡Œï¼Œé‡åˆ°<code>console.log()</code>æ–¹æ³•ã€‚ æ·»åŠ åˆ°æ‰§è¡Œæ ˆä¸­ï¼Œä¹‹åä¼šå°†æŒ‡å®šå†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæ‰§è¡Œå®Œæˆå¼¹å‡ºæ‰§è¡Œæ ˆï¼ŒJSå¼•æ“ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›</li>
</ol>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*H2QP7Ry7XCXDaD2dHkQYMw.gif" alt="img" style="zoom:80%;" /></p>
<ol start="5">
<li>ç¬¬ä¸€è½®å®ä»»åŠ¡è‡³æ­¤å®Œæˆï¼ŒJSå¼•æ“å‘ç°æ‰§è¡Œæ ˆæ˜¯ç©ºçš„ï¼Œå®ƒå°†æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦å­˜åœ¨æ’é˜Ÿä»»åŠ¡ï¼Œ<code>Promise.then</code>çš„å›è°ƒå‡½æ•°æ­£åœ¨ç­‰å¾…ï¼Œå®ƒä¼šå‹å…¥æ‰§è¡Œæ ˆï¼Œä¹‹åä¼šæ‰“å°è¾“å‡º<code>Promise!</code>ï¼›</li>
</ol>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*PfxpUO9FJYm05lzA792CrQ.gif" alt="img" style="zoom:80%;" /></p>
<ol start="6">
<li>JSå¼•æ“æ£€æŸ¥æ‰§è¡Œæ ˆä¸ºç©ºï¼Œå†æ¬¡æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¹Ÿä¸ºç©ºã€‚ ç°åœ¨åº”è¯¥æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œå‘ç°<code>setTimeout</code>çš„å›è°ƒå‡½æ•°æ­£åœ¨ç­‰å¾…ï¼Œå›è°ƒå‡½æ•°å°†å‹å…¥è°ƒç”¨æ ˆï¼Œ æ‰“å°è¾“å‡º<code>Timeout!</code>ï¼Œæ‰§è¡Œå®Œæˆåå‡ºæ ˆï¼›</li>
</ol>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*Eg9EkLzLfO0nZTpqNq9WCQ.gif" alt="img" style="zoom:80%;" /></p>
<h3 id="5-asyncå’Œawait">5. asyncå’Œawait</h3>
<p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼Œ<code>async</code>å’Œ<code>await</code>æ˜¯å¼‚æ­¥å¾®ä»»åŠ¡çš„å¦ä¸€ç§å®ç°æ–¹å¼ï¼Œè§£å†³äº†åœ¨<code>Promise</code>ä¸­ä¸èƒ½è¿›è¡Œå¼‚å¸¸æ•è·çš„é—®é¢˜ï¼Œå…³äº<code>async</code>å’Œ<code>await</code>çš„è¯¦ç»†è®²è§£ï¼Œåœ¨å¦ä¸€ç¯‡æ–‡ç« ã€Šjs asyncä¸awaitè¯¦è§£ã€‹ã€‚</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/1*lw0nQ2U3x91SONIb6NsEwA.gif" alt="img" style="zoom:80%;" /></p>
<blockquote>
<ol>
<li>
<p>First, the engine encounters a <code>console.log</code>. It gets popped onto the call stack, after which <code>Before function!</code> gets logged.</p>
<p>é¦–å…ˆï¼ŒJSå¼•æ“é‡åˆ°<code>console.log</code>ã€‚ å®ƒä¼šè¿›å…¥æ‰§è¡Œæ ˆï¼Œè¾“å‡º<code>Before function!</code>ï¼›</p>
</li>
<li>
<p>Then, we invoke the async function <code>myFunc()</code>, after which the function body <code>myFunc</code> runs. On the very first line within the function body, we call another <code>console.log</code>, this time with the string <code>In function!</code>. The <code>console.log</code> gets added to the call stack, logs the value, and gets popped off.</p>
<p>ç„¶åï¼Œè°ƒç”¨äº†asyncå‡½æ•°<code>myfunc()</code>ï¼Œ<code>myfunc</code>è¿è¡Œã€‚ åœ¨å‡½æ•°ä½“å†…çš„ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬è¾“å‡ºäº†<code>In function!</code>ã€‚åŒæ ·æ˜¯å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ï¼›</p>
</li>
<li>
<p>The function body keeps on being executed, which gets us to the second line. Finally, we see a <code>await</code> keyword! ğŸ‰ The first thing that happens is that the value that gets awaited gets executed: the function <code>one</code> in this case. It gets popped onto the call stack, and eventually returns a resolved promise. Once the promise has resolved and <code>one</code> returned a value, the engine encounters the <code>await</code> keyword.</p>
<p>JSå¼•æ“ç»§ç»­ï¼Œæ¥åˆ°å‡½æ•°ä½“å†…ç¬¬äºŒè¡Œï¼Œçœ‹åˆ°äº†awaitå…³é”®è¯ï¼Œæˆ‘ä»¬éœ€è¦ç­‰å¾…å‡½æ•°<code>one</code>æ‰§è¡Œå®Œæˆåè·å–ä¸€ä¸ªå€¼ï¼Œå‡½æ•°<code>one</code>ä¼šå‹å…¥åˆ°æ‰§è¡Œæ ˆï¼Œæœ€ç»ˆè¿”å›<code>resolve</code>çŠ¶æ€çš„<code>promise</code>ï¼Œ<code>one</code>æ‰§è¡Œå®Œæˆï¼Œå‡ºæ ˆï¼›</p>
</li>
<li>
<p>When encountering an <code>await</code> keyword, the <code>async</code> function gets <em>suspended</em>. âœ‹ğŸ¼ The execution of the function body gets paused, and the rest of the async function gets to run in a <em>microtask</em> instead of a regular task!</p>
<p>é‡åˆ°<code>await</code>å…³é”®å­—æ—¶ï¼Œ<code>async</code>å‡½æ•°ä¼šè¢«æš‚åœï¼Œ å‡½æ•°æ­£æ–‡çš„æ‰§è¡Œæš‚åœï¼Œå…¶ä½™çš„å¼‚æ­¥ä»£ç åˆ™åœ¨<code>await</code>åé¢çš„è¯­å¥æ‰§è¡Œå®Œåï¼ŒåŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸å†æ˜¯å¸¸è§„ä»»åŠ¡ï¼</p>
</li>
<li>
<p>Now that the async function <code>myFunc</code> is suspended as it encountered the <code>await</code> keyword, the engine jumps out of the async function and continues executing the code in the execution context in which the async function got called: the global execution context in this case! ğŸƒğŸ½â€â™€ï¸</p>
<p>æ—¢ç„¶å¼‚æ­¥å‡½æ•°<code>myfunc</code>è¢«æš‚åœï¼Œå› ä¸ºå®ƒé‡åˆ°äº†<code>await</code>å…³é”®å­—ï¼Œå¼•æ“è·³å‡ºå‡½æ•°ï¼Œ<code>myfunc</code>å‡½æ•°å‡ºæ ˆï¼Œå¹¶ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼ˆä¸‹é¢å°±æ˜¯è¾“å‡º<code>After function</code>ï¼‰ï¼›</p>
</li>
<li>
<p>Finally, there are no more tasks to run in the global execution context! The event loop checks to see if there are any microtasks queued up: and there are! The async <code>myFunc</code> function is queued up after resolving the valued of <code>one</code>. <code>myFunc</code> gets popped back onto the call stack, and continues running where it previously left off.</p>
<p>æœ€åï¼Œå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œä¸å†æœ‰ä»»åŠ¡ï¼Œäº‹ä»¶å¾ªç¯æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œåœ¨è·å¾—ä¸€ä¸ªå€¼åï¼Œ<code>async myfunc</code>å‡½æ•°å°†æ’è¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚ <code>myFunc</code>å°†å›åˆ°æ‰§è¡Œæ ˆï¼Œå¹¶ä»¥å‰ç¦»å¼€çš„ä½ç½®ç»§ç»­æ‰§è¡Œï¼›</p>
</li>
<li>
<p>The variable <code>res</code> finally gets its value, namely the value of the resolved promise that <code>one</code> returned! We invoke <code>console.log</code> with the value of <code>res</code>: the string <code>One!</code> in this case. <code>One!</code> gets logged to the console and gets popped off the call stack! ğŸ˜Š</p>
<p>å˜é‡resæœ€ç»ˆè·å¾—å€¼ï¼Œå³<code>promise resolve</code>çš„å€¼ï¼Œ è°ƒç”¨<code>console.log</code>ï¼Œè¿›è¡Œè¾“å‡ºï¼›</p>
</li>
</ol>
</blockquote>

      </div>
      <div class="footer">
        <span><a class="category" href="https://tomtomyoung.top/categories/%E5%89%8D%E7%AB%AF/">å‰ç«¯</a><a class="category" href="https://tomtomyoung.top/categories/%E7%B2%BE%E9%80%89/">ç²¾é€‰</a></span>
        <span><a class="tag" href="https://tomtomyoung.top/tags/js/">js</a></span>
      </div>
    </div>

    <ul class="menu">
    <li class="menu-item">
        <i class="iconfont icon-top item-btn" id="back_top_btn"></i>
    </li>
    <li class="menu-item">
        <a href="https://tomtomyoung.top/" id="back-btn">
            <i class="iconfont icon-home item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-switch item-btn" id="switch_btn"></i>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-search item-btn" id="search_btn"></i>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/git-husky%E7%AE%80%E4%BB%8B/" data-tooltip="git huskyç®€ä»‹">
            <i class="iconfont icon-left item-btn"></i>
            
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/js-settimeoutsetinterval/" data-tooltip="js setTimeout&amp;setInterval">
            <i class="iconfont icon-right item-btn"></i>
            
        </a>
    </li>
</ul>

  </div>
</div>

<div class="cover" id="cover">
        <div class="search-container">
    <input type="search" class="docsearch-input search-input" placeholder="æœç´¢å…³é”®è¯" />
    
</div>
    </div>
</body>






<script type="text/javascript" src="https://tomtomyoung.top/js/util.min.cbb11aa834d67fe3a408c90d91eb61968cf8837e7b654992031f36b824366a124619697154c0999a624b36918f443262ed9aab968b3a84540f3fce9658230023.js" integrity=""></script></html>