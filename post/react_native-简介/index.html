<!DOCTYPE html>
<html lang="zh-cn" data-theme="light"><head>
  <meta name="google-site-verification" content="kw1N-Xm6qEr1c9PGuRd0U_T6DXkw_EHsLyz5LpuDDv8" />
  <meta name="msvalidate.01" content="EE98205D30806C22C519683EFC53E9BA" />
  <meta name="baidu-site-verification" content="iPC3wUcQLL" />
  <title> react_native 简介</title>
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.74.3" /><meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1" />
  <meta name="description" itemprop="description"
    content=" react_native 简介 " />
  <meta name="keywords" itemprop="keywords"
    content=" [react_native] " />
  <base href="https://tomtomyoung.top/" />


  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap" media="print"
    onload="this.media='all'">

  
  <link rel="shortcut icon" href="https://tomtomyoung.top/favicons//favicon.ico" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://tomtomyoung.top/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://tomtomyoung.top/favicons/favicon-16x16.png" />
  <link rel="mask-icon" href="https://tomtomyoung.top/favicons/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="apple-touch-icon" sizes="180x180" href="https://tomtomyoung.top/favicons/apple-touch-icon.png">
  <meta name="msapplication-TileColor" content="#00aba9">
  <meta name="msapplication-TileImage" content="https://tomtomyoung.top/favicons/mstile-144x144.png">
  <link rel="manifest" href="https://tomtomyoung.top/manifest.json">

  
  <link rel="canonical" href="https://tomtomyoung.top/post/react_native-%E7%AE%80%E4%BB%8B/" />
  <link rel="stylesheet" type="text/css" href="https://at.alicdn.com/t/font_2450869_5vzvggza71i.css" />
  
  
  
  
  
  
  
  
  
  <link rel="stylesheet" href="https://tomtomyoung.top/css/style.min.css" integrity="" type="text/css" />

  
  
  
  <script type="text/javascript" src="https://tomtomyoung.top/js/docsearch.min.js" integrity=""></script>
</head><body class="animated fadeInDown">
<div class="main"><div class="percentage_container">
    <div class="percentage" id="percentage"></div>
</div><div class="toc sub-container">
    <div class="toc-header">
        <span>目录</span>
    </div><ul class="toc-h2"><li>
                <span class="toc-link">1. React Native</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. 定义</span>
            </li>
            <li>
                <span class="toc-link">2. 特点</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. 跨平台</span>
            </li>
            <li>
                <span class="toc-link">2. 上手快</span>
            </li>
            <li>
                <span class="toc-link">3. 原生体验</span>
            </li>
            <li>
                <span class="toc-link">4. 热更新</span>
            </li>
            
                    </ul>
                    </ul><li>
                <span class="toc-link">2. 配置环境</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. Node.js</span>
            </li>
            <li>
                <span class="toc-link">2. JDK</span>
            </li>
            <li>
                <span class="toc-link">3. Android</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">3. 初始化项目</span>
            </li>
            <li>
                <span class="toc-link">4. 原理</span>
            </li>
            
                    <ul class="toc-h3"><li>
                <span class="toc-link">1. 整体架构</span>
            </li>
            <li>
                <span class="toc-link">2. 工作原理</span>
            </li>
            <li>
                <span class="toc-link">3. 工作流程</span>
            </li>
            <li>
                <span class="toc-link">4. 工具链</span>
            </li>
            
                    <ul class="toc-h4"><li>
                <span class="toc-link">1. Metro</span>
            </li>
            <li>
                <span class="toc-link">2. JavaScriptCore</span>
            </li>
            
                    <ul class="toc-h5"><li>
                <span class="toc-link">1. WebKit</span>
            </li>
            <li>
                <span class="toc-link">2. RN 中的 JSCore</span>
            </li>
            
                    </ul><li>
                <span class="toc-link">3. Bridge</span>
            </li>
            </div><div class="single-post container">
    <div class="post">
      <div class="header">
        <span class="title">react_native 简介</span>
        
        <div class="info">
          <span>📅 2021-09-06</span>
          <span>👦 Tomtom Young</span>
          <span>📖 4038字</span>
          <span>⏱ 9分钟</span>
        </div>
        
      </div>
      <div class="content markdown-body">
        <blockquote>
<p>参考：</p>
<p><a href="https://reactnative.cn/">React Native 中文网</a></p>
<p><a href="https://juejin.cn/post/6916452544956858382">React Native 介绍</a></p>
<p><a href="https://fanshow.top/archives/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3react-native">深入理解react-native</a></p>
<p><a href="https://facebook.github.io/metro/docs/configuration/">Metro_Docs</a></p>
<p><a href="https://www.jianshu.com/p/cff8f87ab213">react-native metro 分析</a></p>
<p><a href="https://segmentfault.com/a/1190000038346994">react-native bundle 到 bundle 生成到底发生了什么(metro 打包流程简析)</a></p>
<p><a href="https://nshipster.cn/javascriptcore/">JavaScriptCore</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/81634837">深入浅出JavaScriptCore</a></p>
<p><a href="https://www.cnblogs.com/wood-life/p/10577868.html">React Native、React和JavascriptCore的关系</a></p>
</blockquote>
<h2 id="1-react-native">1. React Native</h2>
<h3 id="1-定义">1. 定义</h3>
<p>要了解 RN，肯定是要从官网入手：</p>
<blockquote>
<p>按照官网的介绍，RN 是使用 React 来创建 Android 和 ios 原生应用的 JavaScript 框架。</p>
<p>RN具有以下的特点：</p>
<ol>
<li>
<p>一次学习，随处编写</p>
<p>因为 RN 使用的都是 React 的语法，对于前端人员可以快速上手。</p>
</li>
<li>
<p>酌量添加，多少随意</p>
<p>随时都可以把 RN 无缝集成到你已有的 Android 或 iOS 项目。</p>
</li>
<li>
<p>流水的多平台，铁打的React</p>
<p>绝大多数情况下，多个平台都共享一份代码，使用通用的技术 React。</p>
</li>
</ol>
</blockquote>
<p>React Native 可以让开发者使用 JavaScript 和 React 来开发跨平台的移动应用。它既保留了 React 的开发效率，又同时拥有 Native 应用的良好体验，加上 Virtual DOM 跨平台的优势，实现了真正意义上的：<strong>Learn Once, Write Anywhere</strong>。</p>
<h3 id="2-特点">2. 特点</h3>
<h4 id="1-跨平台">1. 跨平台</h4>
<p>React Native 利用了 React 的 Virtual DOM，只需编写一套代码，便可以将代码打包成不同平台的 App，极大提高了开发效率，并且相对全部原生开发的应用来说，维护成本也相对更低。</p>
<h4 id="2-上手快">2. 上手快</h4>
<p>相比于原生开发，JavaScript 学习成本低、语法灵活。允许让 Web 开发者更多地基于现有经验开发 App。React Native 只需使用 JavaScript 就能编写移动原生应用，它和 React 的设计理念是一样的，因此可以毫不夸张地说：你如果会写 React，就会写 React Native!</p>
<h4 id="3-原生体验">3. 原生体验</h4>
<p>由于 React Native 提供的组件是对原生 API 的暴露，虽然我们使用的是 JavaScript 语言编写的代码，但是实际上是调用了原生的 API 和原生的 UI 组件。因此，体验和性能足以媲美原生应用。</p>
<h4 id="4-热更新">4. 热更新</h4>
<p>React Native 开发的应用支持热更新，因为 React Native 的产物是 bundle 文件，其实本质上就是 JS 代码，在 App 启动的时候就会去服务器上获取 bundle 文件，我们只需要更新 bundle 文件，从而使得 App 不需要重新前往商店下载就可以进行版本更新，开发者可以在用户无感知的情况下进行功能迭代或者 bug 修复。但是值得注意的是，AppStore 禁止热更新的功能中有调用私有 API、篡改原生代码和改变 App 的行为。</p>
<h2 id="2-配置环境">2. 配置环境</h2>
<blockquote>
<p><a href="https://reactnative.cn/docs/environment-setup">RN环境配置教程</a></p>
</blockquote>
<h3 id="1-nodejs">1. Node.js</h3>
<p>注意 Node 的版本应大于等于 12。</p>
<h3 id="2-jdk">2. JDK</h3>
<p>JDK 的版本必须是 1.8（目前不支持 1.9 及更高版本，注意 1.8 版本官方也直接称 8 版本）。</p>
<h3 id="3-android">3. Android</h3>
<p>最关键的步骤，主要包括了：</p>
<ul>
<li><code>Android Studio</code></li>
<li><code>Android SDK</code></li>
<li><code>Android SDK Platform</code></li>
<li><code>Android Virtual Device</code></li>
<li><code>AVD Manager</code></li>
</ul>
<p>以及环境变量的配置，包括：</p>
<ul>
<li>ANDROID_HOME</li>
<li>platform-tools</li>
<li>emulator</li>
<li>tools</li>
<li>tools/bin</li>
</ul>
<p>这里过程还算是比较复杂，需要安装多个开发环境，还涉及到科学上网，总之需要折腾一阵，按照官网的介绍总会成功。</p>
<h2 id="3-初始化项目">3. 初始化项目</h2>
<p>使用<code>npx react-native init projectName</code>进行项目的创建最后搭建好的项目运行起来应该是这样：</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/20210906132602.jpg" alt=""></p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/20210906132620.jpg" alt=""></p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/20210906132709.jpg" alt=""></p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/20210906133018.jpg" alt=""></p>
<h2 id="4-原理">4. 原理</h2>
<h3 id="1-整体架构">1. 整体架构</h3>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/v2-349367c8b1f7aa118672f848861c006e_720w.jpg" alt="img"></p>
<h3 id="2-工作原理">2. 工作原理</h3>
<p>React Native提供了一些平台无关的抽象核心组件，像<code>View</code>、<code>Text</code>、<code>Image</code>等，可以直接映射渲染为对应平台的原生UI组件。</p>
<p><img src="https://pic2.zhimg.com/80/v2-2bf84ece7deae66b28515b442240cd7d_720w.jpg" alt="img"></p>
<h3 id="3-工作流程">3. 工作流程</h3>
<p><img src="https://pic4.zhimg.com/80/v2-60eb566b812a49fa945e802abe8dd453_720w.jpg" alt="img"></p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/v2-990aa3a1c34a8e1b956baaa00b4ca9db_720w.jpg" alt="img"></p>
<p>简单的讲，RN 会做两件事 ：</p>
<ol>
<li>
<p>把我们编写的使用 React 语法的 JS 代码（包括依赖的外部库）编译打包成一个 bundle 文件（一般命名为 index.android.bundle)。</p>
</li>
<li>
<p>执行 bundle 中打包好的 JS 代码，在执行时，如果遇到扩展的 API， 则直接通过 bridge 调用对应的 native 方法；如果遇到 virtual DOM ，通过 bridge 传递到 native ， 然后根据 virtual DOM 内部的属性设置对应的真实 native 视图；</p>
</li>
</ol>
<p>但是为了做成这两件事，RN 会花费很大的力气，因为这里面涉及到了不同平台的不同接口，以及 js -&gt; native 的转换诸多难题。</p>
<h3 id="4-工具链">4. 工具链</h3>
<h4 id="1-metro">1. Metro</h4>
<p>RN的官方打包工具，使用<code>react-native bundle</code>命令直接就调用 Metro 进行我们的 bundle 打包工作。</p>
<blockquote>
<p>关于Metro的具体使用方法，在这里不想浪费太多时间，以后如果需要学习，会单独再写一篇文章，此时我们只需要关注，Metro是干什么的，它把我们原来写的代码打包成了什么样子？</p>
</blockquote>
<p>我们以一段非常简单的js代码为例：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-jsx" data-lang="jsx"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4">// App.js
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"></span><span style="color:#ff79c6">import</span> React from <span style="color:#f1fa8c">&#34;react&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#ff79c6">import</span> { StyleSheet, Text, View } from <span style="color:#f1fa8c">&#34;react-native&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#ff79c6">export</span> <span style="color:#ff79c6">default</span> <span style="color:#ff79c6">class</span> App <span style="color:#ff79c6">extends</span> React.Component {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span>  render() {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span>    <span style="color:#ff79c6">return</span> (
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>      &lt;<span style="color:#ff79c6">React.Fragment</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>        &lt;<span style="color:#ff79c6">View</span> <span style="color:#50fa7b">style</span><span style="color:#ff79c6">=</span>{styles.body}&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span>          &lt;<span style="color:#ff79c6">Text</span> <span style="color:#50fa7b">style</span><span style="color:#ff79c6">=</span>{styles.text}&gt;你好，世界&lt;/<span style="color:#ff79c6">Text</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span>        &lt;/<span style="color:#ff79c6">View</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>      &lt;/<span style="color:#ff79c6">React.Fragment</span>&gt;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>    );
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>  }
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span>}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span><span style="color:#ff79c6">const</span> styles <span style="color:#ff79c6">=</span> StyleSheet.create({
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>  body<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19</span>    backgroundColor<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;white&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20</span>    flex<span style="color:#ff79c6">:</span> <span style="color:#bd93f9">1</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21</span>    justifyContent<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;center&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22</span>    alignItems<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;center&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23</span>  },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25</span>  text<span style="color:#ff79c6">:</span> {
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26</span>    textAlign<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;center&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27</span>    color<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;red&#34;</span>,
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28</span>  },
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29</span>});
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30</span>
</code></pre></div><p>metro 打包的整个流程大致分为:</p>
<ul>
<li>命令参数解析</li>
<li>metro 打包服务启动</li>
<li>打包 js 和资源文件（解析，转化和生成）</li>
<li>停止打包服务</li>
</ul>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/e144be669c344b2c979759537f43487f~tplv-k3u1fbpfcp-zoom-1.image" alt="img"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span style="color:#6272a4">// var声明层
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span style="color:#6272a4"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span style="color:#8be9fd;font-style:italic">var</span> __BUNDLE_START_TIME__<span style="color:#ff79c6">=</span><span style="color:#ff79c6">this</span>.nativePerformanceNow<span style="color:#ff79c6">?</span>nativePerformanceNow()<span style="color:#ff79c6">:</span><span style="color:#8be9fd;font-style:italic">Date</span>.now(),__DEV__<span style="color:#ff79c6">=</span><span style="color:#ff79c6">false</span>,process<span style="color:#ff79c6">=</span><span style="color:#ff79c6">this</span>.process<span style="color:#ff79c6">||</span>{};process.env<span style="color:#ff79c6">=</span>process.env<span style="color:#ff79c6">||</span>{};process.env.NODE_ENV<span style="color:#ff79c6">=</span>process.env.NODE_ENV<span style="color:#ff79c6">||</span><span style="color:#f1fa8c">&#34;production&#34;</span>;
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span style="color:#6272a4">//polyfill层
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span style="color:#6272a4"></span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span style="color:#ff79c6">!</span>(<span style="color:#8be9fd;font-style:italic">function</span>(r){<span style="color:#f1fa8c">&#34;use strict&#34;</span>;r.__r<span style="color:#ff79c6">=</span>o,r.__d<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">function</span>(r,i,n){<span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">null</span><span style="color:#ff79c6">!=</span>e[i])<span style="color:#ff79c6">return</span>;<span style="color:#8be9fd;font-style:italic">var</span> o<span style="color:#ff79c6">=</span>{dependencyMap<span style="color:#ff79c6">:</span>n,factory<span style="color:#ff79c6">:</span>r,hasError<span style="color:#ff79c6">:!</span><span style="color:#bd93f9">1</span>,importedAll<span style="color:#ff79c6">:</span>t,importedDefault<span style="color:#ff79c6">:</span>t,isInitialized<span style="color:#ff79c6">:!</span><span style="color:#bd93f9">1</span>,publicModule<span style="color:#ff79c6">:</span>{exports<span style="color:#ff79c6">:</span>{}}};e[i]<span style="color:#ff79c6">=</span>o}
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span>...
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span style="color:#6272a4">// 模型定义层
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span style="color:#6272a4"></span>__d(<span style="color:#8be9fd;font-style:italic">function</span>(g,r,i,a,m,e,d){<span style="color:#8be9fd;font-style:italic">var</span> n<span style="color:#ff79c6">=</span>r(d[<span style="color:#bd93f9">0</span>]),t<span style="color:#ff79c6">=</span>r(d[<span style="color:#bd93f9">1</span>]),o<span style="color:#ff79c6">=</span>n(r(d[<span style="color:#bd93f9">2</span>])),u<span style="color:#ff79c6">=</span>r(d[<span style="color:#bd93f9">3</span>]);t.AppRegistry.registerComponent(u.name,<span style="color:#8be9fd;font-style:italic">function</span>(){<span style="color:#ff79c6">return</span> o.<span style="color:#ff79c6">default</span>})},<span style="color:#bd93f9">0</span>,[<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">402</span>,<span style="color:#bd93f9">403</span>]);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span>....
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span>__d(<span style="color:#8be9fd;font-style:italic">function</span>(a,e,t,i,R,S,c){R.exports<span style="color:#ff79c6">=</span>{name<span style="color:#ff79c6">:</span><span style="color:#f1fa8c">&#34;ReactNativeSSR&#34;</span>,displayName<span style="color:#ff79c6">:</span><span style="color:#f1fa8c">&#34;ReactNativeSSR&#34;</span>}},<span style="color:#bd93f9">403</span>,[]);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span>
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span style="color:#6272a4">// require层
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16</span><span style="color:#6272a4"></span>__r(<span style="color:#bd93f9">93</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17</span>__r(<span style="color:#bd93f9">0</span>);
<span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18</span>
</code></pre></div><p>Metro生成的 bundle 包大致分为四层:</p>
<ul>
<li>
<p>var 声明层：</p>
<p>当前运行环境，bundle 启动时间，以及进程相关信息；</p>
</li>
<li>
<p>polyfill 层：</p>
<p><code>!(function(r){})</code> , 定义了对 <code>define（__d）</code>、 <code>require（__r）</code>、<code>clear（__c）</code> 的支持，以及 module（react-native 及第三方 dependences 依赖的 module） 的加载逻辑；</p>
</li>
<li>
<p>模块定义层：</p>
<p><code>__d</code> 定义的代码块，里面包括 RN 框架源码 js 部分、自定义 js 代码部分、图片资源信息，供 require 引入使用</p>
</li>
<li>
<p>require 层：</p>
<p><code>__r</code> 定义的代码块，找到 <code>__d</code> 定义的代码块，并执行；</p>
</li>
</ul>
<p>这里我们也是简单学习，只了解每一层大概是干什么用的，以及打出来的包是给谁用的即可；</p>
<p>关于Metro的详细介绍，可以看下面的连接：</p>
<blockquote>
<p><a href="https://facebook.github.io/metro/docs/configuration/">Metro_Docs</a></p>
<p><a href="https://segmentfault.com/a/1190000038346994">react-native bundle 到 bundle 生成到底发生了什么(metro 打包流程简析)</a></p>
</blockquote>
<h4 id="2-javascriptcore">2. JavaScriptCore</h4>
<p>JavaScriptCore 就是js引擎，和 Chrome 的 V8 是一样的，最初是 WebKit 引擎中的 js 引擎，RN 也使用了这个 js 引擎来执行 js 代码。</p>
<h5 id="1-webkit">1. WebKit</h5>
<p>WebKit就是一个页面渲染以及逻辑处理引擎，HTML、JavaScript、CSS经过它的处理，成为可见且可操作的Web页面。</p>
<p>WebKit由多个重要模块组成，整体结构如下图：</p>
<p><img src="https://blogimg-1302307650.cos.ap-shanghai.myqcloud.com/v2-8fa19bbfacd897295d3f1789de83cca0_720w.jpg" alt="img"></p>
<p>WebKit由四个部分组成，分别是：</p>
<ul>
<li>WebKit Embedding API：负责浏览器UI与WebKit进行交互的部分</li>
<li>Platform API（WebKit Ports）：让Webkit更加方便的移植到各个操作系统、平台上，提供的一些调用Native Library的接口</li>
<li>WebCore</li>
<li>JavaScriptCore</li>
</ul>
<h5 id="2-rn-中的-jscore">2. RN 中的 JSCore</h5>
<p>Apple在iOS7之后，对WebKit中的JSCore进行了Objective-C的封装，使Native有了执行JS源码的能力，例如iOS中的UIWebView和WKWebView。</p>
<p>随着使用场景的不同，以及WebKit团队自身不停的优化，JSCore逐渐分化出不同的版本，其中包括了React Native使用的默认引擎JSCore。</p>
<p>React Native 目前在iOS平台使用JavaScriptCore（Apple要求），Android平台默认使用JavaScriptCore，也可切换使用V8或Hermes（React Native 0.60.2 版本后支持）</p>
<p>作为React Native默认引擎JSCore（均以iOS平台为例）由多个部分组成，其中最重要的四个部分分别是 ：</p>
<ul>
<li>JSVM</li>
<li>JSContext</li>
<li>JSValue</li>
<li>JSExport</li>
</ul>
<p>这里我们也不能耗费太多精力去学习JSCore的具体内容，只需要知道这是RN使用的js引擎即可，同时我们还要知道为什么使用JSCore？因为JSCore提供了两种RN需要的操作：</p>
<ul>
<li>在原生代码里面执行 JavaScript，而不用通过浏览器；</li>
<li>把原生对象注入到 JavaScript 环境里面去；</li>
</ul>
<p>关于JSCore的详细介绍，可以看下面的连接：</p>
<blockquote>
<p><a href="https://nshipster.cn/javascriptcore/">JavaScriptCore</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/29663994">JavaScriptCore 整体介绍</a></p>
</blockquote>
<p>了解完JSCore之后，我们对RN的认知更加清晰了。</p>
<p>在一定程度上，React Native 和 NodeJS 有异曲同工之妙。它们都是通过扩展JavaScript Engine, 使js具备强大的本地资源和原生接口调用能力，然后结合JavaScript丰富的库和社区和及其稳定的跨平台能力，把javascript的魔力在浏览器之外的地方充分发挥出来。</p>
<p>JavaScriptCore + ReactJS + Bridge 就成了React Native。</p>
<ol>
<li>ReactJS负责描述和管理VirtualDom，指挥原生组件进行绘制和更新，同时很多计算逻辑也在js里面进行。ReactJS自身是不直接绘制UI的，UI绘制是非常耗时的操作，原生组件最擅长这事情。</li>
<li>JavaScriptCore负责JS代码解释执行；</li>
<li>Bridge用来翻译ReactJS的绘制指令给原生组件进行绘制，同时把原生组件接收到的用户事件反馈给ReactJS。</li>
<li>要在不同的平台实现不同的效果就可以通过定制Bridge来实现。</li>
</ol>
<h4 id="3-bridge">3. Bridge</h4>
<blockquote>
<p>bridge 是一种 JS 和 Java 代码通信的机制， 用 bridge 函数传入 module 和 method 即可得到异步回调的结果。</p>
</blockquote>
<p>前面有提到，RN厉害在于它能打通JS和Native Code，让JS能够调用丰富的原生接口，充分发挥硬件的能力，实现非常复杂的效果，同时能保证效率和跨平台性。打通RN任督二脉的关键组件就是Bridge。</p>
<p>在RN中如果没有Bridge，JS还是那个JS，只能调用JS Engine提供的有限接口，绘制标准html提供的那些效果，那些摄像头、指纹、3D加速、声卡、视频播放定制等等，JS都只能流流口水，原生的、平台相关的、设备相关的效果做不了， 除非对浏览器进行定制。</p>
<p>Bridge的作用就是给RN内嵌的JS Engine提供原生接口的扩展供JS调用。</p>
<p>所有的本地存储、图片资源访问、图形图像绘制、3D加速、网络访问、震动效果、NFC、原生控件绘制、地图、定位、通知等都是通过Bridge封装成JS接口以后注入JS Engine供JS调用。</p>
<p>理论上，任何原生代码能实现的效果都可以通过Bridge封装成JS可以调用的组件和方法，以JS模块的形式提供给RN使用。</p>
<p>每一个支持RN的原生功能必须同时有一个原生模块和一个JS模块，JS模块是原生模块的封装，方便Javascript调用其接口。Bridge会负责管理原生模块和对应JS模块之间的沟通，通过Bridge，JS代码能够驱动所有原生接口，实现各种原生酷炫的效果。</p>
<p>RN中JS和Native分隔非常清晰，JS不会直接引用Native层的对象实例，Native也不会直接引用JS层的对象实例(所有Native和JS互掉都是通过Bridge层会几个最基础的方法衔接的)。</p>
<p>Bridge 原生代码负责管理原生模块并生成对应的JS模块信息供JS代码调用。每个功能JS层的封装主要是针对ReactJS做适配，让原生模块的功能能够更加容易被用ReactJS调用。</p>
<p>Bridge包括了下面几个模块：</p>
<ol>
<li>RCTRootView</li>
<li>RCTRootContentView</li>
<li>RCTBridge</li>
<li>RCTBatchedBridge</li>
<li>RCTJavaScriptLoader</li>
<li>RCTContextExecutor</li>
<li>RCTModuleData</li>
<li>RCTModuleMethod</li>
</ol>
<p>很遗憾的是，还是没有时间去深入学习Bridge的相关知识，关于JSCore的详细介绍，可以看下面的连接：</p>
<blockquote>
<p><a href="https://www.jianshu.com/p/79edec250158">RN系列：Android原生与RN如何交互通信</a></p>
<p><a href="https://www.cnblogs.com/wood-life/p/10577868.html">React Native、React和JavascriptCore的关系</a></p>
</blockquote>

      </div>
      <div class="footer">
        <span><a class="category" href="https://tomtomyoung.top/categories/%E5%89%8D%E7%AB%AF/">前端</a><a class="category" href="https://tomtomyoung.top/categories/%E7%B2%BE%E9%80%89/">精选</a></span>
        <span><a class="tag" href="https://tomtomyoung.top/tags/react_native/">react_native</a></span>
      </div>
    </div>

    <ul class="menu">
    <li class="menu-item">
        <i class="iconfont icon-top item-btn" id="back_top_btn"></i>
    </li>
    <li class="menu-item">
        <a href="https://tomtomyoung.top/" id="back-btn">
            <i class="iconfont icon-home item-btn"></i>
        </a>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-switch item-btn" id="switch_btn"></i>
    </li>
    <li class="menu-item">
        <i class="iconfont icon-search item-btn" id="search_btn"></i>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/vue-%E6%89%8B%E5%86%99%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A/" data-tooltip="vue 手写数据双向绑定">
            <i class="iconfont icon-left item-btn"></i>
            
        </a>
    </li>
    <li class="menu-item">
        
        <a class="" href="https://tomtomyoung.top/post/react-jsx%E8%AF%A6%E8%A7%A3/" data-tooltip="react jsx详解">
            <i class="iconfont icon-right item-btn"></i>
            
        </a>
    </li>
</ul>

  </div>
</div>

<div class="cover" id="cover">
        <div class="search-container">
    <input type="search" class="docsearch-input search-input" placeholder="搜索关键词" />
    
</div>
    </div>
</body>








<script type="text/javascript" src="https://tomtomyoung.top/js/util.min.js" integrity=""></script>
<script>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    

    
    
    
    
    
    
    
    
    
</script></html>